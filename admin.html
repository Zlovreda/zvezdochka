<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä - –°–ù–¢ "–ó–≤–µ–∑–¥–æ—á–∫–∞"</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: #f5f7fa;
            min-height: 100vh;
        }
        
        .header {
            background: linear-gradient(135deg, #2c3e50 0%, #4a6491 100%);
            color: white;
            padding: 20px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
        }
        
        .header-content {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .admin-info h1 {
            font-size: 24px;
            margin-bottom: 5px;
        }
        
        .logout-btn {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: 2px solid rgba(255, 255, 255, 0.3);
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
        }
        
        .logout-btn:hover {
            background: rgba(255, 255, 255, 0.3);
        }
        
        .container {
            max-width: 1400px;
            margin: 30px auto;
            padding: 0 20px;
        }
        
        .tabs {
            display: flex;
            background: white;
            border-radius: 12px;
            overflow: hidden;
            margin-bottom: 30px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.08);
        }
        
        .tab {
            padding: 18px 30px;
            cursor: pointer;
            font-weight: 500;
            color: #666;
            border-bottom: 3px solid transparent;
            transition: all 0.3s;
        }
        
        .tab:hover {
            background: #f8f9fa;
        }
        
        .tab.active {
            color: #2c3e50;
            border-bottom-color: #2c3e50;
            background: #f8f9fa;
        }
        
        .tab-content {
            display: none;
            background: white;
            border-radius: 12px;
            padding: 30px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.08);
        }
        
        .tab-content.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .card {
            background: white;
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.08);
            margin-bottom: 25px;
        }
        
        .card h2 {
            color: #333;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #f0f0f0;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-item {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 25px;
            border-radius: 12px;
        }
        
        .stat-value {
            font-size: 32px;
            font-weight: bold;
            margin: 10px 0;
        }
        
        .stat-label {
            font-size: 16px;
            opacity: 0.9;
        }
        
        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #555;
            font-weight: 500;
        }
        
        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e1e5e9;
            border-radius: 8px;
            font-size: 16px;
            transition: all 0.3s;
        }
        
        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        
        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 14px 28px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.3s;
            margin-right: 10px;
            margin-bottom: 10px;
        }
        
        .btn:hover {
            transform: translateY(-2px);
        }
        
        .btn-secondary {
            background: #6c757d;
        }
        
        .btn-danger {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        }
        
        .btn-success {
            background: linear-gradient(135deg, #4cd964 0%, #5ac8fa 100%);
        }
        
        .btn-export {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
        }
        
        .btn-group {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 20px;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        
        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #eee;
        }
        
        th {
            background: #f8f9fa;
            font-weight: 600;
            color: #555;
            position: sticky;
            top: 0;
        }
        
        tr:hover {
            background: #f8f9fa;
        }
        
        .action-buttons {
            display: flex;
            gap: 5px;
        }
        
        .action-btn {
            padding: 5px 10px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
        }
        
        .edit-btn {
            background: #ffc107;
            color: #212529;
        }
        
        .delete-btn {
            background: #dc3545;
            color: white;
        }
        
        .paid-badge {
            background: #28a745;
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
        }
        
        .unpaid-badge {
            background: #dc3545;
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
        }
        
        .message {
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: none;
        }
        
        .message.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .message.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .message.info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        
        .file-input {
            position: relative;
            margin-bottom: 20px;
        }
        
        .file-input input[type="file"] {
            position: absolute;
            opacity: 0;
            width: 100%;
            height: 100%;
            cursor: pointer;
        }
        
        .file-input label {
            display: block;
            padding: 15px;
            background: #f8f9fa;
            border: 2px dashed #dee2e6;
            border-radius: 8px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .file-input label:hover {
            background: #e9ecef;
        }
        
        .search-box {
            margin-bottom: 20px;
        }
        
        .search-box input {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e1e5e9;
            border-radius: 8px;
            font-size: 16px;
        }
        
        .pagination {
            display: flex;
            justify-content: center;
            gap: 5px;
            margin-top: 20px;
        }
        
        .page-btn {
            padding: 8px 12px;
            border: 1px solid #dee2e6;
            background: white;
            cursor: pointer;
            border-radius: 4px;
        }
        
        .page-btn.active {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }
        
        @media (max-width: 768px) {
            .tabs {
                flex-direction: column;
            }
            
            .tab {
                text-align: center;
            }
            
            .btn-group {
                flex-direction: column;
            }
            
            .btn {
                width: 100%;
                margin-right: 0;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="header-content">
            <div class="admin-info">
                <h1>–ü–∞–Ω–µ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ –°–ù–¢ "–ó–≤–µ–∑–¥–æ—á–∫–∞"</h1>
                <p>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏, –ø–æ–∫–∞–∑–∞–Ω–∏—è–º–∏ –∏ –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è–º–∏</p>
            </div>
            <button class="logout-btn" onclick="logout()">–í—ã–π—Ç–∏</button>
        </div>
    </div>
    
    <div class="container">
        <div class="tabs">
            <div class="tab active" onclick="switchTab('dashboard')">–î–∞—à–±–æ—Ä–¥</div>
            <div class="tab" onclick="switchTab('users')">–£—á–∞—Å—Ç–Ω–∏–∫–∏</div>
            <div class="tab" onclick="switchTab('meters')">–ü–æ–∫–∞–∑–∞–Ω–∏—è</div>
            <div class="tab" onclick="switchTab('contributions')">–í–∑–Ω–æ—Å—ã</div>
            <div class="tab" onclick="switchTab('tariffs')">–¢–∞—Ä–∏—Ñ—ã</div>
            <div class="tab" onclick="switchTab('import')">–ò–º–ø–æ—Ä—Ç/–≠–∫—Å–ø–æ—Ä—Ç</div>
            <div class="tab" onclick="switchTab('settings')">–ù–∞—Å—Ç—Ä–æ–π–∫–∏</div>
        </div>
        
        <!-- –î–∞—à–±–æ—Ä–¥ -->
        <div class="tab-content active" id="dashboardTab">
            <div class="stats-grid">
                <div class="stat-item">
                    <div class="stat-label">–í—Å–µ–≥–æ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤</div>
                    <div class="stat-value" id="totalUsers">0</div>
                </div>
                <div class="stat-item">
                    <div class="stat-label">–û–±—â–∞—è –∑–∞–¥–æ–ª–∂–µ–Ω–Ω–æ—Å—Ç—å</div>
                    <div class="stat-value" id="totalDebt">0 ‚ÇΩ</div>
                </div>
                <div class="stat-item">
                    <div class="stat-label">–≠–ª–µ–∫—Ç—Ä–æ—ç–Ω–µ—Ä–≥–∏—è</div>
                    <div class="stat-value" id="electricityDebt">0 ‚ÇΩ</div>
                </div>
                <div class="stat-item">
                    <div class="stat-label">–ß–ª–µ–Ω—Å–∫–∏–µ –≤–∑–Ω–æ—Å—ã</div>
                    <div class="stat-value" id="contributionsDebt">0 ‚ÇΩ</div>
                </div>
            </div>
            
            <div class="card">
                <h2>–ë—ã—Å—Ç—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—è</h2>
                <div class="btn-group">
                    <button class="btn" onclick="switchTab('users')">–î–æ–±–∞–≤–∏—Ç—å —É—á–∞—Å—Ç–Ω–∏–∫–∞</button>
                    <button class="btn btn-success" onclick="generateInvoices()">–°—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è</button>
                    <button class="btn btn-export" onclick="exportAllData()">–≠–∫—Å–ø–æ—Ä—Ç –≤—Å–µ—Ö –¥–∞–Ω–Ω—ã—Ö</button>
                    <button class="btn btn-secondary" onclick="sendReminders()">–û—Ç–ø—Ä–∞–≤–∏—Ç—å –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è</button>
                </div>
            </div>
            
            <div class="card">
                <h2>–ü–æ—Å–ª–µ–¥–Ω–∏–µ –ø–æ–∫–∞–∑–∞–Ω–∏—è</h2>
                <table id="recentReadings">
                    <thead>
                        <tr>
                            <th>–£—á–∞—Å—Ç–æ–∫</th>
                            <th>–£—á–∞—Å—Ç–Ω–∏–∫</th>
                            <th>–ü–æ–∫–∞–∑–∞–Ω–∏—è</th>
                            <th>–î–∞—Ç–∞</th>
                            <th>–°—Ç–∞—Ç—É—Å</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- –î–∞–Ω–Ω—ã–µ –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–µ–Ω—ã —á–µ—Ä–µ–∑ JS -->
                    </tbody>
                </table>
            </div>
        </div>
        
        <!-- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —É—á–∞—Å—Ç–Ω–∏–∫–∞–º–∏ -->
        <div class="tab-content" id="usersTab">
            <div class="message" id="usersMessage"></div>
            
            <div class="btn-group">
                <button class="btn" onclick="showUserForm()">+ –î–æ–±–∞–≤–∏—Ç—å —É—á–∞—Å—Ç–Ω–∏–∫–∞</button>
                <button class="btn btn-export" onclick="exportUsers()">–≠–∫—Å–ø–æ—Ä—Ç –≤ CSV</button>
                <button class="btn btn-secondary" onclick="importUsers()">–ò–º–ø–æ—Ä—Ç –∏–∑ CSV</button>
            </div>
            
            <div class="search-box">
                <input type="text" id="userSearch" placeholder="–ü–æ–∏—Å–∫ –ø–æ –§–ò–û –∏–ª–∏ –Ω–æ–º–µ—Ä—É —É—á–∞—Å—Ç–∫–∞..." 
                       onkeyup="searchUsers()">
            </div>
            
            <div style="overflow-x: auto;">
                <table id="usersTable">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>–£—á–∞—Å—Ç–æ–∫</th>
                            <th>–§–ò–û</th>
                            <th>–õ–æ–≥–∏–Ω</th>
                            <th>–¢–µ–ª–µ—Ñ–æ–Ω</th>
                            <th>Email</th>
                            <th>–ë–∞–ª–∞–Ω—Å</th>
                            <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- –î–∞–Ω–Ω—ã–µ –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–µ–Ω—ã —á–µ—Ä–µ–∑ JS -->
                    </tbody>
                </table>
            </div>
            
            <!-- –§–æ—Ä–º–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è/—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è -->
            <div id="userForm" style="display: none; margin-top: 30px;">
                <div class="card">
                    <h2 id="userFormTitle">–î–æ–±–∞–≤–ª–µ–Ω–∏–µ —É—á–∞—Å—Ç–Ω–∏–∫–∞</h2>
                    <form id="userFormData" onsubmit="saveUser(event)">
                        <div class="form-grid">
                            <div class="form-group">
                                <label>–ù–æ–º–µ—Ä —É—á–∞—Å—Ç–∫–∞ *</label>
                                <input type="text" id="plotNumber" required>
                            </div>
                            <div class="form-group">
                                <label>–§–ò–û *</label>
                                <input type="text" id="fullName" required>
                            </div>
                            <div class="form-group">
                                <label>–õ–æ–≥–∏–Ω *</label>
                                <input type="text" id="username" required>
                            </div>
                            <div class="form-group">
                                <label>–ü–∞—Ä–æ–ª—å *</label>
                                <input type="password" id="password" required>
                            </div>
                            <div class="form-group">
                                <label>–¢–µ–ª–µ—Ñ–æ–Ω</label>
                                <input type="tel" id="phone">
                            </div>
                            <div class="form-group">
                                <label>Email</label>
                                <input type="email" id="email">
                            </div>
                            <div class="form-group">
                                <label>–ü–ª–æ—â–∞–¥—å —É—á–∞—Å—Ç–∫–∞ (—Å–æ—Ç–æ–∫)</label>
                                <input type="number" id="area" step="0.01">
                            </div>
                            <div class="form-group">
                                <label>–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</label>
                                <textarea id="notes" rows="3"></textarea>
                            </div>
                        </div>
                        
                        <div class="btn-group">
                            <button type="submit" class="btn btn-success">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                            <button type="button" class="btn btn-secondary" onclick="hideUserForm()">–û—Ç–º–µ–Ω–∞</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
        
        <!-- –ü–æ–∫–∞–∑–∞–Ω–∏—è —Å—á–µ—Ç—á–∏–∫–æ–≤ -->
        <div class="tab-content" id="metersTab">
            <div class="message" id="metersMessage"></div>
            
            <div class="btn-group">
                <button class="btn" onclick="addMeterReading()">+ –î–æ–±–∞–≤–∏—Ç—å –ø–æ–∫–∞–∑–∞–Ω–∏—è</button>
                <button class="btn btn-export" onclick="exportMeterReadings()">–≠–∫—Å–ø–æ—Ä—Ç –≤ CSV</button>
                <button class="btn btn-secondary" onclick="importMeterReadings()">–ò–º–ø–æ—Ä—Ç –∏–∑ CSV</button>
                <button class="btn btn-success" onclick="calculateElectricity()">–†–∞—Å—Å—á–∏—Ç–∞—Ç—å —ç–ª–µ–∫—Ç—Ä–æ—ç–Ω–µ—Ä–≥–∏—é</button>
            </div>
            
            <div class="search-box">
                <input type="text" id="meterSearch" placeholder="–ü–æ–∏—Å–∫ –ø–æ —É—á–∞—Å—Ç–∫—É –∏–ª–∏ –§–ò–û..." 
                       onkeyup="searchMeterReadings()">
            </div>
            
            <div style="overflow-x: auto;">
                <table id="metersTable">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>–£—á–∞—Å—Ç–æ–∫</th>
                            <th>–§–ò–û</th>
                            <th>–î–∞—Ç–∞</th>
                            <th>–ü–æ–∫–∞–∑–∞–Ω–∏—è</th>
                            <th>–†–∞—Å—Ö–æ–¥</th>
                            <th>–°—É–º–º–∞</th>
                            <th>–°—Ç–∞—Ç—É—Å</th>
                            <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- –î–∞–Ω–Ω—ã–µ –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–µ–Ω—ã —á–µ—Ä–µ–∑ JS -->
                    </tbody>
                </table>
            </div>
        </div>
        
        <!-- –ß–ª–µ–Ω—Å–∫–∏–µ –≤–∑–Ω–æ—Å—ã -->
        <div class="tab-content" id="contributionsTab">
            <div class="message" id="contributionsMessage"></div>
            
            <div class="btn-group">
                <button class="btn" onclick="addContribution()">+ –ù–∞—á–∏—Å–ª–∏—Ç—å –≤–∑–Ω–æ—Å</button>
                <button class="btn" onclick="addMassContributions()">–ú–∞—Å—Å–æ–≤–æ–µ –Ω–∞—á–∏—Å–ª–µ–Ω–∏–µ</button>
                <button class="btn btn-export" onclick="exportContributions()">–≠–∫—Å–ø–æ—Ä—Ç –≤ CSV</button>
                <button class="btn btn-secondary" onclick="importContributions()">–ò–º–ø–æ—Ä—Ç –∏–∑ CSV</button>
            </div>
            
            <div class="form-grid">
                <div class="form-group">
                    <label>–¢–∏–ø –≤–∑–Ω–æ—Å–∞</label>
                    <select id="contributionTypeFilter" onchange="filterContributions()">
                        <option value="">–í—Å–µ —Ç–∏–ø—ã</option>
                        <option value="salary">1. –ó–∞—Ä–ø–ª–∞—Ç–∞</option>
                        <option value="maintenance">2. –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ</option>
                        <option value="other">3. –ü—Ä–æ—á–µ–µ</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>–°—Ç–∞—Ç—É—Å</label>
                    <select id="contributionStatusFilter" onchange="filterContributions()">
                        <option value="">–í—Å–µ —Å—Ç–∞—Ç—É—Å—ã</option>
                        <option value="paid">–û–ø–ª–∞—á–µ–Ω–æ</option>
                        <option value="unpaid">–ù–µ –æ–ø–ª–∞—á–µ–Ω–æ</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>–ú–µ—Å—è—Ü</label>
                    <input type="month" id="contributionMonthFilter" onchange="filterContributions()">
                </div>
            </div>
            
            <div style="overflow-x: auto;">
                <table id="contributionsTable">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>–£—á–∞—Å—Ç–æ–∫</th>
                            <th>–§–ò–û</th>
                            <th>–¢–∏–ø</th>
                            <th>–°—É–º–º–∞</th>
                            <th>–î–∞—Ç–∞ –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è</th>
                            <th>–°—Ä–æ–∫ –æ–ø–ª–∞—Ç—ã</th>
                            <th>–°—Ç–∞—Ç—É—Å</th>
                            <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- –î–∞–Ω–Ω—ã–µ –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–µ–Ω—ã —á–µ—Ä–µ–∑ JS -->
                    </tbody>
                </table>
            </div>
        </div>
        
        <!-- –¢–∞—Ä–∏—Ñ—ã -->
        <div class="tab-content" id="tariffsTab">
            <div class="message" id="tariffsMessage"></div>
            
            <div class="card">
                <h2>–¢–µ–∫—É—â–∏–µ —Ç–∞—Ä–∏—Ñ—ã</h2>
                <div id="currentTariffs">
                    <!-- –¢–µ–∫—É—â–∏–µ —Ç–∞—Ä–∏—Ñ—ã –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–µ–Ω—ã —á–µ—Ä–µ–∑ JS -->
                </div>
            </div>
            
            <div class="card">
                <h2>–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –Ω–æ–≤—ã–µ —Ç–∞—Ä–∏—Ñ—ã</h2>
                <form id="tariffForm" onsubmit="saveTariffs(event)">
                    <div class="form-grid">
                        <div class="form-group">
                            <label>–¢–∞—Ä–∏—Ñ 1 (–¥–æ 100 –∫–í—Ç¬∑—á) *</label>
                            <input type="number" step="0.01" id="rate1" required placeholder="—Ä—É–±/–∫–í—Ç¬∑—á">
                        </div>
                        <div class="form-group">
                            <label>–¢–∞—Ä–∏—Ñ 2 (—Å–≤—ã—à–µ 100 –∫–í—Ç¬∑—á) *</label>
                            <input type="number" step="0.01" id="rate2" required placeholder="—Ä—É–±/–∫–í—Ç¬∑—á">
                        </div>
                        <div class="form-group">
                            <label>–¢–∞—Ä–∏—Ñ –Ω–∞ –æ–±—â–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –Ω—É–∂–¥—ã *</label>
                            <input type="number" step="0.01" id="rateCommon" required placeholder="—Ä—É–±/–∫–í—Ç¬∑—á">
                        </div>
                        <div class="form-group">
                            <label>–î–∞—Ç–∞ –Ω–∞—á–∞–ª–∞ –¥–µ–π—Å—Ç–≤–∏—è *</label>
                            <input type="date" id="validFrom" required>
                        </div>
                        <div class="form-group">
                            <label>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π</label>
                            <input type="text" id="tariffComment" placeholder="–û—Å–Ω–æ–≤–∞–Ω–∏–µ –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ç–∞—Ä–∏—Ñ–æ–≤">
                        </div>
                    </div>
                    
                    <div class="btn-group">
                        <button type="submit" class="btn btn-success">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ç–∞—Ä–∏—Ñ—ã</button>
                    </div>
                </form>
            </div>
            
            <div class="card">
                <h2>–ò—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ç–∞—Ä–∏—Ñ–æ–≤</h2>
                <table id="tariffsHistory">
                    <thead>
                        <tr>
                            <th>–î–∞—Ç–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∏</th>
                            <th>–¢–∞—Ä–∏—Ñ 1</th>
                            <th>–¢–∞—Ä–∏—Ñ 2</th>
                            <th>–û–±—â–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –Ω—É–∂–¥—ã</th>
                            <th>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- –ò—Å—Ç–æ—Ä–∏—è –±—É–¥–µ—Ç –∑–∞–≥—Ä—É–∂–µ–Ω–∞ —á–µ—Ä–µ–∑ JS -->
                    </tbody>
                </table>
            </div>
        </div>
        
        <!-- –ò–º–ø–æ—Ä—Ç/–≠–∫—Å–ø–æ—Ä—Ç -->
        <div class="tab-content" id="importTab">
            <div class="message" id="importMessage"></div>
            
            <div class="card">
                <h2>–≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö</h2>
                <div class="btn-group">
                    <button class="btn btn-export" onclick="exportData('users')">–≠–∫—Å–ø–æ—Ä—Ç —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤</button>
                    <button class="btn btn-export" onclick="exportData('readings')">–≠–∫—Å–ø–æ—Ä—Ç –ø–æ–∫–∞–∑–∞–Ω–∏–π</button>
                    <button class="btn btn-export" onclick="exportData('contributions')">–≠–∫—Å–ø–æ—Ä—Ç –≤–∑–Ω–æ—Å–æ–≤</button>
                    <button class="btn btn-export" onclick="exportData('all')">–≠–∫—Å–ø–æ—Ä—Ç –≤—Å–µ—Ö –¥–∞–Ω–Ω—ã—Ö</button>
                </div>
            </div>
            
            <div class="card">
                <h2>–ò–º–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö</h2>
                <div class="file-input">
                    <input type="file" id="importFile" accept=".csv" onchange="handleFileSelect(event)">
                    <label for="importFile">
                        <div style="font-size: 48px;">üìÅ</div>
                        <div>–ü–µ—Ä–µ—Ç–∞—â–∏—Ç–µ CSV —Ñ–∞–π–ª –∏–ª–∏ –∫–ª–∏–∫–Ω–∏—Ç–µ –¥–ª—è –≤—ã–±–æ—Ä–∞</div>
                        <div style="font-size: 12px; color: #666; margin-top: 10px;">
                            –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã: –£—á–∞—Å—Ç–Ω–∏–∫–∏, –ü–æ–∫–∞–∑–∞–Ω–∏—è, –í–∑–Ω–æ—Å—ã
                        </div>
                    </label>
                </div>
                
                <div class="form-group">
                    <label>–¢–∏–ø –∏–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º—ã—Ö –¥–∞–Ω–Ω—ã—Ö</label>
                    <select id="importType">
                        <option value="users">–£—á–∞—Å—Ç–Ω–∏–∫–∏</option>
                        <option value="readings">–ü–æ–∫–∞–∑–∞–Ω–∏—è —Å—á–µ—Ç—á–∏–∫–æ–≤</option>
                        <option value="contributions">–ß–ª–µ–Ω—Å–∫–∏–µ –≤–∑–Ω–æ—Å—ã</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label>–†–µ–∂–∏–º –∏–º–ø–æ—Ä—Ç–∞</label>
                    <select id="importMode">
                        <option value="add">–î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–µ –∑–∞–ø–∏—Å–∏</option>
                        <option value="replace">–ó–∞–º–µ–Ω–∏—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ</option>
                        <option value="update">–û–±–Ω–æ–≤–∏—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ</option>
                    </select>
                </div>
                
                <div class="btn-group">
                    <button class="btn btn-success" onclick="processImport()">–ù–∞—á–∞—Ç—å –∏–º–ø–æ—Ä—Ç</button>
                    <button class="btn btn-secondary" onclick="downloadTemplate()">–°–∫–∞—á–∞—Ç—å —à–∞–±–ª–æ–Ω</button>
                </div>
            </div>
            
            <div class="card">
                <h2>–†–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ</h2>
                <p>–°–æ–∑–¥–∞–π—Ç–µ —Ä–µ–∑–µ—Ä–≤–Ω—É—é –∫–æ–ø–∏—é –≤—Å–µ—Ö –¥–∞–Ω–Ω—ã—Ö –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö.</p>
                <div class="btn-group">
                    <button class="btn" onclick="createBackup()">–°–æ–∑–¥–∞—Ç—å —Ä–µ–∑–µ—Ä–≤–Ω—É—é –∫–æ–ø–∏—é</button>
                    <button class="btn btn-secondary" onclick="restoreBackup()">–í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∏–∑ –∫–æ–ø–∏–∏</button>
                </div>
                
                <div id="backupList" style="margin-top: 20px;">
                    <!-- –°–ø–∏—Å–æ–∫ —Ä–µ–∑–µ—Ä–≤–Ω—ã—Ö –∫–æ–ø–∏–π –±—É–¥–µ—Ç –∑–∞–≥—Ä—É–∂–µ–Ω —á–µ—Ä–µ–∑ JS -->
                </div>
            </div>
        </div>
        
        <!-- –ù–∞—Å—Ç—Ä–æ–π–∫–∏ -->
        <div class="tab-content" id="settingsTab">
            <div class="message" id="settingsMessage"></div>
            
            <div class="card">
                <h2>–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–∏—Å—Ç–µ–º—ã</h2>
                <form id="settingsForm" onsubmit="saveSettings(event)">
                    <div class="form-grid">
                        <div class="form-group">
                            <label>–ù–∞–∑–≤–∞–Ω–∏–µ –°–ù–¢</label>
                            <input type="text" id="sntName" value="–°–ù–¢ '–ó–≤–µ–∑–¥–æ—á–∫–∞'">
                        </div>
                        <div class="form-group">
                            <label>–ö–æ–Ω—Ç–∞–∫—Ç–Ω—ã–π —Ç–µ–ª–µ—Ñ–æ–Ω</label>
                            <input type="tel" id="contactPhone">
                        </div>
                        <div class="form-group">
                            <label>–ö–æ–Ω—Ç–∞–∫—Ç–Ω—ã–π email</label>
                            <input type="email" id="contactEmail">
                        </div>
                        <div class="form-group">
                            <label>–î–Ω–∏ –ø—Ä–∏–µ–º–∞</label>
                            <input type="text" id="receptionDays" placeholder="–ü–Ω-–ü—Ç, 10:00-18:00">
                        </div>
                        <div class="form-group">
                            <label>–°—Ä–æ–∫ –æ–ø–ª–∞—Ç—ã –≤–∑–Ω–æ—Å–æ–≤ (–¥–Ω–µ–π)</label>
                            <input type="number" id="paymentDeadline" value="30">
                        </div>
                        <div class="form-group">
                            <label>–®—Ç—Ä–∞—Ñ –∑–∞ –ø—Ä–æ—Å—Ä–æ—á–∫—É (%)</label>
                            <input type="number" step="0.01" id="lateFee" value="0.5">
                        </div>
                    </div>
                    
                    <div class="btn-group">
                        <button type="submit" class="btn btn-success">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏</button>
                    </div>
                </form>
            </div>
            
            <div class="card">
                <h2>–°–∏—Å—Ç–µ–º–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h2>
                <div id="systemInfo">
                    <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –±—É–¥–µ—Ç –∑–∞–≥—Ä—É–∂–µ–Ω–∞ —á–µ—Ä–µ–∑ JS -->
                </div>
            </div>
            
            <div class="card">
                <h2>–û–ø–∞—Å–Ω–∞—è –∑–æ–Ω–∞</h2>
                <div class="btn-group">
                    <button class="btn btn-danger" onclick="clearOldData()">–û—á–∏—Å—Ç–∏—Ç—å —Å—Ç–∞—Ä—ã–µ –¥–∞–Ω–Ω—ã–µ</button>
                    <button class="btn btn-danger" onclick="resetSystem()">–°–±—Ä–æ—Å–∏—Ç—å —Å–∏—Å—Ç–µ–º—É</button>
                </div>
                <p style="color: #666; margin-top: 10px; font-size: 14px;">
                    –í–Ω–∏–º–∞–Ω–∏–µ: –≠—Ç–∏ –¥–µ–π—Å—Ç–≤–∏—è –Ω–µ–æ–±—Ä–∞—Ç–∏–º—ã. –°–æ–∑–¥–∞–π—Ç–µ —Ä–µ–∑–µ—Ä–≤–Ω—É—é –∫–æ–ø–∏—é –ø–µ—Ä–µ–¥ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ–º.
                </p>
            </div>
        </div>
    </div>

    <script>
        // –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Supabase
        const SUPABASE_URL = 'https://chgbdbuiqzdmwiniyxrk.supabase.co';
        const SUPABASE_ANON_KEY = 'sb_publishable_9NXa4FwnnrICXnXmrOVqRg_KB5LHkmk';
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Supabase
        const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
        
        // –¢–µ–∫—É—â–∏–π –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä
        let currentAdmin = null;
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        async function initializePage() {
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é
            const userData = localStorage.getItem('user');
            if (!userData) {
                window.location.href = 'index.html';
                return;
            }
            
            currentAdmin = JSON.parse(userData);
            
            // –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –∞–¥–º–∏–Ω, –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ–º
            if (currentAdmin.role !== 'admin') {
                window.location.href = 'user.html';
                return;
            }
            
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
            await initializeDatabase();
            
            // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –¥–∞—à–±–æ—Ä–¥–∞
            await loadDashboardData();
            
            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å–µ–≥–æ–¥–Ω—è—à–Ω—é—é –¥–∞—Ç—É –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –≤ —Ñ–æ—Ä–º–∞—Ö
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('validFrom').value = today;
        }
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
        async function initializeDatabase() {
            try {
                // –°–æ–∑–¥–∞–µ–º —Ç–∞–±–ª–∏—Ü—ã –µ—Å–ª–∏ –∏—Ö –Ω–µ—Ç
                await createTablesIfNotExist();
                
                // –°–æ–∑–¥–∞–µ–º —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ –µ—Å–ª–∏ –±–∞–∑–∞ –ø—É—Å—Ç–∞
                await createTestData();
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö:', error);
                showMessage('usersMessage', '–û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö', 'error');
            }
        }
        
        // –°–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü
        async function createTablesIfNotExist() {
            // –¢–∞–±–ª–∏—Ü–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
            const { data: users, error: usersError } = await supabase
                .from('users')
                .select('id')
                .limit(1);
            
            if (usersError) {
                console.log('–¢–∞–±–ª–∏—Ü–∞ users –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç, —Å–æ–∑–¥–∞–µ–º —Å—Ç—Ä—É–∫—Ç—É—Ä—É...');
                // –í —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–æ–µ–∫—Ç–µ –∑–¥–µ—Å—å –±—ã–ª –±—ã SQL –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Ç–∞–±–ª–∏—Ü
                // –î–ª—è Supabase —Ç–∞–±–ª–∏—Ü—ã —Å–æ–∑–¥–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ Dashboard
            }
        }
        
        // –°–æ–∑–¥–∞–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö
        async function createTestData() {
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ –¥–∞–Ω–Ω—ã–µ
            const { data: users, error } = await supabase
                .from('users')
                .select('id')
                .limit(1);
            
            if (users && users.length === 0) {
                // –°–æ–∑–¥–∞–µ–º –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
                await supabase
                    .from('users')
                    .insert([
                        {
                            username: 'admin',
                            password: 'admin123',
                            role: 'admin',
                            full_name: '–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –°–ù–¢',
                            plot_number: '0',
                            phone: '+7 (999) 123-45-67',
                            email: 'admin@zvezdochka-snt.ru',
                            created_at: new Date().toISOString()
                        }
                    ]);
                
                // –°–æ–∑–¥–∞–µ–º —Ç–∞—Ä–∏—Ñ—ã
                await supabase
                    .from('tariffs')
                    .insert([
                        {
                            rate1: 6.1,
                            rate2: 7.3,
                            rate_common: 0.36,
                            valid_from: new Date().toISOString().split('T')[0],
                            comment: '–ù–∞—á–∞–ª—å–Ω—ã–µ —Ç–∞—Ä–∏—Ñ—ã',
                            created_at: new Date().toISOString()
                        }
                    ]);
                
                console.log('–¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ —Å–æ–∑–¥–∞–Ω—ã');
            }
        }
        
        // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –¥–∞—à–±–æ—Ä–¥–∞
        async function loadDashboardData() {
            try {
                // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
                await loadStatistics();
                
                // –ó–∞–≥—Ä—É–∂–∞–µ–º –ø–æ—Å–ª–µ–¥–Ω–∏–µ –ø–æ–∫–∞–∑–∞–Ω–∏—è
                await loadRecentReadings();
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞—à–±–æ—Ä–¥–∞:', error);
            }
        }
        
        // –ó–∞–≥—Ä—É–∑–∫–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
        async function loadStatistics() {
            try {
                // –û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
                const { count: totalUsers, error: usersError } = await supabase
                    .from('users')
                    .select('*', { count: 'exact', head: true })
                    .neq('role', 'admin');
                
                if (!usersError) {
                    document.getElementById('totalUsers').textContent = totalUsers;
                }
                
                // –û–±—â–∞—è –∑–∞–¥–æ–ª–∂–µ–Ω–Ω–æ—Å—Ç—å
                const { data: balances, error: balancesError } = await supabase
                    .from('user_balance')
                    .select('total_debt');
                
                if (!balancesError && balances) {
                    const totalDebt = balances.reduce((sum, balance) => sum + (balance.total_debt || 0), 0);
                    document.getElementById('totalDebt').textContent = totalDebt.toFixed(2) + ' ‚ÇΩ';
                    
                    const electricityDebt = balances.reduce((sum, balance) => sum + (balance.electricity_debt || 0), 0);
                    document.getElementById('electricityDebt').textContent = electricityDebt.toFixed(2) + ' ‚ÇΩ';
                    
                    const contributionsDebt = balances.reduce((sum, balance) => sum + (balance.contributions_debt || 0), 0);
                    document.getElementById('contributionsDebt').textContent = contributionsDebt.toFixed(2) + ' ‚ÇΩ';
                }
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏:', error);
            }
        }
        
        // –ó–∞–≥—Ä—É–∑–∫–∞ –ø–æ—Å–ª–µ–¥–Ω–∏—Ö –ø–æ–∫–∞–∑–∞–Ω–∏–π
        async function loadRecentReadings() {
            const { data, error } = await supabase
                .from('meter_readings')
                .select(`
                    *,
                    users:user_id (full_name, plot_number)
                `)
                .order('reading_date', { ascending: false })
                .limit(10);
            
            if (data) {
                const tbody = document.querySelector('#recentReadings tbody');
                tbody.innerHTML = data.map(reading => `
                    <tr>
                        <td>${reading.users?.plot_number || '-'}</td>
                        <td>${reading.users?.full_name || '-'}</td>
                        <td>${reading.reading.toFixed(2)} –∫–í—Ç¬∑—á</td>
                        <td>${new Date(reading.reading_date).toLocaleDateString()}</td>
                        <td>
                            ${reading.paid ? 
                                '<span class="paid-badge">–û–ø–ª–∞—á–µ–Ω–æ</span>' : 
                                '<span class="unpaid-badge">–ù–µ –æ–ø–ª–∞—á–µ–Ω–æ</span>'
                            }
                        </td>
                    </tr>
                `).join('');
            }
        }
        
        // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –≤–∫–ª–∞–¥–æ–∫
        function switchTab(tabName) {
            // –£–±–∏—Ä–∞–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π –∫–ª–∞—Å—Å —É –≤—Å–µ—Ö –≤–∫–ª–∞–¥–æ–∫
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // –°–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –≤–∫–ª–∞–¥–æ–∫
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            
            // –ê–∫—Ç–∏–≤–∏—Ä—É–µ–º –≤—ã–±—Ä–∞–Ω–Ω—É—é –≤–∫–ª–∞–¥–∫—É
            document.querySelectorAll('.tab').forEach((tab, index) => {
                if (tab.textContent.includes(getTabTitle(tabName))) {
                    tab.classList.add('active');
                }
            });
            
            document.getElementById(tabName + 'Tab').classList.add('active');
            
            // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è –≤—ã–±—Ä–∞–Ω–Ω–æ–π –≤–∫–ª–∞–¥–∫–∏
            switch(tabName) {
                case 'users':
                    loadUsers();
                    break;
                case 'meters':
                    loadMeterReadings();
                    break;
                case 'contributions':
                    loadContributions();
                    break;
                case 'tariffs':
                    loadTariffs();
                    break;
            }
        }
        
        // –ü–æ–ª—É—á–µ–Ω–∏–µ –∑–∞–≥–æ–ª–æ–≤–∫–∞ –≤–∫–ª–∞–¥–∫–∏
        function getTabTitle(tabName) {
            const titles = {
                'dashboard': '–î–∞—à–±–æ—Ä–¥',
                'users': '–£—á–∞—Å—Ç–Ω–∏–∫–∏',
                'meters': '–ü–æ–∫–∞–∑–∞–Ω–∏—è',
                'contributions': '–í–∑–Ω–æ—Å—ã',
                'tariffs': '–¢–∞—Ä–∏—Ñ—ã',
                'import': '–ò–º–ø–æ—Ä—Ç/–≠–∫—Å–ø–æ—Ä—Ç',
                'settings': '–ù–∞—Å—Ç—Ä–æ–π–∫–∏'
            };
            return titles[tabName] || tabName;
        }
        
        // –ó–∞–≥—Ä—É–∑–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
        async function loadUsers() {
            try {
                const { data, error } = await supabase
                    .from('users')
                    .select('*')
                    .neq('role', 'admin')
                    .order('plot_number');
                
                if (error) throw error;
                
                const tbody = document.querySelector('#usersTable tbody');
                if (data.length === 0) {
                    tbody.innerHTML = `
                        <tr>
                            <td colspan="8" style="text-align: center; padding: 40px;">
                                –ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –æ–± —É—á–∞—Å—Ç–Ω–∏–∫–∞—Ö
                            </td>
                        </tr>
                    `;
                    return;
                }
                
                tbody.innerHTML = data.map(user => `
                    <tr>
                        <td>${user.id.substring(0, 8)}...</td>
                        <td>${user.plot_number}</td>
                        <td>${user.full_name}</td>
                        <td>${user.username}</td>
                        <td>${user.phone || '-'}</td>
                        <td>${user.email || '-'}</td>
                        <td>${user.balance || 0} ‚ÇΩ</td>
                        <td class="action-buttons">
                            <button class="action-btn edit-btn" onclick="editUser('${user.id}')">‚úèÔ∏è</button>
                            <button class="action-btn delete-btn" onclick="deleteUser('${user.id}')">üóëÔ∏è</button>
                        </td>
                    </tr>
                `).join('');
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π:', error);
                showMessage('usersMessage', '–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π', 'error');
            }
        }
        
        // –ü–æ–∏—Å–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
        function searchUsers() {
            const searchTerm = document.getElementById('userSearch').value.toLowerCase();
            const rows = document.querySelectorAll('#usersTable tbody tr');
            
            rows.forEach(row => {
                const text = row.textContent.toLowerCase();
                row.style.display = text.includes(searchTerm) ? '' : 'none';
            });
        }
        
        // –ü–æ–∫–∞–∑–∞—Ç—å —Ñ–æ—Ä–º—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        function showUserForm(userId = null) {
            const form = document.getElementById('userForm');
            const title = document.getElementById('userFormTitle');
            
            if (userId) {
                title.textContent = '–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —É—á–∞—Å—Ç–Ω–∏–∫–∞';
                // –ó–¥–µ—Å—å –±—ã –∑–∞–≥—Ä—É–∂–∞–ª–∏—Å—å –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            } else {
                title.textContent = '–î–æ–±–∞–≤–ª–µ–Ω–∏–µ —É—á–∞—Å—Ç–Ω–∏–∫–∞';
                document.getElementById('userFormData').reset();
            }
            
            form.style.display = 'block';
            form.scrollIntoView({ behavior: 'smooth' });
        }
        
        // –°–∫—Ä—ã—Ç—å —Ñ–æ—Ä–º—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        function hideUserForm() {
            document.getElementById('userForm').style.display = 'none';
        }
        
        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        async function saveUser(event) {
            event.preventDefault();
            
            const userData = {
                plot_number: document.getElementById('plotNumber').value,
                full_name: document.getElementById('fullName').value,
                username: document.getElementById('username').value,
                password: document.getElementById('password').value,
                phone: document.getElementById('phone').value,
                email: document.getElementById('email').value,
                area: parseFloat(document.getElementById('area').value) || null,
                notes: document.getElementById('notes').value,
                role: 'user',
                created_at: new Date().toISOString()
            };
            
            try {
                const { error } = await supabase
                    .from('users')
                    .insert([userData]);
                
                if (error) throw error;
                
                showMessage('usersMessage', '–£—á–∞—Å—Ç–Ω–∏–∫ —É—Å–ø–µ—à–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω!', 'success');
                hideUserForm();
                loadUsers();
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:', error);
                showMessage('usersMessage', '–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è', 'error');
            }
        }
        
        // –ó–∞–≥—Ä—É–∑–∫–∞ –ø–æ–∫–∞–∑–∞–Ω–∏–π —Å—á–µ—Ç—á–∏–∫–æ–≤
        async function loadMeterReadings() {
            try {
                const { data, error } = await supabase
                    .from('meter_readings')
                    .select(`
                        *,
                        users:user_id (full_name, plot_number)
                    `)
                    .order('reading_date', { ascending: false })
                    .limit(100);
                
                if (error) throw error;
                
                const tbody = document.querySelector('#metersTable tbody');
                if (data.length === 0) {
                    tbody.innerHTML = `
                        <tr>
                            <td colspan="9" style="text-align: center; padding: 40px;">
                                –ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –æ –ø–æ–∫–∞–∑–∞–Ω–∏—è—Ö
                            </td>
                        </tr>
                    `;
                    return;
                }
                
                tbody.innerHTML = data.map(reading => `
                    <tr>
                        <td>${reading.id.substring(0, 8)}...</td>
                        <td>${reading.users?.plot_number || '-'}</td>
                        <td>${reading.users?.full_name || '-'}</td>
                        <td>${new Date(reading.reading_date).toLocaleDateString()}</td>
                        <td>${reading.reading.toFixed(2)} –∫–í—Ç¬∑—á</td>
                        <td>${reading.consumption ? reading.consumption.toFixed(2) + ' –∫–í—Ç¬∑—á' : '-'}</td>
                        <td>${reading.amount ? reading.amount.toFixed(2) + ' ‚ÇΩ' : '-'}</td>
                        <td>
                            ${reading.paid ? 
                                '<span class="paid-badge">–û–ø–ª–∞—á–µ–Ω–æ</span>' : 
                                '<span class="unpaid-badge">–ù–µ –æ–ø–ª–∞—á–µ–Ω–æ</span>'
                            }
                        </td>
                        <td class="action-buttons">
                            <button class="action-btn edit-btn" onclick="editMeterReading('${reading.id}')">‚úèÔ∏è</button>
                            <button class="action-btn delete-btn" onclick="deleteMeterReading('${reading.id}')">üóëÔ∏è</button>
                        </td>
                    </tr>
                `).join('');
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø–æ–∫–∞–∑–∞–Ω–∏–π:', error);
                showMessage('metersMessage', '–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø–æ–∫–∞–∑–∞–Ω–∏–π', 'error');
            }
        }
        
        // –ó–∞–≥—Ä—É–∑–∫–∞ –≤–∑–Ω–æ—Å–æ–≤
        async function loadContributions() {
            try {
                const { data, error } = await supabase
                    .from('contributions')
                    .select(`
                        *,
                        users:user_id (full_name, plot_number)
                    `)
                    .order('due_date', { ascending: false })
                    .limit(100);
                
                if (error) throw error;
                
                displayContributions(data);
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –≤–∑–Ω–æ—Å–æ–≤:', error);
                showMessage('contributionsMessage', '–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –≤–∑–Ω–æ—Å–æ–≤', 'error');
            }
        }
        
        // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤–∑–Ω–æ—Å–æ–≤
        function displayContributions(data) {
            const tbody = document.querySelector('#contributionsTable tbody');
            
            if (!data || data.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="9" style="text-align: center; padding: 40px;">
                            –ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –æ –≤–∑–Ω–æ—Å–∞—Ö
                        </td>
                    </tr>
                `;
                return;
            }
            
            tbody.innerHTML = data.map(contribution => `
                <tr>
                    <td>${contribution.id.substring(0, 8)}...</td>
                    <td>${contribution.users?.plot_number || '-'}</td>
                    <td>${contribution.users?.full_name || '-'}</td>
                    <td>${getContributionType(contribution.type)}</td>
                    <td>${contribution.amount.toFixed(2)} ‚ÇΩ</td>
                    <td>${new Date(contribution.created_at).toLocaleDateString()}</td>
                    <td>${new Date(contribution.due_date).toLocaleDateString()}</td>
                    <td>
                        ${contribution.paid ? 
                            '<span class="paid-badge">–û–ø–ª–∞—á–µ–Ω–æ</span>' : 
                            '<span class="unpaid-badge">–ù–µ –æ–ø–ª–∞—á–µ–Ω–æ</span>'
                        }
                    </td>
                    <td class="action-buttons">
                        <button class="action-btn edit-btn" onclick="editContribution('${contribution.id}')">‚úèÔ∏è</button>
                        <button class="action-btn delete-btn" onclick="deleteContribution('${contribution.id}')">üóëÔ∏è</button>
                    </td>
                </tr>
            `).join('');
        }
        
        // –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –≤–∑–Ω–æ—Å–æ–≤
        function filterContributions() {
            const typeFilter = document.getElementById('contributionTypeFilter').value;
            const statusFilter = document.getElementById('contributionStatusFilter').value;
            const monthFilter = document.getElementById('contributionMonthFilter').value;
            
            // –í —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –∑–¥–µ—Å—å –±—ã–ª –±—ã –∑–∞–ø—Ä–æ—Å —Å —Ñ–∏–ª—å—Ç—Ä–∞–º–∏
            loadContributions(); // –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º –≤—Å–µ –¥–ª—è –ø—Ä–æ—Å—Ç–æ—Ç—ã
        }
        
        // –ó–∞–≥—Ä—É–∑–∫–∞ —Ç–∞—Ä–∏—Ñ–æ–≤
        async function loadTariffs() {
            try {
                // –¢–µ–∫—É—â–∏–µ —Ç–∞—Ä–∏—Ñ—ã
                const { data: current, error: currentError } = await supabase
                    .from('tariffs')
                    .select('*')
                    .order('valid_from', { ascending: false })
                    .limit(1);
                
                if (!currentError && current && current.length > 0) {
                    const tariff = current[0];
                    document.getElementById('currentTariffs').innerHTML = `
                        <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px;">
                            <div style="text-align: center; padding: 20px; background: #f8f9fa; border-radius: 8px;">
                                <div style="font-size: 24px; font-weight: bold; color: #667eea;">
                                    ${tariff.rate1} ‚ÇΩ
                                </div>
                                <div style="font-size: 14px; color: #666;">
                                    –¥–æ 100 –∫–í—Ç¬∑—á
                                </div>
                            </div>
                            <div style="text-align: center; padding: 20px; background: #f8f9fa; border-radius: 8px;">
                                <div style="font-size: 24px; font-weight: bold; color: #764ba2;">
                                    ${tariff.rate2} ‚ÇΩ
                                </div>
                                <div style="font-size: 14px; color: #666;">
                                    —Å–≤—ã—à–µ 100 –∫–í—Ç¬∑—á
                                </div>
                            </div>
                            <div style="text-align: center; padding: 20px; background: #f8f9fa; border-radius: 8px;">
                                <div style="font-size: 24px; font-weight: bold; color: #4facfe;">
                                    ${tariff.rate_common} ‚ÇΩ
                                </div>
                                <div style="font-size: 14px; color: #666;">
                                    –æ–±—â–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –Ω—É–∂–¥—ã
                                </div>
                            </div>
                        </div>
                        <p style="margin-top: 15px; color: #666;">
                            –î–µ–π—Å—Ç–≤—É—é—Ç —Å ${new Date(tariff.valid_from).toLocaleDateString()}
                        </p>
                    `;
                }
                
                // –ò—Å—Ç–æ—Ä–∏—è —Ç–∞—Ä–∏—Ñ–æ–≤
                const { data: history, error: historyError } = await supabase
                    .from('tariffs')
                    .select('*')
                    .order('valid_from', { ascending: false })
                    .limit(10);
                
                if (!historyError && history) {
                    const tbody = document.querySelector('#tariffsHistory tbody');
                    tbody.innerHTML = history.map(tariff => `
                        <tr>
                            <td>${new Date(tariff.valid_from).toLocaleDateString()}</td>
                            <td>${tariff.rate1} ‚ÇΩ/–∫–í—Ç¬∑—á</td>
                            <td>${tariff.rate2} ‚ÇΩ/–∫–í—Ç¬∑—á</td>
                            <td>${tariff.rate_common} ‚ÇΩ/–∫–í—Ç¬∑—á</td>
                            <td>${tariff.comment || '-'}</td>
                        </tr>
                    `).join('');
                }
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ç–∞—Ä–∏—Ñ–æ–≤:', error);
                showMessage('tariffsMessage', '–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ç–∞—Ä–∏—Ñ–æ–≤', 'error');
            }
        }
        
        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ç–∞—Ä–∏—Ñ–æ–≤
        async function saveTariffs(event) {
            event.preventDefault();
            
            const tariffData = {
                rate1: parseFloat(document.getElementById('rate1').value),
                rate2: parseFloat(document.getElementById('rate2').value),
                rate_common: parseFloat(document.getElementById('rateCommon').value),
                valid_from: document.getElementById('validFrom').value,
                comment: document.getElementById('tariffComment').value,
                created_at: new Date().toISOString()
            };
            
            try {
                const { error } = await supabase
                    .from('tariffs')
                    .insert([tariffData]);
                
                if (error) throw error;
                
                showMessage('tariffsMessage', '–¢–∞—Ä–∏—Ñ—ã —É—Å–ø–µ—à–Ω–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã!', 'success');
                document.getElementById('tariffForm').reset();
                document.getElementById('validFrom').valueAsDate = new Date();
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ç–∞—Ä–∏—Ñ–æ–≤
                loadTariffs();
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Ç–∞—Ä–∏—Ñ–æ–≤:', error);
                showMessage('tariffsMessage', '–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Ç–∞—Ä–∏—Ñ–æ–≤', 'error');
            }
        }
        
        // –≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö
        async function exportData(type) {
            try {
                let data = [];
                let filename = '';
                
                switch(type) {
                    case 'users':
                        const { data: users } = await supabase
                            .from('users')
                            .select('*')
                            .neq('role', 'admin');
                        data = users;
                        filename = 'participants.csv';
                        break;
                        
                    case 'readings':
                        const { data: readings } = await supabase
                            .from('meter_readings')
                            .select('*');
                        data = readings;
                        filename = 'meter_readings.csv';
                        break;
                        
                    case 'contributions':
                        const { data: contributions } = await supabase
                            .from('contributions')
                            .select('*');
                        data = contributions;
                        filename = 'contributions.csv';
                        break;
                        
                    case 'all':
                        // –≠–∫—Å–ø–æ—Ä—Ç –≤—Å–µ—Ö –¥–∞–Ω–Ω—ã—Ö
                        filename = 'snt_backup.json';
                        const allData = {
                            timestamp: new Date().toISOString(),
                            users: (await supabase.from('users').select('*')).data,
                            readings: (await supabase.from('meter_readings').select('*')).data,
                            contributions: (await supabase.from('contributions').select('*')).data,
                            tariffs: (await supabase.from('tariffs').select('*')).data
                        };
                        data = [allData];
                        break;
                }
                
                if (type === 'all') {
                    // –≠–∫—Å–ø–æ—Ä—Ç –≤ JSON
                    const json = JSON.stringify(data[0], null, 2);
                    downloadFile(json, filename, 'application/json');
                } else {
                    // –≠–∫—Å–ø–æ—Ä—Ç –≤ CSV
                    const csv = convertToCSV(data);
                    downloadFile(csv, filename, 'text/csv');
                }
                
                showMessage('importMessage', `–î–∞–Ω–Ω—ã–µ —É—Å–ø–µ—à–Ω–æ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã –≤ ${filename}`, 'success');
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ —ç–∫—Å–ø–æ—Ä—Ç–∞ –¥–∞–Ω–Ω—ã—Ö:', error);
                showMessage('importMessage', '–û—à–∏–±–∫–∞ —ç–∫—Å–ø–æ—Ä—Ç–∞ –¥–∞–Ω–Ω—ã—Ö', 'error');
            }
        }
        
        // –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –≤ CSV
        function convertToCSV(data) {
            if (!data || data.length === 0) return '';
            
            const headers = Object.keys(data[0]);
            const rows = data.map(row => 
                headers.map(header => {
                    const value = row[header];
                    return typeof value === 'string' && value.includes(',') ? 
                        `"${value}"` : value;
                }).join(',')
            );
            
            return [headers.join(','), ...rows].join('\n');
        }
        
        // –°–∫–∞—á–∏–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–∞
        function downloadFile(content, filename, contentType) {
            const blob = new Blob([content], { type: contentType });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }
        
        // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –Ω–∞—á–∏—Å–ª–µ–Ω–∏–π
        async function generateInvoices() {
            try {
                showMessage('dashboardTab', '–ù–∞—á–∏–Ω–∞–µ–º —Ä–∞—Å—á–µ—Ç –Ω–∞—á–∏—Å–ª–µ–Ω–∏–π...', 'info');
                
                // –ü–æ–ª—É—á–∞–µ–º —Ç–µ–∫—É—â–∏–µ —Ç–∞—Ä–∏—Ñ—ã
                const { data: tariffs, error: tariffError } = await supabase
                    .from('tariffs')
                    .select('*')
                    .order('valid_from', { ascending: false })
                    .limit(1);
                
                if (tariffError || !tariffs || tariffs.length === 0) {
                    throw new Error('–ù–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã —Ç–∞—Ä–∏—Ñ—ã');
                }
                
                const tariff = tariffs[0];
                
                // –ü–æ–ª—É—á–∞–µ–º –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
                const { data: users, error: usersError } = await supabase
                    .from('users')
                    .select('*')
                    .neq('role', 'admin');
                
                if (usersError) throw usersError;
                
                // –î–ª—è –∫–∞–∂–¥–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è
                for (const user of users) {
                    await calculateUserCharges(user, tariff);
                }
                
                showMessage('dashboardTab', '–ù–∞—á–∏—Å–ª–µ–Ω–∏—è —É—Å–ø–µ—à–Ω–æ —Å—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω—ã!', 'success');
                
                // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
                await loadStatistics();
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –Ω–∞—á–∏—Å–ª–µ–Ω–∏–π:', error);
                showMessage('dashboardTab', '–û—à–∏–±–∫–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –Ω–∞—á–∏—Å–ª–µ–Ω–∏–π: ' + error.message, 'error');
            }
        }
        
        // –†–∞—Å—á–µ—Ç –Ω–∞—á–∏—Å–ª–µ–Ω–∏–π –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        async function calculateUserCharges(user, tariff) {
            try {
                // –ü–æ–ª—É—á–∞–µ–º –ø–æ—Å–ª–µ–¥–Ω–∏–µ –ø–æ–∫–∞–∑–∞–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                const { data: readings, error: readingsError } = await supabase
                    .from('meter_readings')
                    .select('*')
                    .eq('user_id', user.id)
                    .order('reading_date', { ascending: false })
                    .limit(2);
                
                if (readingsError) throw readingsError;
                
                if (readings.length < 2) {
                    console.log(`–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è ${user.full_name}`);
                    return;
                }
                
                const currentReading = readings[0];
                const previousReading = readings[1];
                
                // –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º –ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–µ
                const consumption = currentReading.reading - previousReading.reading;
                
                // –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º —Å—Ç–æ–∏–º–æ—Å—Ç—å –ø–æ —Å–ª–æ–∂–Ω–æ–º—É —Ç–∞—Ä–∏—Ñ—É
                let electricityCost = 0;
                if (consumption <= 100) {
                    electricityCost = consumption * tariff.rate1;
                } else {
                    electricityCost = (100 * tariff.rate1) + ((consumption - 100) * tariff.rate2);
                }
                
                // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—â–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –Ω—É–∂–¥—ã
                electricityCost += consumption * tariff.rate_common;
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –∑–∞–ø–∏—Å—å –ø–æ–∫–∞–∑–∞–Ω–∏–π
                await supabase
                    .from('meter_readings')
                    .update({
                        consumption: consumption,
                        amount: electricityCost,
                        calculated_at: new Date().toISOString()
                    })
                    .eq('id', currentReading.id);
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –±–∞–ª–∞–Ω—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                await updateUserBalance(user.id, electricityCost);
                
            } catch (error) {
                console.error(`–û—à–∏–±–∫–∞ —Ä–∞—Å—á–µ—Ç–∞ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è ${user.id}:`, error);
            }
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        async function updateUserBalance(userId, electricityAmount) {
            try {
                // –ü–æ–ª—É—á–∞–µ–º —Ç–µ–∫—É—â–∏–π –±–∞–ª–∞–Ω—Å
                const { data: balance, error: balanceError } = await supabase
                    .from('user_balance')
                    .select('*')
                    .eq('user_id', userId)
                    .single();
                
                const now = new Date().toISOString();
                
                if (balanceError || !balance) {
                    // –°–æ–∑–¥–∞–µ–º –Ω–æ–≤—É—é –∑–∞–ø–∏—Å—å –±–∞–ª–∞–Ω—Å–∞
                    await supabase
                        .from('user_balance')
                        .insert({
                            user_id: userId,
                            electricity_debt: electricityAmount,
                            contributions_debt: 0,
                            total_debt: electricityAmount,
                            last_update: now
                        });
                } else {
                    // –û–±–Ω–æ–≤–ª—è–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é –∑–∞–ø–∏—Å—å
                    await supabase
                        .from('user_balance')
                        .update({
                            electricity_debt: (balance.electricity_debt || 0) + electricityAmount,
                            total_debt: (balance.total_debt || 0) + electricityAmount,
                            last_update: now
                        })
                        .eq('user_id', userId);
                }
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –±–∞–ª–∞–Ω—Å–∞:', error);
            }
        }
        
        // –ü–æ–ª—É—á–µ–Ω–∏–µ —Ç–∏–ø–∞ –≤–∑–Ω–æ—Å–∞
        function getContributionType(type) {
            const types = {
                'salary': '1. –ó–∞—Ä–ø–ª–∞—Ç–∞',
                'maintenance': '2. –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ',
                'other': '3. –ü—Ä–æ—á–µ–µ'
            };
            return types[type] || type;
        }
        
        // –ü–æ–∫–∞–∑ —Å–æ–æ–±—â–µ–Ω–∏–π
        function showMessage(tabId, text, type) {
            const element = document.getElementById(tabId).querySelector('.message') || 
                           document.getElementById(tabId + 'Message');
            if (element) {
                element.textContent = text;
                element.className = `message ${type}`;
                element.style.display = 'block';
                
                setTimeout(() => {
                    element.style.display = 'none';
                }, 5000);
            }
        }
        
        // –í—ã—Ö–æ–¥ –∏–∑ —Å–∏—Å—Ç–µ–º—ã
        function logout() {
            localStorage.removeItem('user');
            window.location.href = 'index.html';
        }
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        document.addEventListener('DOMContentLoaded', initializePage);
    </script>
    
    <!-- –ü–æ–¥–∫–ª—é—á–∞–µ–º Supabase -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</body>
</html>
