<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>СНТ "Звездочка" - Админ-панель</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f5f7fa;
            color: #333;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }
        
        /* Header */
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 0;
            border-bottom: 1px solid #ddd;
            margin-bottom: 30px;
        }
        
        .logo {
            font-size: 1.8rem;
            color: #2c3e50;
        }
        
        .logo span {
            color: #e74c3c;
        }
        
        .admin-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .admin-name {
            font-weight: 600;
            color: #2c3e50;
        }
        
        .btn-logout {
            padding: 8px 16px;
            background-color: #e74c3c;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: 500;
            transition: background-color 0.3s;
        }
        
        .btn-logout:hover {
            background-color: #c0392b;
        }
        
        /* Dashboard Stats */
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background-color: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
            display: flex;
            flex-direction: column;
        }
        
        .stat-title {
            font-size: 0.9rem;
            color: #7f8c8d;
            margin-bottom: 10px;
        }
        
        .stat-value {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 5px;
        }
        
        .stat-trend {
            font-size: 0.9rem;
            display: flex;
            align-items: center;
        }
        
        .trend-up {
            color: #2ecc71;
        }
        
        .trend-down {
            color: #e74c3c;
        }
        
        /* Main Content */
        .main-content {
            display: grid;
            grid-template-columns: 250px 1fr;
            gap: 30px;
        }
        
        @media (max-width: 992px) {
            .main-content {
                grid-template-columns: 1fr;
            }
        }
        
        /* Sidebar */
        .sidebar {
            background-color: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
            height: fit-content;
        }
        
        .sidebar-title {
            font-size: 1.2rem;
            color: #2c3e50;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 1px solid #eee;
        }
        
        .sidebar-menu {
            list-style-type: none;
        }
        
        .menu-item {
            padding: 12px 15px;
            margin-bottom: 8px;
            border-radius: 8px;
            cursor: pointer;
            transition: background-color 0.3s;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .menu-item:hover {
            background-color: #f8f9fa;
        }
        
        .menu-item.active {
            background-color: #3498db;
            color: white;
        }
        
        /* Content Area */
        .content-area {
            background-color: white;
            border-radius: 10px;
            padding: 25px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
            min-height: 500px;
        }
        
        .content-title {
            font-size: 1.4rem;
            color: #2c3e50;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 1px solid #eee;
        }
        
        /* Table */
        .table-container {
            overflow-x: auto;
            margin-bottom: 20px;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
        }
        
        th, td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid #eee;
        }
        
        th {
            background-color: #f8f9fa;
            font-weight: 600;
            color: #2c3e50;
            position: sticky;
            top: 0;
        }
        
        tr:hover {
            background-color: #f8f9fa;
        }
        
        .action-buttons {
            display: flex;
            gap: 5px;
        }
        
        .btn-icon {
            padding: 6px 10px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.9rem;
            transition: background-color 0.3s;
        }
        
        .btn-edit {
            background-color: #3498db;
            color: white;
        }
        
        .btn-edit:hover {
            background-color: #2980b9;
        }
        
        .btn-delete {
            background-color: #e74c3c;
            color: white;
        }
        
        .btn-delete:hover {
            background-color: #c0392b;
        }
        
        /* Forms */
        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: #2c3e50;
        }
        
        input, select, textarea {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s;
        }
        
        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #3498db;
        }
        
        textarea {
            min-height: 120px;
            resize: vertical;
        }
        
        .btn {
            padding: 12px 20px;
            background-color: #3498db;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        
        .btn:hover {
            background-color: #2980b9;
        }
        
        .btn-block {
            width: 100%;
            padding: 14px;
        }
        
        .btn-success {
            background-color: #2ecc71;
        }
        
        .btn-success:hover {
            background-color: #27ae60;
        }
        
        .btn-secondary {
            background-color: #7f8c8d;
        }
        
        .btn-secondary:hover {
            background-color: #636e72;
        }
        
        /* Tabs */
        .content-tabs {
            display: flex;
            border-bottom: 1px solid #ddd;
            margin-bottom: 20px;
        }
        
        .content-tab {
            padding: 12px 20px;
            cursor: pointer;
            font-weight: 500;
            color: #7f8c8d;
            transition: all 0.3s;
            border-bottom: 3px solid transparent;
        }
        
        .content-tab.active {
            color: #3498db;
            border-bottom-color: #3498db;
        }
        
        .tab-panel {
            display: none;
        }
        
        .tab-panel.active {
            display: block;
        }
        
        /* File Upload */
        .file-upload {
            border: 2px dashed #ddd;
            border-radius: 8px;
            padding: 40px 20px;
            text-align: center;
            margin-bottom: 20px;
            transition: border-color 0.3s;
        }
        
        .file-upload:hover {
            border-color: #3498db;
        }
        
        .file-upload input {
            display: none;
        }
        
        .upload-label {
            display: inline-block;
            padding: 12px 20px;
            background-color: #3498db;
            color: white;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
            transition: background-color 0.3s;
        }
        
        .upload-label:hover {
            background-color: #2980b9;
        }
        
        /* Message */
        .message {
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 20px;
            text-align: center;
            display: none;
        }
        
        .success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        /* Footer */
        .footer {
            text-align: center;
            margin-top: 50px;
            padding-top: 20px;
            border-top: 1px solid #ddd;
            color: #7f8c8d;
            font-size: 0.9rem;
        }
        
        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }
        
        .modal-content {
            background-color: white;
            border-radius: 10px;
            padding: 30px;
            max-width: 600px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .modal-title {
            font-size: 1.4rem;
            color: #2c3e50;
        }
        
        .modal-close {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: #7f8c8d;
        }
        
        /* Search and Filters */
        .search-container {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .search-input {
            flex: 1;
        }
        
        .filter-select {
            width: 200px;
        }
        
        /* Mobile */
        @media (max-width: 768px) {
            .admin-info {
                display: none;
            }
            
            .stats {
                grid-template-columns: 1fr;
            }
            
            .search-container {
                flex-direction: column;
            }
            
            .filter-select {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <div>
                <h1 class="logo">СНТ "<span>Звездочка</span>"</h1>
                <p>Админ-панель</p>
            </div>
            
            <div class="admin-info">
                <div>
                    <div class="admin-name" id="adminName">Администратор</div>
                    <div id="adminEmail">admin@snt-zvezdochka.ru</div>
                </div>
                <button class="btn-logout" id="logoutBtn">Выйти</button>
            </div>
        </div>
        
        <!-- Dashboard Stats -->
        <div class="stats">
            <div class="stat-card">
                <div class="stat-title">Всего пользователей</div>
                <div class="stat-value" id="totalUsers">187</div>
                <div class="stat-trend trend-up">+5 за месяц</div>
            </div>
            
            <div class="stat-card">
                <div class="stat-title">Неоплаченные взносы</div>
                <div class="stat-value" id="unpaidFees">124,560 ₽</div>
                <div class="stat-trend trend-down">-12% за месяц</div>
            </div>
            
            <div class="stat-card">
                <div class="stat-title">Передано показаний</div>
                <div class="stat-value" id="submittedReadings">165</div>
                <div class="stat-trend trend-up">+23 за неделю</div>
            </div>
            
            <div class="stat-card">
                <div class="stat-title">Общее потребление</div>
                <div class="stat-value" id="totalConsumption">15,678 кВт·ч</div>
                <div class="stat-trend trend-down">-5% к прошлому месяцу</div>
            </div>
        </div>
        
        <!-- Main Content -->
        <div class="main-content">
            <!-- Sidebar -->
            <div class="sidebar">
                <h2 class="sidebar-title">Управление</h2>
                <ul class="sidebar-menu">
                    <li class="menu-item active" data-section="dashboard">
                        <span>📊</span> Дашборд
                    </li>
                    <li class="menu-item" data-section="users">
                        <span>👥</span> Пользователи
                    </li>
                    <li class="menu-item" data-section="meters">
                        <span>🔢</span> Счетчики
                    </li>
                    <li class="menu-item" data-section="readings">
                        <span>📈</span> Показания
                    </li>
                    <li class="menu-item" data-section="fees">
                        <span>💰</span> Взносы
                    </li>
                    <li class="menu-item" data-section="tariffs">
                        <span>📋</span> Тарифы
                    </li>
                    <li class="menu-item" data-section="import">
                        <span>📥</span> Импорт данных
                    </li>
                    <li class="menu-item" data-section="export">
                        <span>📤</span> Экспорт данных
                    </li>
                    <li class="menu-item" data-section="common">
                        <span>🏘️</span> Общее потребление
                    </li>
                </ul>
            </div>
            
            <!-- Content Area -->
            <div class="content-area">
                <!-- Dashboard -->
                <div id="dashboardSection" class="content-section active">
                    <h2 class="content-title">Дашборд</h2>
                    
                    <div class="message" id="dashboardMessage"></div>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 30px; margin-bottom: 30px;">
                        <div>
                            <h3 style="margin-bottom: 15px; color: #2c3e50;">Быстрые действия</h3>
                            <div style="display: flex; flex-direction: column; gap: 10px;">
                                <button class="btn" onclick="showSection('users')">Добавить пользователя</button>
                                <button class="btn btn-success" onclick="showSection('readings')">Внести показания</button>
                                <button class="btn btn-secondary" onclick="showSection('import')">Импорт данных</button>
                            </div>
                        </div>
                        
                        <div>
                            <h3 style="margin-bottom: 15px; color: #2c3e50;">Статус системы</h3>
                            <div style="background-color: #f8f9fa; padding: 15px; border-radius: 8px;">
                                <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                                    <span>База данных:</span>
                                    <span style="color: #2ecc71; font-weight: 600;">✔ Активна</span>
                                </div>
                                <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                                    <span>Пользователи онлайн:</span>
                                    <span style="font-weight: 600;">12</span>
                                </div>
                                <div style="display: flex; justify-content: space-between;">
                                    <span>Последнее обновление:</span>
                                    <span id="lastUpdateTime">Сегодня, 10:30</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <h3 style="margin-bottom: 15px; color: #2c3e50;">Недавняя активность</h3>
                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>Время</th>
                                    <th>Пользователь</th>
                                    <th>Действие</th>
                                    <th>Детали</th>
                                </tr>
                            </thead>
                            <tbody id="activityTable">
                                <!-- Данные загрузятся через JS -->
                            </tbody>
                        </table>
                    </div>
                </div>
                
                <!-- Users Management -->
                <div id="usersSection" class="content-section">
                    <h2 class="content-title">Управление пользователями</h2>
                    
                    <div class="message" id="usersMessage"></div>
                    
                    <div class="search-container">
                        <input type="text" class="search-input" id="userSearch" placeholder="Поиск по имени или email...">
                        <select class="filter-select" id="userFilter">
                            <option value="all">Все пользователи</option>
                            <option value="active">Активные</option>
                            <option value="inactive">Неактивные</option>
                        </select>
                        <button class="btn" id="addUserBtn">Добавить пользователя</button>
                    </div>
                    
                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>ФИО</th>
                                    <th>Email</th>
                                    <th>Телефон</th>
                                    <th>Роль</th>
                                    <th>Дата регистрации</th>
                                    <th>Действия</th>
                                </tr>
                            </thead>
                            <tbody id="usersTable">
                                <!-- Данные загрузятся через JS -->
                            </tbody>
                        </table>
                    </div>
                </div>
                
                <!-- Meters Management -->
                <div id="metersSection" class="content-section">
                    <h2 class="content-title">Управление счетчиками</h2>
                    
                    <div class="message" id="metersMessage"></div>
                    
                    <div class="search-container">
                        <input type="text" class="search-input" id="meterSearch" placeholder="Поиск по номеру счетчика...">
                        <select class="filter-select" id="meterFilter">
                            <option value="all">Все счетчики</option>
                            <option value="active">Активные</option>
                            <option value="inactive">Неактивные</option>
                        </select>
                        <button class="btn" id="addMeterBtn">Добавить счетчик</button>
                    </div>
                    
                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>Номер счетчика</th>
                                    <th>Владелец</th>
                                    <th>Тип</th>
                                    <th>Дата установки</th>
                                    <th>Статус</th>
                                    <th>Последние показания</th>
                                    <th>Действия</th>
                                </tr>
                            </thead>
                            <tbody id="metersTable">
                                <!-- Данные загрузятся через JS -->
                            </tbody>
                        </table>
                    </div>
                </div>
                
                <!-- Readings Management -->
                <div id="readingsSection" class="content-section">
                    <h2 class="content-title">Управление показаниями</h2>
                    
                    <div class="content-tabs">
                        <div class="content-tab active" data-tab="addReadings">Добавить показания</div>
                        <div class="content-tab" data-tab="viewReadings">Просмотр показаний</div>
                        <div class="content-tab" data-tab="bulkReadings">Пакетное добавление</div>
                    </div>
                    
                    <div class="message" id="readingsMessage"></div>
                    
                    <!-- Add Readings Tab -->
                    <div id="addReadingsTab" class="tab-panel active">
                        <form id="addReadingForm">
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="readingUser">Пользователь</label>
                                    <select id="readingUser" required>
                                        <option value="">Выберите пользователя</option>
                                        <!-- Опции загрузятся через JS -->
                                    </select>
                                </div>
                                
                                <div class="form-group">
                                    <label for="readingMeter">Счетчик</label>
                                    <select id="readingMeter" required>
                                        <option value="">Выберите счетчик</option>
                                        <!-- Опции загрузятся через JS -->
                                    </select>
                                </div>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="readingMonth">Месяц</label>
                                    <select id="readingMonth" required>
                                        <option value="">Выберите месяц</option>
                                        <option value="1">Январь</option>
                                        <option value="2">Февраль</option>
                                        <option value="3">Март</option>
                                        <option value="4">Апрель</option>
                                        <option value="5">Май</option>
                                        <option value="6">Июнь</option>
                                        <option value="7">Июль</option>
                                        <option value="8">Август</option>
                                        <option value="9">Сентябрь</option>
                                        <option value="10">Октябрь</option>
                                        <option value="11">Ноябрь</option>
                                        <option value="12">Декабрь</option>
                                    </select>
                                </div>
                                
                                <div class="form-group">
                                    <label for="readingYear">Год</label>
                                    <input type="number" id="readingYear" min="2023" max="2030" value="2024" required>
                                </div>
                                
                                <div class="form-group">
                                    <label for="readingValue">Показания (кВт·ч)</label>
                                    <input type="number" id="readingValue" step="0.01" min="0" required>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <button type="submit" class="btn btn-block">Добавить показания</button>
                            </div>
                        </form>
                    </div>
                    
                    <!-- View Readings Tab -->
                    <div id="viewReadingsTab" class="tab-panel">
                        <div class="search-container">
                            <input type="text" class="search-input" id="readingsSearch" placeholder="Поиск по пользователю или счетчику...">
                            <select class="filter-select" id="readingsMonthFilter">
                                <option value="all">Все месяцы</option>
                                <option value="1">Январь</option>
                                <option value="2">Февраль</option>
                                <option value="3">Март</option>
                                <option value="4">Апрель</option>
                                <option value="5">Май</option>
                                <option value="6">Июнь</option>
                                <option value="7">Июль</option>
                                <option value="8">Август</option>
                                <option value="9">Сентябрь</option>
                                <option value="10">Октябрь</option>
                                <option value="11">Ноябрь</option>
                                <option value="12">Декабрь</option>
                            </select>
                            <select class="filter-select" id="readingsYearFilter">
                                <option value="2024">2024</option>
                                <option value="2023">2023</option>
                                <option value="2022">2022</option>
                            </select>
                        </div>
                        
                        <div class="table-container">
                            <table>
                                <thead>
                                    <tr>
                                        <th>Пользователь</th>
                                        <th>Счетчик</th>
                                        <th>Месяц/Год</th>
                                        <th>Показания</th>
                                        <th>Дата передачи</th>
                                        <th>Действия</th>
                                    </tr>
                                </thead>
                                <tbody id="readingsTable">
                                    <!-- Данные загрузятся через JS -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                    
                    <!-- Bulk Readings Tab -->
                    <div id="bulkReadingsTab" class="tab-panel">
                        <div class="file-upload">
                            <input type="file" id="bulkReadingsFile" accept=".csv, .xlsx, .xls">
                            <label for="bulkReadingsFile" class="upload-label">Выберите файл для импорта</label>
                            <p style="margin-top: 10px; color: #7f8c8d;">Поддерживаемые форматы: CSV, Excel</p>
                        </div>
                        
                        <div style="margin-bottom: 20px;">
                            <h4>Шаблон для заполнения:</h4>
                            <p style="color: #7f8c8d; margin-bottom: 10px;">Скачайте шаблон, заполните его и загрузите обратно</p>
                            <button class="btn btn-secondary" id="downloadTemplateBtn">Скачать шаблон CSV</button>
                        </div>
                        
                        <div>
                            <h4>Инструкция:</h4>
                            <ol style="padding-left: 20px; color: #7f8c8d;">
                                <li>Скачайте шаблон CSV</li>
                                <li>Заполните его данными (ID счетчика, месяц, год, показания)</li>
                                <li>Загрузите заполненный файл</li>
                                <li>Проверьте данные перед сохранением</li>
                            </ol>
                        </div>
                    </div>
                </div>
                
                <!-- Fees Management -->
                <div id="feesSection" class="content-section">
                    <h2 class="content-title">Управление членскими взносами</h2>
                    
                    <div class="content-tabs">
                        <div class="content-tab active" data-tab="manageFees">Назначить взносы</div>
                        <div class="content-tab" data-tab="viewFees">Просмотр взносов</div>
                    </div>
                    
                    <div class="message" id="feesMessage"></div>
                    
                    <!-- Manage Fees Tab -->
                    <div id="manageFeesTab" class="tab-panel active">
                        <form id="manageFeesForm">
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="feeType">Тип взноса</label>
                                    <select id="feeType" required>
                                        <option value="salary">Зарплата председателя</option>
                                        <option value="maintenance">Содержание территории</option>
                                        <option value="other">Прочие расходы</option>
                                    </select>
                                </div>
                                
                                <div class="form-group">
                                    <label for="feeAmount">Сумма (₽)</label>
                                    <input type="number" id="feeAmount" step="0.01" min="0" required>
                                </div>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="feeMonth">Месяц</label>
                                    <select id="feeMonth" required>
                                        <option value="">Выберите месяц</option>
                                        <option value="1">Январь</option>
                                        <option value="2">Февраль</option>
                                        <option value="3">Март</option>
                                        <option value="4">Апрель</option>
                                        <option value="5">Май</option>
                                        <option value="6">Июнь</option>
                                        <option value="7">Июль</option>
                                        <option value="8">Август</option>
                                        <option value="9">Сентябрь</option>
                                        <option value="10">Октябрь</option>
                                        <option value="11">Ноябрь</option>
                                        <option value="12">Декабрь</option>
                                    </select>
                                </div>
                                
                                <div class="form-group">
                                    <label for="feeYear">Год</label>
                                    <input type="number" id="feeYear" min="2023" max="2030" value="2024" required>
                                </div>
                                
                                <div class="form-group">
                                    <label for="feeDueDate">Срок оплаты</label>
                                    <input type="date" id="feeDueDate" required>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label>Применить к:</label>
                                <div style="display: flex; gap: 20px; margin-top: 10px;">
                                    <label style="display: flex; align-items: center; gap: 5px;">
                                        <input type="radio" name="feeScope" value="all" checked> Все пользователи
                                    </label>
                                    <label style="display: flex; align-items: center; gap: 5px;">
                                        <input type="radio" name="feeScope" value="selected"> Выбранным пользователям
                                    </label>
                                </div>
                            </div>
                            
                            <div class="form-group" id="selectedUsersContainer" style="display: none;">
                                <label>Выберите пользователей:</label>
                                <select id="selectedUsers" multiple style="height: 150px;">
                                    <!-- Опции загрузятся через JS -->
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <button type="submit" class="btn btn-block">Назначить взносы</button>
                            </div>
                        </form>
                    </div>
                    
                    <!-- View Fees Tab -->
                    <div id="viewFeesTab" class="tab-panel">
                        <div class="search-container">
                            <input type="text" class="search-input" id="feesSearch" placeholder="Поиск по пользователю...">
                            <select class="filter-select" id="feesStatusFilter">
                                <option value="all">Все статусы</option>
                                <option value="paid">Оплачено</option>
                                <option value="unpaid">Не оплачено</option>
                            </select>
                            <select class="filter-select" id="feesTypeFilter">
                                <option value="all">Все типы</option>
                                <option value="salary">Зарплата</option>
                                <option value="maintenance">Содержание</option>
                                <option value="other">Прочие</option>
                            </select>
                        </div>
                        
                        <div class="table-container">
                            <table>
                                <thead>
                                    <tr>
                                        <th>Пользователь</th>
                                        <th>Тип взноса</th>
                                        <th>Период</th>
                                        <th>Сумма</th>
                                        <th>Срок оплаты</th>
                                        <th>Статус</th>
                                        <th>Действия</th>
                                    </tr>
                                </thead>
                                <tbody id="feesTable">
                                    <!-- Данные загрузятся через JS -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
                
                <!-- Tariffs Management -->
                <div id="tariffsSection" class="content-section">
                    <h2 class="content-title">Управление тарифами</h2>
                    
                    <div class="message" id="tariffsMessage"></div>
                    
                    <div class="table-container" style="margin-bottom: 30px;">
                        <table>
                            <thead>
                                <tr>
                                    <th>Название тарифа</th>
                                    <th>До 100 кВт·ч</th>
                                    <th>Свыше 100 кВт·ч</th>
                                    <th>Общее потребление</th>
                                    <th>Дата начала</th>
                                    <th>Дата окончания</th>
                                    <th>Статус</th>
                                    <th>Действия</th>
                                </tr>
                            </thead>
                            <tbody id="tariffsTable">
                                <!-- Данные загрузятся через JS -->
                            </tbody>
                        </table>
                    </div>
                    
                    <h3 style="margin-bottom: 20px; color: #2c3e50;">Добавить новый тариф</h3>
                    <form id="addTariffForm">
                        <div class="form-row">
                            <div class="form-group">
                                <label for="tariffName">Название тарифа</label>
                                <input type="text" id="tariffName" required placeholder="Например: Основной тариф 2024">
                            </div>
                            
                            <div class="form-group">
                                <label for="tariffRate1">Тариф до 100 кВт·ч (₽/кВт·ч)</label>
                                <input type="number" id="tariffRate1" step="0.01" min="0" required>
                            </div>
                            
                            <div class="form-group">
                                <label for="tariffRate2">Тариф свыше 100 кВт·ч (₽/кВт·ч)</label>
                                <input type="number" id="tariffRate2" step="0.01" min="0" required>
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="tariffRateCommon">Тариф общее потребление (₽/кВт·ч)</label>
                                <input type="number" id="tariffRateCommon" step="0.01" min="0" required>
                            </div>
                            
                            <div class="form-group">
                                <label for="tariffStartDate">Дата начала действия</label>
                                <input type="date" id="tariffStartDate" required>
                            </div>
                            
                            <div class="form-group">
                                <label for="tariffEndDate">Дата окончания (необязательно)</label>
                                <input type="date" id="tariffEndDate">
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <button type="submit" class="btn btn-block">Добавить тариф</button>
                        </div>
                    </form>
                </div>
                
                <!-- Import Data -->
                <div id="importSection" class="content-section">
                    <h2 class="content-title">Импорт данных</h2>
                    
                    <div class="message" id="importMessage"></div>
                    
                    <div class="content-tabs">
                        <div class="content-tab active" data-tab="importUsers">Пользователи</div>
                        <div class="content-tab" data-tab="importMeters">Счетчики</div>
                        <div class="content-tab" data-tab="importReadings">Показания</div>
                        <div class="content-tab" data-tab="importFees">Взносы</div>
                    </div>
                    
                    <!-- Import Users Tab -->
                    <div id="importUsersTab" class="tab-panel active">
                        <div class="file-upload">
                            <input type="file" id="importUsersFile" accept=".csv, .xlsx, .xls">
                            <label for="importUsersFile" class="upload-label">Выберите файл для импорта пользователей</label>
                        </div>
                        
                        <div style="margin: 20px 0;">
                            <button class="btn btn-secondary" id="downloadUsersTemplateBtn">Скачать шаблон CSV</button>
                        </div>
                        
                        <div>
                            <h4>Предпросмотр данных:</h4>
                            <div class="table-container">
                                <table id="importUsersPreview">
                                    <thead>
                                        <tr>
                                            <th>ФИО</th>
                                            <th>Email</th>
                                            <th>Пароль</th>
                                            <th>Телефон</th>
                                            <th>Адрес</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <!-- Данные загрузятся через JS -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        
                        <div class="form-group" style="margin-top: 20px;">
                            <button class="btn btn-success" id="importUsersBtn" disabled>Импортировать пользователей</button>
                        </div>
                    </div>
                    
                    <!-- Other import tabs would be similar -->
                    
                </div>
                
                <!-- Export Data -->
                <div id="exportSection" class="content-section">
                    <h2 class="content-title">Экспорт данных</h2>
                    
                    <div class="message" id="exportMessage"></div>
                    
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; margin-bottom: 30px;">
                        <div class="stat-card">
                            <div class="stat-title">Экспорт пользователей</div>
                            <p style="margin-bottom: 15px;">Экспорт списка всех пользователей в CSV формате</p>
                            <button class="btn btn-block" id="exportUsersBtn">Экспорт CSV</button>
                        </div>
                        
                        <div class="stat-card">
                            <div class="stat-title">Экспорт показаний</div>
                            <p style="margin-bottom: 15px;">Экспорт показаний счетчиков за выбранный период</p>
                            <div class="form-row">
                                <div class="form-group" style="margin-bottom: 10px;">
                                    <select id="exportReadingsMonth">
                                        <option value="all">Все месяцы</option>
                                        <option value="1">Январь</option>
                                        <option value="2">Февраль</option>
                                        <option value="3">Март</option>
                                        <option value="4">Апрель</option>
                                        <option value="5">Май</option>
                                        <option value="6">Июнь</option>
                                        <option value="7">Июль</option>
                                        <option value="8">Август</option>
                                        <option value="9">Сентябрь</option>
                                        <option value="10">Октябрь</option>
                                        <option value="11">Ноябрь</option>
                                        <option value="12">Декабрь</option>
                                    </select>
                                </div>
                                <div class="form-group" style="margin-bottom: 10px;">
                                    <input type="number" id="exportReadingsYear" min="2023" max="2030" value="2024">
                                </div>
                            </div>
                            <button class="btn btn-block" id="exportReadingsBtn">Экспорт CSV</button>
                        </div>
                        
                        <div class="stat-card">
                            <div class="stat-title">Экспорт финансового отчета</div>
                            <p style="margin-bottom: 15px;">Экспорт данных по взносам и платежам</p>
                            <div class="form-row">
                                <div class="form-group" style="margin-bottom: 10px;">
                                    <select id="exportFeesMonth">
                                        <option value="all">Все месяцы</option>
                                        <option value="1">Январь</option>
                                        <option value="2">Февраль</option>
                                        <option value="3">Март</option>
                                        <option value="4">Апрель</option>
                                        <option value="5">Май</option>
                                        <option value="6">Июнь</option>
                                        <option value="7">Июль</option>
                                        <option value="8">Август</option>
                                        <option value="9">Сентябрь</option>
                                        <option value="10">Октябрь</option>
                                        <option value="11">Ноябрь</option>
                                        <option value="12">Декабрь</option>
                                    </select>
                                </div>
                                <div class="form-group" style="margin-bottom: 10px;">
                                    <input type="number" id="exportFeesYear" min="2023" max="2030" value="2024">
                                </div>
                            </div>
                            <button class="btn btn-block" id="exportFeesBtn">Экспорт CSV</button>
                        </div>
                    </div>
                </div>
                
                <!-- Common Consumption -->
                <div id="commonSection" class="content-section">
                    <h2 class="content-title">Общее потребление</h2>
                    
                    <div class="message" id="commonMessage"></div>
                    
                    <div style="margin-bottom: 30px;">
                        <h3 style="margin-bottom: 15px; color: #2c3e50;">Добавить общее потребление за период</h3>
                        <form id="addCommonConsumptionForm">
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="commonMonth">Месяц</label>
                                    <select id="commonMonth" required>
                                        <option value="">Выберите месяц</option>
                                        <option value="1">Январь</option>
                                        <option value="2">Февраль</option>
                                        <option value="3">Март</option>
                                        <option value="4">Апрель</option>
                                        <option value="5">Май</option>
                                        <option value="6">Июнь</option>
                                        <option value="7">Июль</option>
                                        <option value="8">Август</option>
                                        <option value="9">Сентябрь</option>
                                        <option value="10">Октябрь</option>
                                        <option value="11">Ноябрь</option>
                                        <option value="12">Декабрь</option>
                                    </select>
                                </div>
                                
                                <div class="form-group">
                                    <label for="commonYear">Год</label>
                                    <input type="number" id="commonYear" min="2023" max="2030" value="2024" required>
                                </div>
                                
                                <div class="form-group">
                                    <label for="commonConsumption">Общее потребление (кВт·ч)</label>
                                    <input type="number" id="commonConsumption" step="0.01" min="0" required>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <button type="submit" class="btn">Добавить общее потребление</button>
                            </div>
                        </form>
                    </div>
                    
                    <h3 style="margin-bottom: 15px; color: #2c3e50;">История общего потребления</h3>
                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>Период</th>
                                    <th>Общее потребление (кВт·ч)</th>
                                    <th>Стоимость общего потребления*</th>
                                    <th>На одного пользователя*</th>
                                    <th>Дата добавления</th>
                                    <th>Действия</th>
                                </tr>
                            </thead>
                            <tbody id="commonConsumptionTable">
                                <!-- Данные загрузятся через JS -->
                            </tbody>
                        </table>
                    </div>
                    <p style="margin-top: 10px; color: #7f8c8d; font-size: 0.9rem;">* Расчет выполняется на основе текущего тарифа на общее потребление</p>
                </div>
            </div>
        </div>
        
        <div class="footer">
            <p>СНТ "Звездочка" © 2024. Админ-панель. Все права защищены.</p>
            <p>Версия системы: 1.0.0 | Последнее обновление: 15.03.2024</p>
        </div>
    </div>
    
    <!-- Modal for adding/editing -->
    <div class="modal" id="userModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="modalTitle">Добавить пользователя</h3>
                <button class="modal-close" id="modalClose">&times;</button>
            </div>
            <form id="userForm">
                <input type="hidden" id="userId">
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="modalFullName">ФИО *</label>
                        <input type="text" id="modalFullName" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="modalEmail">Email *</label>
                        <input type="email" id="modalEmail" required>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="modalPassword">Пароль *</label>
                        <input type="password" id="modalPassword" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="modalPhone">Телефон</label>
                        <input type="tel" id="modalPhone">
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="modalAddress">Адрес</label>
                        <textarea id="modalAddress"></textarea>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="modalRole">Роль</label>
                        <select id="modalRole">
                            <option value="user">Пользователь</option>
                            <option value="admin">Администратор</option>
                        </select>
                    </div>
                </div>
                
                <div class="form-group">
                    <button type="submit" class="btn btn-block" id="modalSubmitBtn">Сохранить</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // Конфигурация Supabase
       const SUPABASE_URL = 'https://chgbdbuiqzdmwiniyxrk.supabase.co'; // Замените на ваш URL
       const SUPABASE_ANON_KEY = 'sb_publishable_9NXa4FwnnrICXnXmrOVqRg_KB5LHkmk'; // Замените на ваш ключ
        
        // Инициализация Supabase клиента
        const { createClient } = supabase;
        const supabaseClient = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
        
        // Текущий пользователь (админ)
        let currentAdmin = null;
        
        // Инициализация приложения
        document.addEventListener('DOMContentLoaded', function() {
            checkAdminAuth();
            setupEventListeners();
            loadAdminData();
            loadDashboardData();
            setupSectionSwitching();
            
            // Установка текущей даты в формах
            const now = new Date();
            const currentDate = now.toISOString().split('T')[0];
            if (document.getElementById('feeDueDate')) {
                // Установить срок оплаты на конец текущего месяца
                const lastDay = new Date(now.getFullYear(), now.getMonth() + 1, 0).getDate();
                document.getElementById('feeDueDate').value = `${now.getFullYear()}-${String(now.getMonth() + 1).padStart(2, '0')}-${lastDay}`;
            }
            
            if (document.getElementById('tariffStartDate')) {
                document.getElementById('tariffStartDate').value = currentDate;
            }
        });
        
        // Проверка авторизации администратора
        function checkAdminAuth() {
            const userId = localStorage.getItem('snt_user_id');
            const userRole = localStorage.getItem('snt_user_role');
            
            if (!userId || userRole !== 'admin') {
                window.location.href = 'index.html';
            }
            
            currentAdmin = {
                id: userId,
                email: localStorage.getItem('snt_user_email'),
                name: localStorage.getItem('snt_user_name'),
                role: userRole
            };
        }
        
        // Настройка обработчиков событий
        function setupEventListeners() {
            // Выход из системы
            document.getElementById('logoutBtn').addEventListener('click', logout);
            
            // Закрытие модального окна
            document.getElementById('modalClose').addEventListener('click', closeModal);
            
            // Клик вне модального окна для закрытия
            document.getElementById('userModal').addEventListener('click', function(e) {
                if (e.target === this) {
                    closeModal();
                }
            });
            
            // Добавление пользователя
            document.getElementById('addUserBtn').addEventListener('click', function() {
                openUserModal();
            });
            
            // Обработка формы пользователя
            document.getElementById('userForm').addEventListener('submit', saveUser);
            
            // Переключение между вкладками контента
            document.querySelectorAll('.content-tab').forEach(tab => {
                tab.addEventListener('click', function() {
                    const tabId = this.getAttribute('data-tab');
                    const parentSection = this.closest('.content-section').id;
                    
                    // Удаление активного класса у всех вкладок в этой секции
                    this.parentElement.querySelectorAll('.content-tab').forEach(t => {
                        t.classList.remove('active');
                    });
                    
                    // Удаление активного класса у всех панелей в этой секции
                    document.querySelectorAll(`#${parentSection} .tab-panel`).forEach(p => {
                        p.classList.remove('active');
                    });
                    
                    // Добавление активного класса
                    this.classList.add('active');
                    document.getElementById(`${tabId}Tab`).classList.add('active');
                });
            });
            
            // Переключение области применения взносов
            document.querySelectorAll('input[name="feeScope"]').forEach(radio => {
                radio.addEventListener('change', function() {
                    const selectedUsersContainer = document.getElementById('selectedUsersContainer');
                    if (this.value === 'selected') {
                        selectedUsersContainer.style.display = 'block';
                        loadUsersForSelection();
                    } else {
                        selectedUsersContainer.style.display = 'none';
                    }
                });
            });
            
            // Экспорт данных
            document.getElementById('exportUsersBtn').addEventListener('click', exportUsers);
            document.getElementById('exportReadingsBtn').addEventListener('click', exportReadings);
            document.getElementById('exportFeesBtn').addEventListener('click', exportFees);
            
            // Загрузка шаблонов
            document.getElementById('downloadTemplateBtn').addEventListener('click', downloadReadingsTemplate);
            document.getElementById('downloadUsersTemplateBtn').addEventListener('click', downloadUsersTemplate);
            
            // Обработка форм
            if (document.getElementById('addReadingForm')) {
                document.getElementById('addReadingForm').addEventListener('submit', addReading);
            }
            
            if (document.getElementById('manageFeesForm')) {
                document.getElementById('manageFeesForm').addEventListener('submit', manageFees);
            }
            
            if (document.getElementById('addTariffForm')) {
                document.getElementById('addTariffForm').addEventListener('submit', addTariff);
            }
            
            if (document.getElementById('addCommonConsumptionForm')) {
                document.getElementById('addCommonConsumptionForm').addEventListener('submit', addCommonConsumption);
            }
        }
        
        // Загрузка данных администратора
        function loadAdminData() {
            document.getElementById('adminName').textContent = currentAdmin.name;
            document.getElementById('adminEmail').textContent = currentAdmin.email;
        }
        
        // Загрузка данных дашборда
        function loadDashboardData() {
            // В реальном приложении здесь будут запросы к Supabase
            // Для демо используем фиктивные данные
            
            // Загрузка активности
            const activities = [
                { time: '10:30', user: 'Иванов И.И.', action: 'Передал показания', details: '1245.67 кВт·ч' },
                { time: '10:15', user: 'Петров П.П.', action: 'Оплатил взносы', details: '1600 ₽' },
                { time: '09:45', user: 'Сидоров С.С.', action: 'Зарегистрировался', details: 'Новый пользователь' },
                { time: '09:30', user: 'Администратор', action: 'Обновил тарифы', details: 'Новые тарифы с 01.04.2024' },
                { time: 'Вчера, 18:20', user: 'Кузнецов К.К.', action: 'Передал показания', details: '987.65 кВт·ч' }
            ];
            
            const activityTable = document.getElementById('activityTable');
            activityTable.innerHTML = '';
            
            activities.forEach(activity => {
                const row = activityTable.insertRow();
                row.innerHTML = `
                    <td>${activity.time}</td>
                    <td>${activity.user}</td>
                    <td>${activity.action}</td>
                    <td>${activity.details}</td>
                `;
            });
            
            // Обновление времени последнего обновления
            const now = new Date();
            const timeString = now.toLocaleTimeString('ru-RU', { hour: '2-digit', minute: '2-digit' });
            document.getElementById('lastUpdateTime').textContent = `Сегодня, ${timeString}`;
        }
        
        // Переключение между секциями
        function setupSectionSwitching() {
            document.querySelectorAll('.menu-item').forEach(item => {
                item.addEventListener('click', function() {
                    const sectionId = this.getAttribute('data-section');
                    showSection(sectionId);
                    
                    // Удаление активного класса у всех элементов меню
                    document.querySelectorAll('.menu-item').forEach(i => {
                        i.classList.remove('active');
                    });
                    
                    // Добавление активного класса к текущему элементу
                    this.classList.add('active');
                });
            });
        }
        
        // Показать секцию
        function showSection(sectionId) {
            // Скрыть все секции
            document.querySelectorAll('.content-section').forEach(section => {
                section.classList.remove('active');
            });
            
            // Показать выбранную секцию
            document.getElementById(`${sectionId}Section`).classList.add('active');
            
            // Загрузить данные для секции, если нужно
            switch(sectionId) {
                case 'users':
                    loadUsers();
                    break;
                case 'meters':
                    loadMeters();
                    break;
                case 'readings':
                    loadReadingUsers();
                    loadReadings();
                    break;
                case 'fees':
                    loadFees();
                    break;
                case 'tariffs':
                    loadTariffs();
                    break;
                case 'common':
                    loadCommonConsumption();
                    break;
            }
        }
        
        // Открытие модального окна для добавления/редактирования пользователя
        function openUserModal(user = null) {
            const modal = document.getElementById('userModal');
            const title = document.getElementById('modalTitle');
            const form = document.getElementById('userForm');
            
            if (user) {
                // Режим редактирования
                title.textContent = 'Редактировать пользователя';
                document.getElementById('userId').value = user.id;
                document.getElementById('modalFullName').value = user.full_name || '';
                document.getElementById('modalEmail').value = user.email || '';
                document.getElementById('modalPassword').required = false;
                document.getElementById('modalPhone').value = user.phone || '';
                document.getElementById('modalAddress').value = user.address || '';
                document.getElementById('modalRole').value = user.role || 'user';
            } else {
                // Режим добавления
                title.textContent = 'Добавить пользователя';
                form.reset();
                document.getElementById('userId').value = '';
                document.getElementById('modalPassword').required = true;
            }
            
            modal.style.display = 'flex';
        }
        
        // Закрытие модального окна
        function closeModal() {
            document.getElementById('userModal').style.display = 'none';
        }
        
        // Сохранение пользователя
        async function saveUser(e) {
            e.preventDefault();
            
            const userId = document.getElementById('userId').value;
            const fullName = document.getElementById('modalFullName').value;
            const email = document.getElementById('modalEmail').value;
            const password = document.getElementById('modalPassword').value;
            const phone = document.getElementById('modalPhone').value;
            const address = document.getElementById('modalAddress').value;
            const role = document.getElementById('modalRole').value;
            
            const submitBtn = document.getElementById('modalSubmitBtn');
            submitBtn.textContent = 'Сохранение...';
            submitBtn.disabled = true;
            
            try {
                // В реальном приложении здесь будет запрос к Supabase
                // Для демо используем имитацию
                await new Promise(resolve => setTimeout(resolve, 1000));
                
                // Успешное сохранение
                showMessage('usersMessage', 'Пользователь успешно сохранен!', 'success');
                closeModal();
                loadUsers();
            } catch (error) {
                showMessage('usersMessage', 'Ошибка при сохранении пользователя', 'error');
            } finally {
                submitBtn.textContent = 'Сохранить';
                submitBtn.disabled = false;
            }
        }
        
        // Загрузка пользователей
        function loadUsers() {
            // В реальном приложении здесь будет запрос к Supabase
            // Для демо используем фиктивные данные
            const users = [
                { id: 1, full_name: 'Иванов Иван Иванович', email: 'ivanov@example.com', phone: '+7 (999) 123-45-67', role: 'user', created_at: '15.01.2024' },
                { id: 2, full_name: 'Петров Петр Петрович', email: 'petrov@example.com', phone: '+7 (999) 234-56-78', role: 'user', created_at: '20.01.2024' },
                { id: 3, full_name: 'Сидорова Анна Сергеевна', email: 'sidorova@example.com', phone: '+7 (999) 345-67-89', role: 'user', created_at: '25.01.2024' },
                { id: 4, full_name: 'Кузнецов Алексей Владимирович', email: 'kuznetsov@example.com', phone: '+7 (999) 456-78-90', role: 'user', created_at: '01.02.2024' },
                { id: 5, full_name: 'Смирнова Ольга Дмитриевна', email: 'smirnova@example.com', phone: '+7 (999) 567-89-01', role: 'user', created_at: '05.02.2024' }
            ];
            
            const usersTable = document.getElementById('usersTable');
            usersTable.innerHTML = '';
            
            users.forEach(user => {
                const row = usersTable.insertRow();
                row.innerHTML = `
                    <td>${user.id}</td>
                    <td>${user.full_name}</td>
                    <td>${user.email}</td>
                    <td>${user.phone}</td>
                    <td>${user.role === 'admin' ? 'Администратор' : 'Пользователь'}</td>
                    <td>${user.created_at}</td>
                    <td>
                        <div class="action-buttons">
                            <button class="btn-icon btn-edit" onclick="openUserModal(${JSON.stringify(user).replace(/"/g, '&quot;')})">✏️</button>
                            <button class="btn-icon btn-delete" onclick="deleteUser(${user.id})">🗑️</button>
                        </div>
                    </td>
                `;
            });
        }
        
        // Загрузка пользователей для выбора при назначении взносов
        function loadUsersForSelection() {
            const select = document.getElementById('selectedUsers');
            select.innerHTML = '';
            
            // В реальном приложении здесь будет запрос к Supabase
            // Для демо используем фиктивные данные
            const users = [
                { id: 1, name: 'Иванов Иван Иванович' },
                { id: 2, name: 'Петров Петр Петрович' },
                { id: 3, name: 'Сидорова Анна Сергеевна' },
                { id: 4, name: 'Кузнецов Алексей Владимирович' },
                { id: 5, name: 'Смирнова Ольга Дмитриевна' }
            ];
            
            users.forEach(user => {
                const option = document.createElement('option');
                option.value = user.id;
                option.textContent = user.name;
                select.appendChild(option);
            });
        }
        
        // Загрузка пользователей для формы показаний
        function loadReadingUsers() {
            const select = document.getElementById('readingUser');
            select.innerHTML = '<option value="">Выберите пользователя</option>';
            
            // В реальном приложении здесь будет запрос к Supabase
            // Для демо используем фиктивные данные
            const users = [
                { id: 1, name: 'Иванов Иван Иванович' },
                { id: 2, name: 'Петров Петр Петрович' },
                { id: 3, name: 'Сидорова Анна Сергеевна' }
            ];
            
            users.forEach(user => {
                const option = document.createElement('option');
                option.value = user.id;
                option.textContent = user.name;
                select.appendChild(option);
            });
        }
        
        // Загрузка счетчиков
        function loadMeters() {
            // В реальном приложении здесь будет запрос к Supabase
            // Для демо используем фиктивные данные
            const meters = [
                { id: 1, number: '123456', owner: 'Иванов И.И.', type: 'Электроэнергия', installed: '15.01.2020', status: 'Активен', last_reading: '1245.67 кВт·ч' },
                { id: 2, number: '789012', owner: 'Петров П.П.', type: 'Электроэнергия', installed: '20.02.2021', status: 'Активен', last_reading: '876.54 кВт·ч' },
                { id: 3, number: '345678', owner: 'Сидорова А.С.', type: 'Электроэнергия', installed: '10.03.2022', status: 'Активен', last_reading: '987.65 кВт·ч' },
                { id: 4, number: '901234', owner: 'Кузнецов А.В.', type: 'Электроэнергия', installed: '05.04.2023', status: 'Неактивен', last_reading: 'Нет данных' }
            ];
            
            const metersTable = document.getElementById('metersTable');
            metersTable.innerHTML = '';
            
            meters.forEach(meter => {
                const row = metersTable.insertRow();
                row.innerHTML = `
                    <td>${meter.number}</td>
                    <td>${meter.owner}</td>
                    <td>${meter.type}</td>
                    <td>${meter.installed}</td>
                    <td>${meter.status}</td>
                    <td>${meter.last_reading}</td>
                    <td>
                        <div class="action-buttons">
                            <button class="btn-icon btn-edit">✏️</button>
                            <button class="btn-icon btn-delete">🗑️</button>
                        </div>
                    </td>
                `;
            });
        }
        
        // Загрузка показаний
        function loadReadings() {
            // В реальном приложении здесь будет запрос к Supabase
            // Для демо используем фиктивные данные
            const readings = [
                { id: 1, user: 'Иванов И.И.', meter: '123456', period: 'Март 2024', value: '1245.67', submitted: '25.03.2024' },
                { id: 2, user: 'Петров П.П.', meter: '789012', period: 'Март 2024', value: '876.54', submitted: '24.03.2024' },
                { id: 3, user: 'Сидорова А.С.', meter: '345678', period: 'Март 2024', value: '987.65', submitted: '25.03.2024' },
                { id: 4, user: 'Иванов И.И.', meter: '123456', period: 'Февраль 2024', value: '1122.22', submitted: '25.02.2024' },
                { id: 5, user: 'Петров П.П.', meter: '789012', period: 'Февраль 2024', value: '765.43', submitted: '24.02.2024' }
            ];
            
            const readingsTable = document.getElementById('readingsTable');
            readingsTable.innerHTML = '';
            
            readings.forEach(reading => {
                const row = readingsTable.insertRow();
                row.innerHTML = `
                    <td>${reading.user}</td>
                    <td>${reading.meter}</td>
                    <td>${reading.period}</td>
                    <td>${reading.value} кВт·ч</td>
                    <td>${reading.submitted}</td>
                    <td>
                        <div class="action-buttons">
                            <button class="btn-icon btn-edit">✏️</button>
                            <button class="btn-icon btn-delete">🗑️</button>
                        </div>
                    </td>
                `;
            });
        }
        
        // Добавление показаний
        async function addReading(e) {
            e.preventDefault();
            
            const userId = document.getElementById('readingUser').value;
            const meterId = document.getElementById('readingMeter').value;
            const month = document.getElementById('readingMonth').value;
            const year = document.getElementById('readingYear').value;
            const value = document.getElementById('readingValue').value;
            
            if (!userId || !meterId || !month || !year || !value) {
                showMessage('readingsMessage', 'Заполните все поля', 'error');
                return;
            }
            
            // В реальном приложении здесь будет запрос к Supabase
            // Для демо используем имитацию
            await new Promise(resolve => setTimeout(resolve, 1000));
            
            showMessage('readingsMessage', 'Показания успешно добавлены!', 'success');
            document.getElementById('addReadingForm').reset();
            loadReadings();
        }
        
        // Загрузка взносов
        function loadFees() {
            // В реальном приложении здесь будет запрос к Supabase
            // Для демо используем фиктивные данные
            const fees = [
                { id: 1, user: 'Иванов И.И.', type: 'Зарплата председателя', period: 'Март 2024', amount: '500.00', due_date: '31.03.2024', status: 'Не оплачено' },
                { id: 2, user: 'Иванов И.И.', type: 'Содержание территории', period: 'Март 2024', amount: '800.00', due_date: '31.03.2024', status: 'Не оплачено' },
                { id: 3, user: 'Петров П.П.', type: 'Зарплата председателя', period: 'Март 2024', amount: '500.00', due_date: '31.03.2024', status: 'Оплачено' },
                { id: 4, user: 'Петров П.П.', type: 'Содержание территории', period: 'Март 2024', amount: '800.00', due_date: '31.03.2024', status: 'Оплачено' },
                { id: 5, user: 'Сидорова А.С.', type: 'Прочие расходы', period: 'Март 2024', amount: '300.00', due_date: '31.03.2024', status: 'Не оплачено' }
            ];
            
            const feesTable = document.getElementById('feesTable');
            feesTable.innerHTML = '';
            
            fees.forEach(fee => {
                const row = feesTable.insertRow();
                const statusClass = fee.status === 'Оплачено' ? 'status-paid' : 'status-unpaid';
                const typeText = fee.type === 'salary' ? 'Зарплата председателя' : 
                                fee.type === 'maintenance' ? 'Содержание территории' : 'Прочие расходы';
                
                row.innerHTML = `
                    <td>${fee.user}</td>
                    <td>${typeText}</td>
                    <td>${fee.period}</td>
                    <td>${fee.amount} ₽</td>
                    <td>${fee.due_date}</td>
                    <td class="${statusClass}">${fee.status}</td>
                    <td>
                        <div class="action-buttons">
                            <button class="btn-icon btn-edit">✏️</button>
                            <button class="btn-icon btn-delete">🗑️</button>
                        </div>
                    </td>
                `;
            });
        }
        
        // Управление взносами
        async function manageFees(e) {
            e.preventDefault();
            
            const type = document.getElementById('feeType').value;
            const amount = document.getElementById('feeAmount').value;
            const month = document.getElementById('feeMonth').value;
            const year = document.getElementById('feeYear').value;
            const dueDate = document.getElementById('feeDueDate').value;
            const scope = document.querySelector('input[name="feeScope"]:checked').value;
            const selectedUsers = scope === 'selected' ? Array.from(document.getElementById('selectedUsers').selectedOptions).map(o => o.value) : [];
            
            if (!type || !amount || !month || !year || !dueDate) {
                showMessage('feesMessage', 'Заполните все обязательные поля', 'error');
                return;
            }
            
            // В реальном приложении здесь будет запрос к Supabase
            // Для демо используем имитацию
            await new Promise(resolve => setTimeout(resolve, 1000));
            
            showMessage('feesMessage', 'Взносы успешно назначены!', 'success');
            document.getElementById('manageFeesForm').reset();
            loadFees();
        }
        
        // Загрузка тарифов
        function loadTariffs() {
            // В реальном приложении здесь будет запрос к Supabase
            // Для демо используем фиктивные данные
            const tariffs = [
                { id: 1, name: 'Основной тариф 2024', rate_1: '6.10', rate_2: '7.30', rate_common: '0.36', start_date: '01.01.2024', end_date: '31.12.2024', status: 'Активен' },
                { id: 2, name: 'Зимний тариф 2023', rate_1: '5.80', rate_2: '7.00', rate_common: '0.34', start_date: '01.10.2023', end_date: '31.12.2023', status: 'Неактивен' },
                { id: 3, name: 'Летний тариф 2023', rate_1: '5.50', rate_2: '6.80', rate_common: '0.32', start_date: '01.06.2023', end_date: '30.09.2023', status: 'Неактивен' }
            ];
            
            const tariffsTable = document.getElementById('tariffsTable');
            tariffsTable.innerHTML = '';
            
            tariffs.forEach(tariff => {
                const row = tariffsTable.insertRow();
                row.innerHTML = `
                    <td>${tariff.name}</td>
                    <td>${tariff.rate_1} ₽/кВт·ч</td>
                    <td>${tariff.rate_2} ₽/кВт·ч</td>
                    <td>${tariff.rate_common} ₽/кВт·ч</td>
                    <td>${tariff.start_date}</td>
                    <td>${tariff.end_date || 'Бессрочно'}</td>
                    <td>${tariff.status}</td>
                    <td>
                        <div class="action-buttons">
                            <button class="btn-icon btn-edit">✏️</button>
                            <button class="btn-icon btn-delete">🗑️</button>
                        </div>
                    </td>
                `;
            });
        }
        
        // Добавление тарифа
        async function addTariff(e) {
            e.preventDefault();
            
            const name = document.getElementById('tariffName').value;
            const rate1 = document.getElementById('tariffRate1').value;
            const rate2 = document.getElementById('tariffRate2').value;
            const rateCommon = document.getElementById('tariffRateCommon').value;
            const startDate = document.getElementById('tariffStartDate').value;
            const endDate = document.getElementById('tariffEndDate').value;
            
            if (!name || !rate1 || !rate2 || !rateCommon || !startDate) {
                showMessage('tariffsMessage', 'Заполните все обязательные поля', 'error');
                return;
            }
            
            // В реальном приложении здесь будет запрос к Supabase
            // Для демо используем имитацию
            await new Promise(resolve => setTimeout(resolve, 1000));
            
            showMessage('tariffsMessage', 'Тариф успешно добавлен!', 'success');
            document.getElementById('addTariffForm').reset();
            
            // Установка даты начала на сегодня
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('tariffStartDate').value = today;
            
            loadTariffs();
        }
        
        // Загрузка общего потребления
        function loadCommonConsumption() {
            // В реальном приложении здесь будет запрос к Supabase
            // Для демо используем фиктивные данные
            const consumption = [
                { id: 1, period: 'Март 2024', total: '15,678', cost: '5,644.08', per_user: '30.18', added: '01.04.2024' },
                { id: 2, period: 'Февраль 2024', total: '14,532', cost: '5,231.52', per_user: '27.97', added: '01.03.2024' },
                { id: 3, period: 'Январь 2024', total: '16,789', cost: '6,044.04', per_user: '32.32', added: '01.02.2024' },
                { id: 4, period: 'Декабрь 2023', total: '15,432', cost: '5,555.52', per_user: '29.71', added: '01.01.2024' }
            ];
            
            const consumptionTable = document.getElementById('commonConsumptionTable');
            consumptionTable.innerHTML = '';
            
            consumption.forEach(item => {
                const row = consumptionTable.insertRow();
                row.innerHTML = `
                    <td>${item.period}</td>
                    <td>${item.total} кВт·ч</td>
                    <td>${item.cost} ₽</td>
                    <td>${item.per_user} ₽</td>
                    <td>${item.added}</td>
                    <td>
                        <div class="action-buttons">
                            <button class="btn-icon btn-edit">✏️</button>
                            <button class="btn-icon btn-delete">🗑️</button>
                        </div>
                    </td>
                `;
            });
        }
        
        // Добавление общего потребления
        async function addCommonConsumption(e) {
            e.preventDefault();
            
            const month = document.getElementById('commonMonth').value;
            const year = document.getElementById('commonYear').value;
            const consumption = document.getElementById('commonConsumption').value;
            
            if (!month || !year || !consumption) {
                showMessage('commonMessage', 'Заполните все поля', 'error');
                return;
            }
            
            // В реальном приложении здесь будет запрос к Supabase
            // Для демо используем имитацию
            await new Promise(resolve => setTimeout(resolve, 1000));
            
            showMessage('commonMessage', 'Общее потребление успешно добавлено!', 'success');
            document.getElementById('addCommonConsumptionForm').reset();
            loadCommonConsumption();
        }
        
        // Удаление пользователя
        function deleteUser(userId) {
            if (confirm('Вы уверены, что хотите удалить этого пользователя?')) {
                // В реальном приложении здесь будет запрос к Supabase
                showMessage('usersMessage', 'Пользователь удален', 'success');
                loadUsers();
            }
        }
        
        // Экспорт пользователей
        function exportUsers() {
            // В реальном приложении здесь будет запрос к Supabase и создание CSV
            showMessage('exportMessage', 'Экспорт пользователей начат. Файл будет загружен автоматически.', 'success');
            
            // Имитация загрузки файла
            setTimeout(() => {
                const link = document.createElement('a');
                link.href = 'data:text/csv;charset=utf-8,ФИО,Email,Телефон,Адрес\nИванов Иван,ivanov@example.com,+79991234567,ул. Садовая 1\n';
                link.download = 'users_export.csv';
                link.click();
            }, 1000);
        }
        
        // Экспорт показаний
        function exportReadings() {
            showMessage('exportMessage', 'Экспорт показаний начат. Файл будет загружен автоматически.', 'success');
            
            setTimeout(() => {
                const link = document.createElement('a');
                link.href = 'data:text/csv;charset=utf-8,Пользователь,Счетчик,Месяц,Год,Показания\nИванов И.И.,123456,3,2024,1245.67\n';
                link.download = 'readings_export.csv';
                link.click();
            }, 1000);
        }
        
        // Экспорт взносов
        function exportFees() {
            showMessage('exportMessage', 'Экспорт взносов начат. Файл будет загружен автоматически.', 'success');
            
            setTimeout(() => {
                const link = document.createElement('a');
                link.href = 'data:text/csv;charset=utf-8,Пользователь,Тип взноса,Период,Сумма,Статус\nИванов И.И.,Зарплата председателя,Март 2024,500.00,Не оплачено\n';
                link.download = 'fees_export.csv';
                link.click();
            }, 1000);
        }
        
        // Загрузка шаблона для показаний
        function downloadReadingsTemplate() {
            const link = document.createElement('a');
            link.href = 'data:text/csv;charset=utf-8,user_id,meter_id,month,year,reading\n1,1,3,2024,1245.67\n';
            link.download = 'readings_template.csv';
            link.click();
        }
        
        // Загрузка шаблона для пользователей
        function downloadUsersTemplate() {
            const link = document.createElement('a');
            link.href = 'data:text/csv;charset=utf-8,full_name,email,password,phone,address\nИванов Иван Иванович,ivanov@example.com,password123,+79991234567,ул. Садовая 1\n';
            link.download = 'users_template.csv';
            link.click();
        }
        
        // Выход из системы
        function logout() {
            localStorage.removeItem('snt_user_id');
            localStorage.removeItem('snt_user_email');
            localStorage.removeItem('snt_user_name');
            localStorage.removeItem('snt_user_role');
            window.location.href = 'index.html';
        }
        
        // Функция для показа сообщений
        function showMessage(elementId, text, type) {
            const messageDiv = document.getElementById(elementId);
            if (messageDiv) {
                messageDiv.textContent = text;
                messageDiv.className = 'message ' + type;
                messageDiv.style.display = 'block';
                
                // Автоматическое скрытие сообщения
                setTimeout(() => {
                    messageDiv.style.display = 'none';
                }, 5000);
            }
        }
    </script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</body>
</html>