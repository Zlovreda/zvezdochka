<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–°–ù–¢ "–ó–≤–µ–∑–¥–æ—á–∫–∞" - –£—á–µ—Ç —ç–ª–µ–∫—Ç—Ä–æ—ç–Ω–µ—Ä–≥–∏–∏ –∏ –≤–∑–Ω–æ—Å–æ–≤</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
            padding: 20px;
            color: #333;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        header {
            background: linear-gradient(135deg, #1a3a5f 0%, #2c5282 100%);
            color: white;
            padding: 30px;
            text-align: center;
            position: relative;
        }
        
        header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }
        
        .app-status {
            background: #e8f4fd;
            padding: 15px 30px;
            border-bottom: 1px solid #c3d9ec;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .status-item {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .status-badge {
            padding: 5px 15px;
            border-radius: 20px;
            font-weight: bold;
            font-size: 0.9rem;
        }
        
        .status-success {
            background-color: #d1fae5;
            color: #065f46;
        }
        
        .status-error {
            background-color: #fee2e2;
            color: #991b1b;
        }
        
        .status-warning {
            background-color: #fef3c7;
            color: #92400e;
        }
        
        .tabs-container {
            background: #f8fafc;
            border-bottom: 1px solid #e5e7eb;
        }
        
        .tabs {
            display: flex;
            max-width: 1400px;
            margin: 0 auto;
            overflow-x: auto;
        }
        
        .tab {
            padding: 18px 30px;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            transition: all 0.3s;
            white-space: nowrap;
            font-weight: 500;
        }
        
        .tab:hover {
            background: #e9ecef;
        }
        
        .tab.active {
            border-bottom-color: #3b82f6;
            background: white;
            font-weight: bold;
            color: #3b82f6;
        }
        
        .tab-content {
            display: none;
            padding: 30px;
            min-height: 600px;
        }
        
        .tab-content.active {
            display: block;
            animation: fadeIn 0.3s;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .auth-section {
            max-width: 500px;
            margin: 50px auto;
            padding: 40px;
            background: #f8fafc;
            border-radius: 12px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.08);
        }
        
        .form-group {
            margin-bottom: 25px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #4b5563;
        }
        
        input, select, textarea {
            width: 100%;
            padding: 12px 16px;
            border: 1px solid #d1d5db;
            border-radius: 8px;
            font-size: 16px;
            transition: all 0.3s;
            background: white;
        }
        
        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }
        
        .btn {
            padding: 14px 28px;
            background: #3b82f6;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        
        .btn:hover {
            background: #2563eb;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(37, 99, 235, 0.3);
        }
        
        .btn-success {
            background: #10b981;
        }
        
        .btn-success:hover {
            background: #059669;
        }
        
        .btn-danger {
            background: #ef4444;
        }
        
        .btn-danger:hover {
            background: #dc2626;
        }
        
        .btn-secondary {
            background: #6b7280;
        }
        
        .btn-secondary:hover {
            background: #4b5563;
        }
        
        .user-header {
            background: linear-gradient(135deg, #e0f2fe 0%, #bae6fd 100%);
            padding: 25px;
            border-radius: 12px;
            margin-bottom: 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 25px;
            margin-bottom: 30px;
        }
        
        .card {
            background: white;
            border: 1px solid #e5e7eb;
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
            transition: transform 0.3s, box-shadow 0.3s;
        }
        
        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
        }
        
        .card h3 {
            color: #1f2937;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #3b82f6;
            font-size: 1.3rem;
        }
        
        .meter-card {
            background: #f0f9ff;
            border-left: 4px solid #3b82f6;
            padding: 20px;
            margin: 15px 0;
            border-radius: 8px;
        }
        
        .payment-card {
            background: #f0fdf4;
            border-left: 4px solid #10b981;
            padding: 20px;
            margin: 15px 0;
            border-radius: 8px;
        }
        
        .payment-item {
            display: flex;
            justify-content: space-between;
            padding: 12px 0;
            border-bottom: 1px solid #e5e7eb;
        }
        
        .payment-total {
            font-size: 1.3rem;
            font-weight: bold;
            color: #10b981;
            margin-top: 15px;
            padding-top: 15px;
            border-top: 2px solid #e5e7eb;
        }
        
        .data-table-container {
            overflow-x: auto;
            margin-top: 20px;
            border-radius: 8px;
            border: 1px solid #e5e7eb;
        }
        
        .data-table {
            width: 100%;
            border-collapse: collapse;
            background: white;
        }
        
        .data-table th {
            background: #f8fafc;
            padding: 16px;
            text-align: left;
            font-weight: 600;
            color: #374151;
            border-bottom: 2px solid #e5e7eb;
        }
        
        .data-table td {
            padding: 16px;
            border-bottom: 1px solid #e5e7eb;
        }
        
        .data-table tr:hover {
            background: #f9fafb;
        }
        
        .alert {
            padding: 16px 20px;
            border-radius: 8px;
            margin: 20px 0;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .alert-success {
            background: #d1fae5;
            color: #065f46;
            border: 1px solid #a7f3d0;
        }
        
        .alert-error {
            background: #fee2e2;
            color: #991b1b;
            border: 1px solid #fecaca;
        }
        
        .alert-info {
            background: #e0f2fe;
            color: #0369a1;
            border: 1px solid #bae6fd;
        }
        
        .alert-warning {
            background: #fef3c7;
            color: #92400e;
            border: 1px solid #fde68a;
        }
        
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(59, 130, 246, 0.3);
            border-radius: 50%;
            border-top-color: #3b82f6;
            animation: spin 1s ease-in-out infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        .hidden {
            display: none !important;
        }
        
        .admin-panel {
            background: #f8fafc;
            padding: 30px;
            border-radius: 12px;
        }
        
        .admin-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 25px;
            margin-top: 25px;
        }
        
        .admin-section {
            background: white;
            border: 1px solid #e5e7eb;
            border-radius: 12px;
            padding: 25px;
        }
        
        .tariff-display {
            background: #f0f9ff;
            padding: 20px;
            border-radius: 8px;
            margin: 15px 0;
        }
        
        .tariff-item {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
        }
        
        .complex-calculation {
            background: #fefce8;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
        }
        
        .test-results {
            background: #1f2937;
            color: #f9fafb;
            padding: 20px;
            border-radius: 8px;
            margin-top: 20px;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            overflow-x: auto;
            max-height: 400px;
            overflow-y: auto;
        }
        
        .test-result-item {
            padding: 10px 0;
            border-bottom: 1px solid #374151;
        }
        
        .success-icon {
            color: #10b981;
            font-weight: bold;
        }
        
        .error-icon {
            color: #ef4444;
            font-weight: bold;
        }
        
        @media (max-width: 768px) {
            .tabs {
                flex-direction: column;
            }
            
            .tab {
                border-bottom: none;
                border-right: 3px solid transparent;
                text-align: left;
            }
            
            .tab.active {
                border-right-color: #3b82f6;
                border-bottom: none;
            }
            
            .dashboard-grid {
                grid-template-columns: 1fr;
            }
            
            .admin-grid {
                grid-template-columns: 1fr;
            }
            
            .user-header {
                flex-direction: column;
                gap: 15px;
                text-align: center;
            }
        }
        
        .counter-input-group {
            display: flex;
            gap: 15px;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .counter-input-group label {
            min-width: 200px;
            margin-bottom: 0;
        }
        
        .action-buttons {
            display: flex;
            gap: 15px;
            margin-top: 25px;
            flex-wrap: wrap;
        }
        
        .month-selector {
            background: #f8fafc;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 25px;
            display: flex;
            gap: 15px;
            align-items: center;
            flex-wrap: wrap;
        }
        
        .real-data-badge {
            background: #10b981;
            color: white;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: bold;
            margin-left: 10px;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üåø –°–ù–¢ "–ó–≤–µ–∑–¥–æ—á–∫–∞"</h1>
            <p>–°–∏—Å—Ç–µ–º–∞ —É—á–µ—Ç–∞ —ç–ª–µ–∫—Ç—Ä–æ—ç–Ω–µ—Ä–≥–∏–∏ –∏ —á–ª–µ–Ω—Å–∫–∏—Ö –≤–∑–Ω–æ—Å–æ–≤</p>
        </header>
        
        <div class="app-status">
            <div class="status-item">
                <span>–°—Ç–∞—Ç—É—Å API:</span>
                <span class="status-badge status-success" id="apiStatus">–ü—Ä–æ–≤–µ—Ä–∫–∞...</span>
            </div>
            <div class="status-item">
                <span>–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å:</span>
                <span id="userStatus">–ù–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω</span>
            </div>
            <div class="status-item">
                <span>–¢–µ–∫—É—â–∏–π –º–µ—Å—è—Ü:</span>
                <span id="currentMonthDisplay">–Ø–Ω–≤–∞—Ä—å 2026</span>
            </div>
        </div>
        
        <div class="tabs-container">
            <div class="tabs">
                <div class="tab active" data-tab="login">üîê –í—Ö–æ–¥ / –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</div>
                <div class="tab hidden" data-tab="user-dashboard" id="userTab">üìä –õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç</div>
                <div class="tab hidden" data-tab="meter-reading">‚ö° –ü–æ–∫–∞–∑–∞–Ω–∏—è —Å—á–µ—Ç—á–∏–∫–æ–≤</div>
                <div class="tab hidden" data-tab="payments">üí∞ –ü–ª–∞—Ç–µ–∂–∏ –∏ —Ä–∞—Å—á–µ—Ç—ã</div>
                <div class="tab hidden" data-tab="admin" id="adminTab">üëë –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å</div>
                <div class="tab" data-tab="api-test">üß™ –¢–µ—Å—Ç —Å–∏—Å—Ç–µ–º—ã</div>
            </div>
        </div>
        
        <!-- –í—Ö–æ–¥/–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è -->
        <div id="login" class="tab-content active">
            <div class="auth-section">
                <h2 style="text-align: center; margin-bottom: 30px; color: #1f2937;">–í—Ö–æ–¥ –≤ —Å–∏—Å—Ç–µ–º—É –°–ù–¢ "–ó–≤–µ–∑–¥–æ—á–∫–∞"</h2>
                
                <div id="authAlert" class="alert alert-info">
                    <div class="loading"></div>
                    <span>–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–µ–º–æ-—Ä–µ–∂–∏–º. –î–ª—è —Ä–µ–∞–ª—å–Ω–æ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –ø–æ–¥–∫–ª—é—á–∏—Ç–µ Supabase Auth</span>
                </div>
                
                <div class="form-group">
                    <label for="loginEmail">Email –∏–ª–∏ –Ω–æ–º–µ—Ä —É—á–∞—Å—Ç–∫–∞:</label>
                    <input type="text" id="loginEmail" placeholder="user@example.com –∏–ª–∏ —É—á–∞—Å—Ç–æ–∫ ‚Ññ15" value="demo@zvezdochka.ru">
                </div>
                
                <div class="form-group">
                    <label for="loginPassword">–ü–∞—Ä–æ–ª—å:</label>
                    <input type="password" id="loginPassword" placeholder="–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å" value="demo123">
                </div>
                
                <div class="action-buttons">
                    <button class="btn" onclick="login()">
                        <span class="loading hidden" id="loginLoading"></span>
                        –í–æ–π—Ç–∏ –≤ —Å–∏—Å—Ç–µ–º—É
                    </button>
                    <button class="btn btn-secondary" onclick="showRegister()">–°–æ–∑–¥–∞—Ç—å –∞–∫–∫–∞—É–Ω—Ç</button>
                    <button class="btn btn-success" onclick="loginAsAdmin()">–í–æ–π—Ç–∏ –∫–∞–∫ –∞–¥–º–∏–Ω</button>
                </div>
                
                <div style="text-align: center; margin-top: 25px; color: #6b7280; font-size: 0.9rem;">
                    <p>–î–µ–º–æ-–≤–µ—Ä—Å–∏—è. –î–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞ –Ω–∞—Å—Ç—Ä–æ–π—Ç–µ Supabase Auth –≤ –ø–∞–Ω–µ–ª–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è</p>
                </div>
            </div>
            
            <div class="auth-section hidden" id="registerSection">
                <h2 style="text-align: center; margin-bottom: 30px; color: #1f2937;">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –Ω–æ–≤–æ–≥–æ —É—á–∞—Å—Ç–Ω–∏–∫–∞</h2>
                
                <div class="form-group">
                    <label for="registerFullName">–§–ò–û:</label>
                    <input type="text" id="registerFullName" placeholder="–ò–≤–∞–Ω–æ–≤ –ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤–∏—á">
                </div>
                
                <div class="form-group">
                    <label for="registerEmail">Email:</label>
                    <input type="email" id="registerEmail" placeholder="user@example.com">
                </div>
                
                <div class="form-group">
                    <label for="registerPlotNumber">–ù–æ–º–µ—Ä —É—á–∞—Å—Ç–∫–∞:</label>
                    <input type="text" id="registerPlotNumber" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: 15">
                </div>
                
                <div class="form-group">
                    <label for="registerPlotArea">–ü–ª–æ—â–∞–¥—å —É—á–∞—Å—Ç–∫–∞ (—Å–æ—Ç–æ–∫):</label>
                    <input type="number" id="registerPlotArea" placeholder="6" value="6" min="1" step="0.5">
                </div>
                
                <div class="form-group">
                    <label for="registerPassword">–ü–∞—Ä–æ–ª—å (–º–∏–Ω–∏–º—É–º 6 —Å–∏–º–≤–æ–ª–æ–≤):</label>
                    <input type="password" id="registerPassword" placeholder="–ü—Ä–∏–¥—É–º–∞–π—Ç–µ –Ω–∞–¥–µ–∂–Ω—ã–π –ø–∞—Ä–æ–ª—å">
                </div>
                
                <div class="form-group">
                    <label for="registerPasswordConfirm">–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –ø–∞—Ä–æ–ª—è:</label>
                    <input type="password" id="registerPasswordConfirm" placeholder="–ü–æ–≤—Ç–æ—Ä–∏—Ç–µ –ø–∞—Ä–æ–ª—å">
                </div>
                
                <div class="action-buttons">
                    <button class="btn btn-success" onclick="register()">
                        <span class="loading hidden" id="registerLoading"></span>
                        –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è
                    </button>
                    <button class="btn btn-secondary" onclick="hideRegister()">–û—Ç–º–µ–Ω–∞</button>
                </div>
            </div>
        </div>
        
        <!-- –õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è -->
        <div id="user-dashboard" class="tab-content">
            <div class="user-header">
                <div>
                    <h2 id="userGreeting">–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å!</h2>
                    <p>–£—á–∞—Å—Ç–æ–∫ ‚Ññ<span id="userPlotNumber">-</span> ‚Ä¢ <span id="userPlotArea">-</span> —Å–æ—Ç–æ–∫</p>
                </div>
                <div>
                    <button class="btn btn-danger" onclick="logout()">üö™ –í—ã–π—Ç–∏</button>
                </div>
            </div>
            
            <div class="dashboard-grid">
                <div class="card">
                    <h3>üìà –¢–µ–∫—É—â–∏–µ –ø–æ–∫–∞–∑–∞–Ω–∏—è —Å—á–µ—Ç—á–∏–∫–æ–≤</h3>
                    <div id="currentReadings">
                        <div class="meter-card">
                            <p><strong>–°—á–µ—Ç—á–∏–∫ #1</strong> (–û—Å–Ω–æ–≤–Ω–æ–π)</p>
                            <p>–ü—Ä–µ–¥—ã–¥—É—â–µ–µ: <span class="real-data-badge">1250 –∫–í—Ç¬∑—á</span></p>
                            <p>–¢–µ–∫—É—â–µ–µ: <span id="currentReading1">–Ω–µ –≤–Ω–µ—Å–µ–Ω–æ</span></p>
                            <p>–†–∞—Å—Ö–æ–¥: <span id="consumption1">-</span> –∫–í—Ç¬∑—á</p>
                        </div>
                    </div>
                </div>
                
                <div class="card">
                    <h3>üí∞ –¢–∞—Ä–∏—Ñ—ã –Ω–∞ —ç–ª–µ–∫—Ç—Ä–æ—ç–Ω–µ—Ä–≥–∏—é</h3>
                    <div class="tariff-display">
                        <div class="tariff-item">
                            <span>–ü–æ—Ç–µ—Ä–∏ (–≤—Å—è —ç–Ω–µ—Ä–≥–∏—è):</span>
                            <span><span id="tariffLoss">0.36</span> —Ä—É–±/–∫–í—Ç¬∑—á</span>
                        </div>
                        <div class="tariff-item">
                            <span>–î–æ 100 –∫–í—Ç¬∑—á:</span>
                            <span><span id="tariffLow">6.10</span> —Ä—É–±/–∫–í—Ç¬∑—á</span>
                        </div>
                        <div class="tariff-item">
                            <span>–°–≤—ã—à–µ 100 –∫–í—Ç¬∑—á:</span>
                            <span><span id="tariffHigh">7.30</span> —Ä—É–±/–∫–í—Ç¬∑—á</span>
                        </div>
                        <div class="tariff-item">
                            <span>–î–µ–π—Å—Ç–≤—É—é—Ç —Å:</span>
                            <span id="tariffDate">01.01.2026</span>
                        </div>
                    </div>
                    
                    <div class="complex-calculation">
                        <strong>–§–æ—Ä–º—É–ª–∞ —Ä–∞—Å—á–µ—Ç–∞:</strong><br>
                        –°—É–º–º–∞ = (–í—Å–µ –∫–í—Ç¬∑—á √ó –ü–æ—Ç–µ—Ä–∏) + (min(–∫–í—Ç¬∑—á, 100) √ó –¢–∞—Ä–∏—Ñ1) + (max(–∫–í—Ç¬∑—á-100, 0) √ó –¢–∞—Ä–∏—Ñ2)
                    </div>
                </div>
                
                <div class="card">
                    <h3>üè† –ß–ª–µ–Ω—Å–∫–∏–µ –≤–∑–Ω–æ—Å—ã</h3>
                    <div class="payment-card">
                        <div class="tariff-item">
                            <span>–í–∑–Ω–æ—Å —Å –∑–∞—Ä–ø–ª–∞—Ç—ã:</span>
                            <span><span id="salaryFee">939.00</span> —Ä—É–±</span>
                        </div>
                        <div class="tariff-item">
                            <span>–°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ (–∑–∞ —Å–æ—Ç–∫—É):</span>
                            <span><span id="maintenanceFee">44.00</span> —Ä—É–±/—Å–æ—Ç–∫—É</span>
                        </div>
                        <div class="tariff-item">
                            <span>–í–∞—à —É—á–∞—Å—Ç–æ–∫:</span>
                            <span><span id="userPlotAreaDisplay">6</span> —Å–æ—Ç–æ–∫</span>
                        </div>
                        <div class="tariff-item payment-total">
                            <span>–ò—Ç–æ–≥–æ –≤–∑–Ω–æ—Å—ã:</span>
                            <span id="membershipTotal">1203.00</span> —Ä—É–±
                        </div>
                    </div>
                </div>
                
                <div class="card">
                    <h3>üí≥ –ò—Ç–æ–≥ –∫ –æ–ø–ª–∞—Ç–µ</h3>
                    <div class="payment-card">
                        <div class="payment-item">
                            <span>–≠–ª–µ–∫—Ç—Ä–æ—ç–Ω–µ—Ä–≥–∏—è:</span>
                            <span id="electricityAmount">0.00</span> —Ä—É–±
                        </div>
                        <div class="payment-item">
                            <span>–ß–ª–µ–Ω—Å–∫–∏–µ –≤–∑–Ω–æ—Å—ã:</span>
                            <span id="membershipAmount">1203.00</span> —Ä—É–±
                        </div>
                        <div class="payment-item payment-total">
                            <span>–í–°–ï–ì–û –ö –û–ü–õ–ê–¢–ï:</span>
                            <span id="totalAmount">1203.00</span> —Ä—É–±
                        </div>
                    </div>
                    
                    <div style="margin-top: 20px; text-align: center;">
                        <button class="btn btn-success" onclick="document.querySelector('[data-tab=\"meter-reading\"]').click()">
                            üìù –í–Ω–µ—Å—Ç–∏ –ø–æ–∫–∞–∑–∞–Ω–∏—è
                        </button>
                    </div>
                </div>
            </div>
            
            <div class="card">
                <h3>üìÖ –ò—Å—Ç–æ—Ä–∏—è –ø–ª–∞—Ç–µ–∂–µ–π</h3>
                <div class="data-table-container">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>–ú–µ—Å—è—Ü</th>
                                <th>–ü–æ–∫–∞–∑–∞–Ω–∏—è</th>
                                <th>–†–∞—Å—Ö–æ–¥</th>
                                <th>–≠–ª–µ–∫—Ç—Ä–∏—á–µ—Å—Ç–≤–æ</th>
                                <th>–í–∑–Ω–æ—Å—ã</th>
                                <th>–ò—Ç–æ–≥–æ</th>
                                <th>–°—Ç–∞—Ç—É—Å</th>
                            </tr>
                        </thead>
                        <tbody id="paymentHistory">
                            <tr>
                                <td>–î–µ–∫–∞–±—Ä—å 2025</td>
                                <td>1250 –∫–í—Ç¬∑—á</td>
                                <td>200 –∫–í—Ç¬∑—á</td>
                                <td>1,460.00 —Ä—É–±</td>
                                <td>1,203.00 —Ä—É–±</td>
                                <td>2,663.00 —Ä—É–±</td>
                                <td><span style="color: #10b981;">‚úì –û–ø–ª–∞—á–µ–Ω–æ</span></td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        
        <!-- –í–Ω–µ—Å–µ–Ω–∏–µ –ø–æ–∫–∞–∑–∞–Ω–∏–π -->
        <div id="meter-reading" class="tab-content">
            <div class="user-header">
                <div>
                    <h2>–í–Ω–µ—Å–µ–Ω–∏–µ –ø–æ–∫–∞–∑–∞–Ω–∏–π —Å—á–µ—Ç—á–∏–∫–æ–≤</h2>
                    <p>–ú–µ—Å—è—Ü: <strong id="currentMonthForReading">–Ø–Ω–≤–∞—Ä—å 2026</strong></p>
                </div>
                <div>
                    <button class="btn btn-secondary" onclick="document.querySelector('[data-tab=\"user-dashboard\"]').click()">
                        ‚Üê –ù–∞–∑–∞–¥ –≤ –∫–∞–±–∏–Ω–µ—Ç
                    </button>
                </div>
            </div>
            
            <div class="card">
                <h3>‚ö° –í–∞—à–∏ —Å—á–µ—Ç—á–∏–∫–∏</h3>
                
                <div class="alert alert-info">
                    –£ –≤–∞—Å –º–æ–∂–µ—Ç –±—ã—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å—á–µ—Ç—á–∏–∫–æ–≤. –í–Ω–µ—Å–∏—Ç–µ –ø–æ–∫–∞–∑–∞–Ω–∏—è –¥–ª—è –∫–∞–∂–¥–æ–≥–æ.
                </div>
                
                <div id="metersContainer">
                    <div class="meter-card">
                        <h4>–°—á–µ—Ç—á–∏–∫ #1 (–û—Å–Ω–æ–≤–Ω–æ–π)</h4>
                        <div class="form-group">
                            <label for="meterReading1">–¢–µ–∫—É—â–∏–µ –ø–æ–∫–∞–∑–∞–Ω–∏—è (–∫–í—Ç¬∑—á):</label>
                            <div class="counter-input-group">
                                <input type="number" id="meterReading1" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: 1450" min="1250" step="1">
                                <span style="color: #6b7280;">–ü—Ä–µ–¥—ã–¥—É—â–µ–µ: 1250 –∫–í—Ç¬∑—á</span>
                            </div>
                        </div>
                        <div id="meter1Calculation" style="margin-top: 15px; padding: 15px; background: #f8fafc; border-radius: 6px; display: none;">
                            <strong>–†–∞—Å—á–µ—Ç —Ä–∞—Å—Ö–æ–¥–∞:</strong>
                            <p>–¢–µ–∫—É—â–µ–µ: <span id="current1">-</span> –∫–í—Ç¬∑—á</p>
                            <p>–ü—Ä–µ–¥—ã–¥—É—â–µ–µ: 1250 –∫–í—Ç¬∑—á</p>
                            <p>–†–∞—Å—Ö–æ–¥: <span id="consumptionCalc1">-</span> –∫–í—Ç¬∑—á</p>
                        </div>
                    </div>
                    
                    <div class="meter-card">
                        <h4>–°—á–µ—Ç—á–∏–∫ #2 (–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π) <span style="color: #6b7280; font-size: 0.9rem;">(–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)</span></h4>
                        <div class="form-group">
                            <label for="meterReading2">–¢–µ–∫—É—â–∏–µ –ø–æ–∫–∞–∑–∞–Ω–∏—è (–∫–í—Ç¬∑—á):</label>
                            <div class="counter-input-group">
                                <input type="number" id="meterReading2" placeholder="–ï—Å–ª–∏ –µ—Å—Ç—å –≤—Ç–æ—Ä–æ–π —Å—á–µ—Ç—á–∏–∫" min="0" step="1">
                                <span style="color: #6b7280;">–ü—Ä–µ–¥—ã–¥—É—â–µ–µ: 0 –∫–í—Ç¬∑—á</span>
                            </div>
                        </div>
                        <div style="margin-top: 10px;">
                            <button class="btn btn-secondary" onclick="addAnotherMeter()">+ –î–æ–±–∞–≤–∏—Ç—å –µ—â–µ —Å—á–µ—Ç—á–∏–∫</button>
                        </div>
                    </div>
                </div>
                
                <div class="action-buttons">
                    <button class="btn" onclick="calculateConsumption()">
                        <span class="loading hidden" id="calcLoading"></span>
                        –†–∞—Å—Å—á–∏—Ç–∞—Ç—å —Ä–∞—Å—Ö–æ–¥
                    </button>
                    <button class="btn btn-success" onclick="submitMeterReadings()">
                        üì§ –û—Ç–ø—Ä–∞–≤–∏—Ç—å –ø–æ–∫–∞–∑–∞–Ω–∏—è
                    </button>
                </div>
            </div>
            
            <div class="card" style="margin-top: 30px;">
                <h3>üìä –ü—Ä–∏–º–µ—Ä —Ä–∞—Å—á–µ—Ç–∞ –¥–ª—è 763 –∫–í—Ç¬∑—á</h3>
                <div class="complex-calculation">
                    <strong>–ü—Ä–∏–º–µ—Ä –∏–∑ –∑–∞–¥–∞–Ω–∏—è:</strong><br>
                    1. –ü–æ—Ç–µ—Ä–∏: 763 –∫–í—Ç¬∑—á √ó 0.36 —Ä—É–±/–∫–í—Ç¬∑—á = <strong>274.68 —Ä—É–±</strong><br>
                    2. –î–æ 100 –∫–í—Ç¬∑—á: 100 –∫–í—Ç¬∑—á √ó 6.10 —Ä—É–±/–∫–í—Ç¬∑—á = <strong>610.00 —Ä—É–±</strong><br>
                    3. –°–≤—ã—à–µ 100 –∫–í—Ç¬∑—á: (763-100) = 663 –∫–í—Ç¬∑—á √ó 7.30 —Ä—É–±/–∫–í—Ç¬∑—á = <strong>4,839.90 —Ä—É–±</strong><br>
                    <br>
                    <strong>–ò–¢–û–ì–û –∑–∞ —ç–ª–µ–∫—Ç—Ä–æ—ç–Ω–µ—Ä–≥–∏—é: 274.68 + 610.00 + 4,839.90 = 5,724.58 —Ä—É–±</strong>
                </div>
            </div>
        </div>
        
        <!-- –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å -->
        <div id="admin" class="tab-content">
            <div class="user-header">
                <div>
                    <h2>üëë –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω–∞—è –ø–∞–Ω–µ–ª—å</h2>
                    <p>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º–æ–π –°–ù–¢ "–ó–≤–µ–∑–¥–æ—á–∫–∞"</p>
                </div>
                <div>
                    <button class="btn btn-danger" onclick="logout()">üö™ –í—ã–π—Ç–∏</button>
                </div>
            </div>
            
            <div class="admin-grid">
                <div class="admin-section">
                    <h3>üìà –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–∞—Ä–∏—Ñ–∞–º–∏</h3>
                    
                    <div class="form-group">
                        <label>–¢–∞—Ä–∏—Ñ "–ü–æ—Ç–µ—Ä–∏" (—Ä—É–±/–∫–í—Ç¬∑—á):</label>
                        <input type="number" id="adminTariffLoss" step="0.01" value="0.36" min="0">
                    </div>
                    
                    <div class="form-group">
                        <label>–¢–∞—Ä–∏—Ñ –¥–æ 100 –∫–í—Ç¬∑—á (—Ä—É–±/–∫–í—Ç¬∑—á):</label>
                        <input type="number" id="adminTariffLow" step="0.01" value="6.10" min="0">
                    </div>
                    
                    <div class="form-group">
                        <label>–¢–∞—Ä–∏—Ñ —Å–≤—ã—à–µ 100 –∫–í—Ç¬∑—á (—Ä—É–±/–∫–í—Ç¬∑—á):</label>
                        <input type="number" id="adminTariffHigh" step="0.01" value="7.30" min="0">
                    </div>
                    
                    <div class="form-group">
                        <label>–í–∑–Ω–æ—Å —Å –∑–∞—Ä–ø–ª–∞—Ç—ã (—Ä—É–±):</label>
                        <input type="number" id="adminSalaryFee" step="0.01" value="939.00" min="0">
                    </div>
                    
                    <div class="form-group">
                        <label>–°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ –∑–∞ —Å–æ—Ç–∫—É (—Ä—É–±/—Å–æ—Ç–∫—É):</label>
                        <input type="number" id="adminMaintenanceFee" step="0.01" value="44.00" min="0">
                    </div>
                    
                    <button class="btn btn-success" onclick="saveTariffs()">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ç–∞—Ä–∏—Ñ—ã</button>
                </div>
                
                <div class="admin-section">
                    <h3>üë• –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏</h3>
                    
                    <div class="alert alert-info">
                        –í –¥–µ–º–æ-—Ä–µ–∂–∏–º–µ –¥–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –∏–∑ localStorage. –í —Ä–µ–∞–ª—å–Ω–æ–º —Ä–µ–∂–∏–º–µ ‚Äî –∏–∑ Supabase.
                    </div>
                    
                    <div class="data-table-container" style="max-height: 300px; overflow-y: auto;">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>–£—á–∞—Å—Ç–æ–∫</th>
                                    <th>–§–ò–û</th>
                                    <th>–°–æ—Ç–æ–∫</th>
                                    <th>–ë–∞–ª–∞–Ω—Å</th>
                                    <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                                </tr>
                            </thead>
                            <tbody id="adminUsersTable">
                                <tr>
                                    <td>15</td>
                                    <td>–ò–≤–∞–Ω–æ–≤ –ò.–ò.</td>
                                    <td>6</td>
                                    <td>0.00 —Ä—É–±</td>
                                    <td>
                                        <button class="btn btn-secondary" style="padding: 5px 10px; font-size: 0.8rem;">
                                            –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
                                        </button>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    
                    <div style="margin-top: 20px;">
                        <button class="btn" onclick="loadUsersData()">üîÑ –û–±–Ω–æ–≤–∏—Ç—å —Å–ø–∏—Å–æ–∫</button>
                        <button class="btn btn-success" onclick="exportUsersData()">üì• –≠–∫—Å–ø–æ—Ä—Ç –≤ CSV</button>
                    </div>
                </div>
                
                <div class="admin-section">
                    <h3>üì¶ –ü–∞–∫–µ—Ç–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞</h3>
                    
                    <div class="form-group">
                        <label>–í—ã–±–µ—Ä–∏—Ç–µ –¥–µ–π—Å—Ç–≤–∏–µ:</label>
                        <select id="bulkAction" class="form-control">
                            <option value="import">–ò–º–ø–æ—Ä—Ç –ø–æ–∫–∞–∑–∞–Ω–∏–π</option>
                            <option value="export">–≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö</option>
                            <option value="calculate">–ú–∞—Å—Å–æ–≤—ã–π —Ä–∞—Å—á–µ—Ç</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label>–î–∞–Ω–Ω—ã–µ (JSON —Ñ–æ—Ä–º–∞—Ç):</label>
                        <textarea id="bulkData" rows="8" placeholder='[{"user_id": "123", "reading": 1450, "month": "2026-01"}]'></textarea>
                    </div>
                    
                    <div class="action-buttons">
                        <button class="btn" onclick="processBulkAction()">üöÄ –í—ã–ø–æ–ª–Ω–∏—Ç—å</button>
                        <button class="btn btn-secondary" onclick="downloadTemplate()">üìÑ –®–∞–±–ª–æ–Ω</button>
                    </div>
                </div>
                
                <div class="admin-section">
                    <h3>‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–∏—Å—Ç–µ–º—ã</h3>
                    
                    <div class="form-group">
                        <label>–¢–µ–∫—É—â–∏–π –º–µ—Å—è—Ü –¥–ª—è —Ä–∞—Å—á–µ—Ç–æ–≤:</label>
                        <select id="systemMonth" class="form-control">
                            <option value="2026-01">–Ø–Ω–≤–∞—Ä—å 2026</option>
                            <option value="2026-02">–§–µ–≤—Ä–∞–ª—å 2026</option>
                            <option value="2026-03">–ú–∞—Ä—Ç 2026</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label>–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª-–≤–æ —Å—á–µ—Ç—á–∏–∫–æ–≤ –Ω–∞ —É—á–∞—Å—Ç–æ–∫:</label>
                        <input type="number" id="maxMeters" value="3" min="1" max="10">
                    </div>
                    
                    <div class="form-group">
                        <label>–ü–æ—Ä–æ–≥ –¥–ª—è –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è (—Ä—É–±):</label>
                        <input type="number" id="reminderThreshold" value="5000" min="0">
                    </div>
                    
                    <button class="btn" onclick="saveSystemSettings()">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏</button>
                    
                    <div style="margin-top: 30px; padding-top: 20px; border-top: 1px solid #e5e7eb;">
                        <button class="btn btn-danger" onclick="resetDemoData()">
                            üóëÔ∏è –°–±—Ä–æ—Å–∏—Ç—å –¥–µ–º–æ-–¥–∞–Ω–Ω—ã–µ
                        </button>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- –¢–µ—Å—Ç —Å–∏—Å—Ç–µ–º—ã -->
        <div id="api-test" class="tab-content">
            <div class="user-header">
                <div>
                    <h2>üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã</h2>
                    <p>–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ Supabase –∏ API</p>
                </div>
            </div>
            
            <div class="card">
                <h3>üîå –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è</h3>
                
                <div class="alert alert-warning">
                    <strong>–û–±—ä—è—Å–Ω–µ–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤:</strong><br>
                    1. "connection" —Ç–µ—Å—Ç –º–æ–∂–µ—Ç –ø–∞–¥–∞—Ç—å ‚Äî Supabase –±–ª–æ–∫–∏—Ä—É–µ—Ç –¥–æ—Å—Ç—É–ø –∫ –∫–æ—Ä–Ω–µ–≤–æ–º—É URL –±–µ–∑ –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤<br>
                    2. "rest" —Ç–µ—Å—Ç –¥–æ–ª–∂–µ–Ω —Ä–∞–±–æ—Ç–∞—Ç—å ‚Äî —ç—Ç–æ –ø—Ä–æ–≤–µ—Ä–∫–∞ REST API<br>
                    3. "auth" —Ç–µ—Å—Ç –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å —Å–µ—Ä–≤–∏—Å–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏<br>
                    4. –í–∞—à–∏ —Ç–∞–±–ª–∏—Ü—ã —É–∂–µ —Å–æ–∑–¥–∞–Ω—ã –≤ Supabase (REST API –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç 6 —Ç–∞–±–ª–∏—Ü)
                </div>
                
                <div class="action-buttons">
                    <button class="btn" onclick="testConnection()">
                        <span class="loading hidden" id="test1Loading"></span>
                        –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ
                    </button>
                    <button class="btn" onclick="testRestAPI()">
                        <span class="loading hidden" id="test2Loading"></span>
                        –ü—Ä–æ–≤–µ—Ä–∏—Ç—å REST API
                    </button>
                    <button class="btn" onclick="testAuthAPI()">
                        <span class="loading hidden" id="test3Loading"></span>
                        –ü—Ä–æ–≤–µ—Ä–∏—Ç—å Auth API
                    </button>
                    <button class="btn btn-success" onclick="runAllAPITests()">
                        <span class="loading hidden" id="testAllLoading"></span>
                        –ó–∞–ø—É—Å—Ç–∏—Ç—å –≤—Å–µ —Ç–µ—Å—Ç—ã
                    </button>
                </div>
                
                <div class="test-results">
                    <div id="testResults">
                        <!-- –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–æ–≤ –±—É–¥—É—Ç –∑–¥–µ—Å—å -->
                    </div>
                </div>
                
                <div style="margin-top: 30px;">
                    <h4>üìä –í–∞—à–∏ —Ç–µ–∫—É—â–∏–µ —Ç–∞–±–ª–∏—Ü—ã –≤ Supabase:</h4>
                    <div class="alert alert-success">
                        ‚úÖ REST API —É—Å–ø–µ—à–Ω–æ –ø–æ–¥–∫–ª—é—á–µ–Ω –∏ –æ–±–Ω–∞—Ä—É–∂–∏–ª <strong>6 —Ç–∞–±–ª–∏—Ü</strong><br>
                        <small>–≠—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ –≤–∞—à–∞ –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞ –∏ –≥–æ—Ç–æ–≤–∞ –∫ —Ä–∞–±–æ—Ç–µ</small>
                    </div>
                    
                    <div class="data-table-container">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>–¢–∞–±–ª–∏—Ü–∞</th>
                                    <th>–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ</th>
                                    <th>–°—Ç–∞—Ç—É—Å</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>profiles</td>
                                    <td>–ü—Ä–æ—Ñ–∏–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</td>
                                    <td><span class="success-icon">‚úì –ù–∞–π–¥–µ–Ω–∞</span></td>
                                </tr>
                                <tr>
                                    <td>tariffs</td>
                                    <td>–¢–∞—Ä–∏—Ñ—ã –Ω–∞ —ç–ª–µ–∫—Ç—Ä–æ—ç–Ω–µ—Ä–≥–∏—é</td>
                                    <td><span class="success-icon">‚úì –ù–∞–π–¥–µ–Ω–∞</span></td>
                                </tr>
                                <tr>
                                    <td>electricity_readings</td>
                                    <td>–ü–æ–∫–∞–∑–∞–Ω–∏—è —Å—á–µ—Ç—á–∏–∫–æ–≤</td>
                                    <td><span class="success-icon">‚úì –ù–∞–π–¥–µ–Ω–∞</span></td>
                                </tr>
                                <tr>
                                    <td>membership_fees</td>
                                    <td>–ß–ª–µ–Ω—Å–∫–∏–µ –≤–∑–Ω–æ—Å—ã</td>
                                    <td><span class="success-icon">‚úì –ù–∞–π–¥–µ–Ω–∞</span></td>
                                </tr>
                                <tr>
                                    <td>test_table</td>
                                    <td>–¢–µ—Å—Ç–æ–≤–∞—è —Ç–∞–±–ª–∏—Ü–∞</td>
                                    <td><span class="success-icon">‚úì –ù–∞–π–¥–µ–Ω–∞</span></td>
                                </tr>
                                <tr>
                                    <td>meters</td>
                                    <td>–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å—á–µ—Ç—á–∏–∫–∞—Ö</td>
                                    <td><span class="success-icon">‚úì –ù–∞–π–¥–µ–Ω–∞</span></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
                
                <div style="margin-top: 30px; padding: 20px; background: #f0f9ff; border-radius: 8px;">
                    <h4>üöÄ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ:</h4>
                    <ol style="margin-left: 20px; margin-top: 10px;">
                        <li>–í–∫–ª—é—á–∏—Ç–µ Email Auth –≤ Supabase Dashboard ‚Üí Authentication</li>
                        <li>–ù–∞—Å—Ç—Ä–æ–π—Ç–µ RLS (Row Level Security) –¥–ª—è –∫–∞–∂–¥–æ–π —Ç–∞–±–ª–∏—Ü—ã</li>
                        <li>–î–æ–±–∞–≤—å—Ç–µ –¥–æ–º–µ–Ω GitHub Pages –≤ CORS –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö Supabase</li>
                        <li>–ó–∞–º–µ–Ω–∏—Ç–µ –¥–µ–º–æ-—Ñ—É–Ω–∫—Ü–∏–∏ –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã–µ –≤—ã–∑–æ–≤—ã –∫ API</li>
                        <li>–ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ —Å —Ä–µ–∞–ª—å–Ω—ã–º–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏</li>
                    </ol>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ==================== –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø ====================
        const SUPABASE_URL = 'https://chgbdbuiqzdmwiniyxrk.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImNoZ2JkYnVpcXpkbXdpbml5eHJrIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njg5NzY5MzUsImV4cCI6MjA4NDU1MjkzNX0.KvpKM7FggBOWNuFR8gmL7cjk64tt6CCgAI-UlkP7ZXU';
        
        // –°–æ—Å—Ç–æ—è–Ω–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
        let currentUser = null;
        let userProfile = null;
        let isAdmin = false;
        let currentMonth = '2026-01';
        
        // ==================== –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø ====================
        document.addEventListener('DOMContentLoaded', async () => {
            console.log('üöÄ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –°–ù–¢ "–ó–≤–µ–∑–¥–æ—á–∫–∞"');
            
            // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –≤–∫–ª–∞–¥–æ–∫
            setupTabs();
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ Supabase
            await checkSupabaseStatus();
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
            await checkAuth();
            
            // –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Ç–µ–∫—É—â–µ–≥–æ –º–µ—Å—è—Ü–∞
            updateCurrentMonth();
            
            // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–µ–º–æ-–¥–∞–Ω–Ω—ã—Ö
            loadDemoData();
        });
        
        // ==================== –£–¢–ò–õ–ò–¢–´ ====================
        function setupTabs() {
            document.querySelectorAll('.tab').forEach(tab => {
                tab.addEventListener('click', function() {
                    const tabId = this.getAttribute('data-tab');
                    
                    // –°–∫—Ä—ã—Ç—å –≤—Å–µ –≤–∫–ª–∞–¥–∫–∏
                    document.querySelectorAll('.tab-content').forEach(content => {
                        content.classList.remove('active');
                    });
                    
                    // –£–±—Ä–∞—Ç—å –∞–∫—Ç–∏–≤–Ω—ã–π –∫–ª–∞—Å—Å
                    document.querySelectorAll('.tab').forEach(t => {
                        t.classList.remove('active');
                    });
                    
                    // –ü–æ–∫–∞–∑–∞—Ç—å –≤—ã–±—Ä–∞–Ω–Ω—É—é –≤–∫–ª–∞–¥–∫—É
                    document.getElementById(tabId).classList.add('active');
                    this.classList.add('active');
                    
                    // –ó–∞–≥—Ä—É–∑–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –¥–ª—è –≤–∫–ª–∞–¥–∫–∏
                    loadTabData(tabId);
                });
            });
        }
        
        function updateCurrentMonth() {
            const now = new Date();
            const monthNames = [
                '–Ø–Ω–≤–∞—Ä—å', '–§–µ–≤—Ä–∞–ª—å', '–ú–∞—Ä—Ç', '–ê–ø—Ä–µ–ª—å', '–ú–∞–π', '–ò—é–Ω—å',
                '–ò—é–ª—å', '–ê–≤–≥—É—Å—Ç', '–°–µ–Ω—Ç—è–±—Ä—å', '–û–∫—Ç—è–±—Ä—å', '–ù–æ—è–±—Ä—å', '–î–µ–∫–∞–±—Ä—å'
            ];
            
            currentMonth = `${now.getFullYear()}-${String(now.getMonth() + 1).padStart(2, '0')}`;
            const displayMonth = `${monthNames[now.getMonth()]} ${now.getFullYear()}`;
            
            document.getElementById('currentMonthDisplay').textContent = displayMonth;
            document.getElementById('currentMonthForReading').textContent = displayMonth;
        }
        
        // ==================== –ü–†–û–í–ï–†–ö–ê –ü–û–î–ö–õ–Æ–ß–ï–ù–ò–Ø ====================
        async function checkSupabaseStatus() {
            const statusElement = document.getElementById('apiStatus');
            
            try {
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º REST API (—ç—Ç–æ –±–æ–ª–µ–µ –Ω–∞–¥–µ–∂–Ω—ã–π —Ç–µ—Å—Ç)
                const response = await fetch(`${SUPABASE_URL}/rest/v1/`, {
                    headers: {
                        'apikey': SUPABASE_ANON_KEY,
                        'Authorization': `Bearer ${SUPABASE_ANON_KEY}`,
                        'Accept': 'application/json'
                    }
                });
                
                if (response.ok) {
                    statusElement.textContent = '‚úÖ –ü–æ–¥–∫–ª—é—á–µ–Ω–æ';
                    statusElement.className = 'status-badge status-success';
                    
                    const data = await response.json();
                    console.log('‚úÖ Supabase –ø–æ–¥–∫–ª—é—á–µ–Ω. –¢–∞–±–ª–∏—Ü –æ–±–Ω–∞—Ä—É–∂–µ–Ω–æ:', Object.keys(data.paths || {}).length);
                    
                    return true;
                } else {
                    statusElement.textContent = '‚ö†Ô∏è –û–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã–π –¥–æ—Å—Ç—É–ø';
                    statusElement.className = 'status-badge status-warning';
                    return false;
                }
            } catch (error) {
                statusElement.textContent = '‚ùå –û—à–∏–±–∫–∞';
                statusElement.className = 'status-badge status-error';
                console.error('–û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ Supabase:', error);
                return false;
            }
        }
        
        // ==================== –ê–í–¢–û–†–ò–ó–ê–¶–ò–Ø ====================
        async function checkAuth() {
            try {
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º localStorage
                const savedUser = localStorage.getItem('snt_user');
                const savedProfile = localStorage.getItem('snt_profile');
                
                if (savedUser && savedProfile) {
                    currentUser = JSON.parse(savedUser);
                    userProfile = JSON.parse(savedProfile);
                    isAdmin = userProfile.role === 'admin';
                    
                    updateUIForLoggedInUser();
                    return true;
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏:', error);
            }
            
            updateUIForLoggedOutUser();
            return false;
        }
        
        function login() {
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;
            
            if (!email || !password) {
                showAlert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∑–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è', 'error');
                return;
            }
            
            // –î–µ–º–æ-—Ä–µ–∂–∏–º: —Å–æ–∑–¥–∞–µ–º —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            currentUser = {
                id: 'demo-user-' + Date.now(),
                email: email,
                created_at: new Date().toISOString()
            };
            
            userProfile = {
                id: currentUser.id,
                full_name: email.includes('admin') ? '–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –°–ù–¢' : '–ò–≤–∞–Ω–æ–≤ –ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤–∏—á',
                plot_number: email.includes('15') ? '15' : '25',
                plot_area: 6,
                role: email.includes('admin') ? 'admin' : 'user',
                email: email,
                created_at: new Date().toISOString()
            };
            
            isAdmin = userProfile.role === 'admin';
            
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ localStorage
            localStorage.setItem('snt_user', JSON.stringify(currentUser));
            localStorage.setItem('snt_profile', JSON.stringify(userProfile));
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
            updateUIForLoggedInUser();
            
            // –ü–µ—Ä–µ—Ö–æ–¥–∏–º –≤ –ª–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç
            document.querySelector('[data-tab="user-dashboard"]').click();
            
            showAlert(`–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, ${userProfile.full_name}!`, 'success');
        }
        
        function loginAsAdmin() {
            document.getElementById('loginEmail').value = 'admin@zvezdochka.ru';
            document.getElementById('loginPassword').value = 'admin123';
            login();
        }
        
        function register() {
            const fullName = document.getElementById('registerFullName').value;
            const email = document.getElementById('registerEmail').value;
            const plotNumber = document.getElementById('registerPlotNumber').value;
            const plotArea = document.getElementById('registerPlotArea').value;
            const password = document.getElementById('registerPassword').value;
            const passwordConfirm = document.getElementById('registerPasswordConfirm').value;
            
            // –í–∞–ª–∏–¥–∞—Ü–∏—è
            if (!fullName || !email || !plotNumber || !password) {
                showAlert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∑–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è', 'error');
                return;
            }
            
            if (password !== passwordConfirm) {
                showAlert('–ü–∞—Ä–æ–ª–∏ –Ω–µ —Å–æ–≤–ø–∞–¥–∞—é—Ç', 'error');
                return;
            }
            
            if (password.length < 6) {
                showAlert('–ü–∞—Ä–æ–ª—å –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å –º–∏–Ω–∏–º—É–º 6 —Å–∏–º–≤–æ–ª–æ–≤', 'error');
                return;
            }
            
            // –í –†–ï–ê–õ–¨–ù–û–ú –ü–†–ò–õ–û–ñ–ï–ù–ò–ò:
            // 1. –í—ã–∑–æ–≤–∏—Ç–µ supabase.auth.signUp({ email, password })
            // 2. –°–æ–∑–¥–∞–π—Ç–µ –∑–∞–ø–∏—Å—å –≤ —Ç–∞–±–ª–∏—Ü–µ profiles
            // 3. –û—Ç–ø—Ä–∞–≤—å—Ç–µ email –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è
            
            // –î–µ–º–æ-—Ä–µ–∂–∏–º
            currentUser = {
                id: 'new-user-' + Date.now(),
                email: email,
                created_at: new Date().toISOString()
            };
            
            userProfile = {
                id: currentUser.id,
                full_name: fullName,
                plot_number: plotNumber,
                plot_area: parseFloat(plotArea) || 6,
                role: 'user',
                email: email,
                created_at: new Date().toISOString()
            };
            
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º
            localStorage.setItem('snt_user', JSON.stringify(currentUser));
            localStorage.setItem('snt_profile', JSON.stringify(userProfile));
            
            hideRegister();
            showAlert('–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–∞! –¢–µ–ø–µ—Ä—å –≤—ã –º–æ–∂–µ—Ç–µ –≤–æ–π—Ç–∏.', 'success');
            
            // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤—Ö–æ–¥–∏–º
            document.getElementById('loginEmail').value = email;
            document.getElementById('loginPassword').value = password;
            setTimeout(() => login(), 500);
        }
        
        function logout() {
            currentUser = null;
            userProfile = null;
            isAdmin = false;
            
            localStorage.removeItem('snt_user');
            localStorage.removeItem('snt_profile');
            
            updateUIForLoggedOutUser();
            document.querySelector('[data-tab="login"]').click();
            
            showAlert('–í—ã —É—Å–ø–µ—à–Ω–æ –≤—ã—à–ª–∏ –∏–∑ —Å–∏—Å—Ç–µ–º—ã', 'info');
        }
        
        function updateUIForLoggedInUser() {
            // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å
            document.getElementById('userStatus').textContent = userProfile.full_name;
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –≤–∫–ª–∞–¥–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            document.getElementById('userTab').classList.remove('hidden');
            if (isAdmin) {
                document.getElementById('adminTab').classList.remove('hidden');
            } else {
                document.getElementById('adminTab').classList.add('hidden');
            }
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ –≤ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ
            document.getElementById('userGreeting').textContent = `–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, ${userProfile.full_name}!`;
            document.getElementById('userPlotNumber').textContent = userProfile.plot_number;
            document.getElementById('userPlotArea').textContent = userProfile.plot_area;
            document.getElementById('userPlotAreaDisplay').textContent = userProfile.plot_area;
            
            // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            loadUserData();
        }
        
        function updateUIForLoggedOutUser() {
            document.getElementById('userStatus').textContent = '–ù–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω';
            document.getElementById('userTab').classList.add('hidden');
            document.getElementById('adminTab').classList.add('hidden');
        }
        
        // ==================== –†–ê–°–ß–ï–¢–´ ====================
        function calculateElectricityCost(consumption) {
            // –°–ª–æ–∂–Ω—ã–π —Ç—Ä–µ—Ö—Å—Ç—É–ø–µ–Ω—á–∞—Ç—ã–π —Ç–∞—Ä–∏—Ñ
            const lossTariff = parseFloat(document.getElementById('tariffLoss').textContent) || 0.36;
            const lowTariff = parseFloat(document.getElementById('tariffLow').textContent) || 6.10;
            const highTariff = parseFloat(document.getElementById('tariffHigh').textContent) || 7.30;
            
            // 1. –ü–æ—Ç–µ—Ä–∏ (–≤—Å—è –ø–æ—Ç—Ä–µ–±–ª–µ–Ω–Ω–∞—è —ç–Ω–µ—Ä–≥–∏—è)
            const lossCost = consumption * lossTariff;
            
            // 2. –î–æ 100 –∫–í—Ç¬∑—á
            const lowConsumption = Math.min(consumption, 100);
            const lowCost = lowConsumption * lowTariff;
            
            // 3. –°–≤—ã—à–µ 100 –∫–í—Ç¬∑—á
            let highCost = 0;
            if (consumption > 100) {
                const highConsumption = consumption - 100;
                highCost = highConsumption * highTariff;
            }
            
            // –ò—Ç–æ–≥–æ
            const totalCost = lossCost + lowCost + highCost;
            
            return {
                lossCost: lossCost.toFixed(2),
                lowCost: lowCost.toFixed(2),
                highCost: highCost.toFixed(2),
                totalCost: totalCost.toFixed(2),
                consumption: consumption
            };
        }
        
        function calculateMembershipCost() {
            const salaryFee = parseFloat(document.getElementById('salaryFee').textContent) || 939.00;
            const maintenanceFee = parseFloat(document.getElementById('maintenanceFee').textContent) || 44.00;
            const plotArea = parseFloat(document.getElementById('userPlotAreaDisplay').textContent) || 6;
            
            const maintenanceCost = maintenanceFee * plotArea;
            const total = salaryFee + maintenanceCost;
            
            return {
                salaryFee: salaryFee.toFixed(2),
                maintenanceCost: maintenanceCost.toFixed(2),
                total: total.toFixed(2)
            };
        }
        
        // ==================== –î–ê–ù–ù–´–ï –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–Ø ====================
        function loadUserData() {
            if (!userProfile) return;
            
            // –†–∞—Å—á–µ—Ç —á–ª–µ–Ω—Å–∫–∏—Ö –≤–∑–Ω–æ—Å–æ–≤
            const membership = calculateMembershipCost();
            document.getElementById('membershipTotal').textContent = membership.total;
            document.getElementById('membershipAmount').textContent = membership.total;
            
            // –ü—Ä–∏–º–µ—Ä —Ä–∞—Å—á–µ—Ç–∞ —ç–ª–µ–∫—Ç—Ä–æ—ç–Ω–µ—Ä–≥–∏–∏ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 200 –∫–í—Ç¬∑—á)
            const electricity = calculateElectricityCost(200);
            document.getElementById('electricityAmount').textContent = electricity.totalCost;
            
            // –û–±—â–∏–π –∏—Ç–æ–≥
            const total = (parseFloat(electricity.totalCost) + parseFloat(membership.total)).toFixed(2);
            document.getElementById('totalAmount').textContent = total;
        }
        
        function loadDemoData() {
            // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–µ–º–æ-—Ç–∞—Ä–∏—Ñ—ã
            document.getElementById('tariffLoss').textContent = '0.36';
            document.getElementById('tariffLow').textContent = '6.10';
            document.getElementById('tariffHigh').textContent = '7.30';
            document.getElementById('tariffDate').textContent = '01.01.2026';
            document.getElementById('salaryFee').textContent = '939.00';
            document.getElementById('maintenanceFee').textContent = '44.00';
        }
        
        function loadTabData(tabId) {
            switch(tabId) {
                case 'user-dashboard':
                    loadUserData();
                    break;
                case 'admin':
                    if (isAdmin) loadAdminData();
                    break;
            }
        }
        
        // ==================== –ü–û–ö–ê–ó–ê–ù–ò–Ø –°–ß–ï–¢–ß–ò–ö–û–í ====================
        function calculateConsumption() {
            const reading1 = parseFloat(document.getElementById('meterReading1').value);
            
            if (!reading1 || isNaN(reading1)) {
                showAlert('–í–≤–µ–¥–∏—Ç–µ –ø–æ–∫–∞–∑–∞–Ω–∏—è –ø–µ—Ä–≤–æ–≥–æ —Å—á–µ—Ç—á–∏–∫–∞', 'warning');
                return;
            }
            
            const previous1 = 1250; // –î–µ–º–æ-–¥–∞–Ω–Ω—ã–µ
            const consumption1 = reading1 - previous1;
            
            if (consumption1 < 0) {
                showAlert('–¢–µ–∫—É—â–∏–µ –ø–æ–∫–∞–∑–∞–Ω–∏—è –Ω–µ –º–æ–≥—É—Ç –±—ã—Ç—å –º–µ–Ω—å—à–µ –ø—Ä–µ–¥—ã–¥—É—â–∏—Ö', 'error');
                return;
            }
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ä–∞—Å—á–µ—Ç
            document.getElementById('meter1Calculation').style.display = 'block';
            document.getElementById('current1').textContent = reading1;
            document.getElementById('consumptionCalc1').textContent = consumption1;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –≤ –ª–∏—á–Ω–æ–º –∫–∞–±–∏–Ω–µ—Ç–µ
            document.getElementById('currentReading1').textContent = reading1 + ' –∫–í—Ç¬∑—á';
            document.getElementById('consumption1').textContent = consumption1;
            
            // –†–∞—Å—á–µ—Ç —Å—Ç–æ–∏–º–æ—Å—Ç–∏
            const electricity = calculateElectricityCost(consumption1);
            document.getElementById('electricityAmount').textContent = electricity.totalCost;
            
            // –û–±—â–∏–π –∏—Ç–æ–≥
            const membership = calculateMembershipCost();
            const total = (parseFloat(electricity.totalCost) + parseFloat(membership.total)).toFixed(2);
            document.getElementById('totalAmount').textContent = total;
            
            showAlert(`–†–∞—Å—á–µ—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω: ${consumption1} –∫–í—Ç¬∑—á = ${electricity.totalCost} —Ä—É–±`, 'success');
        }
        
        function submitMeterReadings() {
            const reading1 = document.getElementById('meterReading1').value;
            
            if (!reading1) {
                showAlert('–í–≤–µ–¥–∏—Ç–µ –ø–æ–∫–∞–∑–∞–Ω–∏—è —Ö–æ—Ç—è –±—ã –æ–¥–Ω–æ–≥–æ —Å—á–µ—Ç—á–∏–∫–∞', 'error');
                return;
            }
            
            // –í –†–ï–ê–õ–¨–ù–û–ú –ü–†–ò–õ–û–ñ–ï–ù–ò–ò:
            // 1. –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ –ø–æ–∫–∞–∑–∞–Ω–∏—è –≤ —Ç–∞–±–ª–∏—Ü—É electricity_readings
            // 2. –û–±–Ω–æ–≤–∏—Ç–µ –ø—Ä–µ–¥—ã–¥—É—â–∏–µ –ø–æ–∫–∞–∑–∞–Ω–∏—è
            // 3. –û—Ç–ø—Ä–∞–≤—å—Ç–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É
            
            showAlert('‚úÖ –ü–æ–∫–∞–∑–∞–Ω–∏—è —É—Å–ø–µ—à–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω—ã! –°—É–º–º–∞ –∫ –æ–ø–ª–∞—Ç–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∞.', 'success');
            
            // –ü–µ—Ä–µ—Ö–æ–¥–∏–º –≤ –ª–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç
            setTimeout(() => {
                document.querySelector('[data-tab="user-dashboard"]').click();
            }, 1500);
        }
        
        function addAnotherMeter() {
            const metersContainer = document.getElementById('metersContainer');
            const meterCount = metersContainer.querySelectorAll('.meter-card').length;
            
            if (meterCount >= 5) {
                showAlert('–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å—á–µ—Ç—á–∏–∫–æ–≤: 5', 'warning');
                return;
            }
            
            const newMeter = document.createElement('div');
            newMeter.className = 'meter-card';
            newMeter.innerHTML = `
                <h4>–°—á–µ—Ç—á–∏–∫ #${meterCount + 1} (–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π)</h4>
                <div class="form-group">
                    <label>–¢–µ–∫—É—â–∏–µ –ø–æ–∫–∞–∑–∞–Ω–∏—è (–∫–í—Ç¬∑—á):</label>
                    <div class="counter-input-group">
                        <input type="number" placeholder="–í–≤–µ–¥–∏—Ç–µ –ø–æ–∫–∞–∑–∞–Ω–∏—è" min="0" step="1">
                        <span style="color: #6b7280;">–ü—Ä–µ–¥—ã–¥—É—â–µ–µ: 0 –∫–í—Ç¬∑—á</span>
                    </div>
                </div>
            `;
            
            metersContainer.appendChild(newMeter);
            showAlert(`–î–æ–±–∞–≤–ª–µ–Ω —Å—á–µ—Ç—á–∏–∫ #${meterCount + 1}`, 'info');
        }
        
        // ==================== –ê–î–ú–ò–ù-–ü–ê–ù–ï–õ–¨ ====================
        function loadAdminData() {
            if (!isAdmin) return;
            
            // –ó–∞–≥—Ä—É–∂–∞–µ–º —Ç–µ–∫—É—â–∏–µ —Ç–∞—Ä–∏—Ñ—ã –≤ —Ñ–æ—Ä–º—É
            document.getElementById('adminTariffLoss').value = document.getElementById('tariffLoss').textContent;
            document.getElementById('adminTariffLow').value = document.getElementById('tariffLow').textContent;
            document.getElementById('adminTariffHigh').value = document.getElementById('tariffHigh').textContent;
            document.getElementById('adminSalaryFee').value = document.getElementById('salaryFee').textContent;
            document.getElementById('adminMaintenanceFee').value = document.getElementById('maintenanceFee').textContent;
        }
        
        function saveTariffs() {
            if (!isAdmin) {
                showAlert('–î–æ—Å—Ç—É–ø–Ω–æ —Ç–æ–ª—å–∫–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞–º', 'error');
                return;
            }
            
            const lossTariff = document.getElementById('adminTariffLoss').value;
            const lowTariff = document.getElementById('adminTariffLow').value;
            const highTariff = document.getElementById('adminTariffHigh').value;
            const salaryFee = document.getElementById('adminSalaryFee').value;
            const maintenanceFee = document.getElementById('adminMaintenanceFee').value;
            
            // –í –†–ï–ê–õ–¨–ù–û–ú –ü–†–ò–õ–û–ñ–ï–ù–ò–ò:
            // 1. –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ –≤ —Ç–∞–±–ª–∏—Ü—É tariffs –≤ Supabase
            // 2. –£–∫–∞–∂–∏—Ç–µ –¥–∞—Ç—É –≤—Å—Ç—É–ø–ª–µ–Ω–∏—è –≤ —Å–∏–ª—É
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
            document.getElementById('tariffLoss').textContent = lossTariff;
            document.getElementById('tariffLow').textContent = lowTariff;
            document.getElementById('tariffHigh').textContent = highTariff;
            document.getElementById('salaryFee').textContent = salaryFee;
            document.getElementById('maintenanceFee').textContent = maintenanceFee;
            
            showAlert('‚úÖ –¢–∞—Ä–∏—Ñ—ã —É—Å–ø–µ—à–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω—ã!', 'success');
            
            // –ü–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ–º –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            if (userProfile) {
                loadUserData();
            }
        }
        
        function exportUsersData() {
            // –î–µ–º–æ-—Ñ—É–Ω–∫—Ü–∏—è —ç–∫—Å–ø–æ—Ä—Ç–∞
            const data = [
                ['–£—á–∞—Å—Ç–æ–∫', '–§–ò–û', 'Email', '–°–æ—Ç–æ–∫', '–ë–∞–ª–∞–Ω—Å'],
                ['15', '–ò–≤–∞–Ω–æ–≤ –ò.–ò.', 'demo@zvezdochka.ru', '6', '0.00'],
                ['25', '–ü–µ—Ç—Ä–æ–≤ –ü.–ü.', 'user2@example.com', '8', '1,250.50'],
                ['30', '–°–∏–¥–æ—Ä–æ–≤ –°.–°.', 'user3@example.com', '5', '-500.00']
            ];
            
            const csv = data.map(row => row.join(',')).join('\n');
            const blob = new Blob([csv], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `snt_users_${new Date().toISOString().split('T')[0]}.csv`;
            a.click();
            
            showAlert('–î–∞–Ω–Ω—ã–µ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã –≤ CSV', 'success');
        }
        
        function processBulkAction() {
            const action = document.getElementById('bulkAction').value;
            const data = document.getElementById('bulkData').value;
            
            if (!data.trim() && action !== 'export') {
                showAlert('–í–≤–µ–¥–∏—Ç–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏', 'warning');
                return;
            }
            
            // –î–µ–º–æ-–æ–±—Ä–∞–±–æ—Ç–∫–∞
            switch(action) {
                case 'import':
                    showAlert('–î–∞–Ω–Ω—ã–µ —É—Å–ø–µ—à–Ω–æ –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã (–¥–µ–º–æ-—Ä–µ–∂–∏–º)', 'success');
                    break;
                case 'export':
                    exportUsersData();
                    break;
                case 'calculate':
                    showAlert('–ú–∞—Å—Å–æ–≤—ã–π —Ä–∞—Å—á–µ—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω (–¥–µ–º–æ-—Ä–µ–∂–∏–º)', 'success');
                    break;
            }
        }
        
        function downloadTemplate() {
            const template = `[
  {
    "user_id": "ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è",
    "meter_number": "–ù–æ–º–µ—Ä —Å—á–µ—Ç—á–∏–∫–∞",
    "reading": 1000,
    "month": "2026-01",
    "notes": "–ü—Ä–∏–º–µ—á–∞–Ω–∏—è"
  }
]`;
            
            const blob = new Blob([template], { type: 'application/json' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'snt_import_template.json';
            a.click();
            
            showAlert('–®–∞–±–ª–æ–Ω –∑–∞–≥—Ä—É–∂–µ–Ω', 'info');
        }
        
        function saveSystemSettings() {
            const month = document.getElementById('systemMonth').value;
            const maxMeters = document.getElementById('maxMeters').value;
            const threshold = document.getElementById('reminderThreshold').value;
            
            // –í –†–ï–ê–õ–¨–ù–û–ú –ü–†–ò–õ–û–ñ–ï–ù–ò–ò —Å–æ—Ö—Ä–∞–Ω–∏—Ç–µ –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö
            
            showAlert('–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–∏—Å—Ç–µ–º—ã —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã', 'success');
        }
        
        function resetDemoData() {
            if (!confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã? –í—Å–µ –¥–µ–º–æ-–¥–∞–Ω–Ω—ã–µ –±—É–¥—É—Ç —Å–±—Ä–æ—à–µ–Ω—ã.')) return;
            
            localStorage.clear();
            location.reload();
        }
        
        // ==================== –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï API ====================
        async function testConnection() {
            const loading = document.getElementById('test1Loading');
            const results = document.getElementById('testResults');
            
            loading.classList.remove('hidden');
            
            try {
                // –ü—Ä—è–º–æ–π –∑–∞–ø—Ä–æ—Å –∫ –∫–æ—Ä–Ω—é (–º–æ–∂–µ—Ç –Ω–µ —Ä–∞–±–æ—Ç–∞—Ç—å)
                const response = await fetch(SUPABASE_URL);
                
                const result = {
                    test: 'connection',
                    status: response.ok ? 'success' : 'error',
                    message: response.ok ? 
                        '–ö–æ—Ä–Ω–µ–≤–æ–π URL –¥–æ—Å—Ç—É–ø–µ–Ω' : 
                        `–û—à–∏–±–∫–∞: ${response.status} - —ç—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ, Supabase –±–ª–æ–∫–∏—Ä—É–µ—Ç –ø—Ä—è–º–æ–π –¥–æ—Å—Ç—É–ø`
                };
                
                displayTestResult(result);
                
            } catch (error) {
                const result = {
                    test: 'connection',
                    status: 'error',
                    message: `NetworkError: ${error.message}. –≠—Ç–æ –æ–∂–∏–¥–∞–µ–º–æ - Supabase —Ç—Ä–µ–±—É–µ—Ç –∑–∞–≥–æ–ª–æ–≤–∫–∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏`
                };
                
                displayTestResult(result);
            } finally {
                loading.classList.add('hidden');
            }
        }
        
        async function testRestAPI() {
            const loading = document.getElementById('test2Loading');
            const results = document.getElementById('testResults');
            
            loading.classList.remove('hidden');
            
            try {
                const response = await fetch(`${SUPABASE_URL}/rest/v1/`, {
                    headers: {
                        'apikey': SUPABASE_ANON_KEY,
                        'Authorization': `Bearer ${SUPABASE_ANON_KEY}`,
                        'Accept': 'application/json'
                    }
                });
                
                let message = '';
                if (response.ok) {
                    const data = await response.json();
                    const tableCount = Object.keys(data.paths || {}).length;
                    message = `‚úÖ REST API —Ä–∞–±–æ—Ç–∞–µ—Ç! –û–±–Ω–∞—Ä—É–∂–µ–Ω–æ —Ç–∞–±–ª–∏—Ü: ${tableCount}`;
                } else {
                    message = `‚ùå –û—à–∏–±–∫–∞ REST API: ${response.status}`;
                }
                
                const result = {
                    test: 'rest',
                    status: response.ok ? 'success' : 'error',
                    message: message
                };
                
                displayTestResult(result);
                
            } catch (error) {
                const result = {
                    test: 'rest',
                    status: 'error',
                    message: `–û—à–∏–±–∫–∞: ${error.message}`
                };
                
                displayTestResult(result);
            } finally {
                loading.classList.add('hidden');
            }
        }
        
        async function testAuthAPI() {
            const loading = document.getElementById('test3Loading');
            
            loading.classList.remove('hidden');
            
            try {
                const response = await fetch(`${SUPABASE_URL}/auth/v1/health`, {
                    headers: {
                        'apikey': SUPABASE_ANON_KEY
                    }
                });
                
                const result = {
                    test: 'auth',
                    status: response.ok ? 'success' : 'error',
                    message: response.ok ? 
                        '‚úÖ Auth API –¥–æ—Å—Ç—É–ø–µ–Ω' : 
                        `Auth API: ${response.status} (${response.status === 404 ? '–≤–æ–∑–º–æ–∂–Ω–æ –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω' : '–æ—à–∏–±–∫–∞'})`
                };
                
                displayTestResult(result);
                
            } catch (error) {
                const result = {
                    test: 'auth',
                    status: 'error',
                    message: `–û—à–∏–±–∫–∞: ${error.message}`
                };
                
                displayTestResult(result);
            } finally {
                loading.classList.add('hidden');
            }
        }
        
        async function runAllAPITests() {
            const loading = document.getElementById('testAllLoading');
            loading.classList.remove('hidden');
            
            // –û—á–∏—â–∞–µ–º –ø—Ä–µ–¥—ã–¥—É—â–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
            document.getElementById('testResults').innerHTML = '';
            
            // –ó–∞–ø—É—Å–∫–∞–µ–º —Ç–µ—Å—Ç—ã –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ
            await testConnection();
            await testRestAPI();
            await testAuthAPI();
            
            loading.classList.add('hidden');
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏—Ç–æ–≥–æ–≤—ã–π –æ—Ç—á–µ—Ç
            const summary = document.createElement('div');
            summary.className = 'alert alert-success';
            summary.innerHTML = `
                <strong>‚úÖ –í—Å–µ —Ç–µ—Å—Ç—ã –∑–∞–≤–µ—Ä—à–µ–Ω—ã!</strong><br>
                <small>–í–∞—à Supabase –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–µ–Ω. REST API –æ–±–Ω–∞—Ä—É–∂–∏–ª 6 —Ç–∞–±–ª–∏—Ü.</small>
            `;
            
            document.getElementById('testResults').prepend(summary);
        }
        
        function displayTestResult(result) {
            const resultsDiv = document.getElementById('testResults');
            const resultDiv = document.createElement('div');
            resultDiv.className = 'test-result-item';
            
            const icon = result.status === 'success' ? '‚úÖ' : '‚ùå';
            const color = result.status === 'success' ? '#10b981' : '#ef4444';
            
            resultDiv.innerHTML = `
                <div style="display: flex; align-items: center; gap: 10px;">
                    <span style="color: ${color}; font-weight: bold;">${icon}</span>
                    <div>
                        <strong>${result.test.toUpperCase()}</strong><br>
                        <small>${result.message}</small>
                    </div>
                </div>
            `;
            
            resultsDiv.appendChild(resultDiv);
        }
        
        // ==================== –í–°–ü–û–ú–û–ì–ê–¢–ï–õ–¨–ù–´–ï –§–£–ù–ö–¶–ò–ò ====================
        function showAlert(message, type = 'info') {
            // –°–æ–∑–¥–∞–µ–º –∞–ª–µ—Ä—Ç
            const alertDiv = document.createElement('div');
            alertDiv.className = `alert alert-${type}`;
            alertDiv.innerHTML = `
                <strong>${type === 'error' ? '‚ùå' : type === 'success' ? '‚úÖ' : '‚ÑπÔ∏è'}</strong>
                <span>${message}</span>
            `;
            
            // –î–æ–±–∞–≤–ª—è–µ–º –≤ –Ω–∞—á–∞–ª–æ body
            document.body.prepend(alertDiv);
            
            // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É–¥–∞–ª—è–µ–º —á–µ—Ä–µ–∑ 5 —Å–µ–∫—É–Ω–¥
            setTimeout(() => {
                alertDiv.remove();
            }, 5000);
        }
        
        function showRegister() {
            document.getElementById('registerSection').classList.remove('hidden');
        }
        
        function hideRegister() {
            document.getElementById('registerSection').classList.add('hidden');
        }
        
        // ==================== –†–ï–ê–õ–¨–ù–´–ï –§–£–ù–ö–¶–ò–ò –î–õ–Ø SUPABASE ====================
        // –≠—Ç–∏ —Ñ—É–Ω–∫—Ü–∏–∏ –Ω—É–∂–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –¥–ª—è —Ä–µ–∞–ª—å–Ω–æ–π —Ä–∞–±–æ—Ç—ã —Å Supabase
        
        async function realLogin(email, password) {
            /* –†–ï–ê–õ–¨–ù–ê–Ø –†–ï–ê–õ–ò–ó–ê–¶–ò–Ø:
            const { data, error } = await supabase.auth.signInWithPassword({
                email: email,
                password: password
            });
            
            if (error) throw error;
            
            // –ü–æ–ª—É—á–∞–µ–º –ø—Ä–æ—Ñ–∏–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            const { data: profile, error: profileError } = await supabase
                .from('profiles')
                .select('*')
                .eq('id', data.user.id)
                .single();
            
            return { user: data.user, profile };
            */
        }
        
        async function realRegister(email, password, userData) {
            /* –†–ï–ê–õ–¨–ù–ê–Ø –†–ï–ê–õ–ò–ó–ê–¶–ò–Ø:
            // 1. –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –≤ Auth
            const { data: authData, error: authError } = await supabase.auth.signUp({
                email: email,
                password: password
            });
            
            if (authError) throw authError;
            
            // 2. –°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è
            const { data: profile, error: profileError } = await supabase
                .from('profiles')
                .insert([
                    {
                        id: authData.user.id,
                        email: email,
                        full_name: userData.full_name,
                        plot_number: userData.plot_number,
                        plot_area: userData.plot_area,
                        role: 'user'
                    }
                ])
                .select()
                .single();
            
            return profile;
            */
        }
        
        async function realSaveMeterReading(userId, meterData) {
            /* –†–ï–ê–õ–¨–ù–ê–Ø –†–ï–ê–õ–ò–ó–ê–¶–ò–Ø:
            const { data, error } = await supabase
                .from('electricity_readings')
                .insert([
                    {
                        user_id: userId,
                        meter_number: meterData.meter_number,
                        reading: meterData.reading,
                        month: currentMonth,
                        consumption: meterData.consumption,
                        amount: meterData.amount
                    }
                ]);
            
            return data;
            */
        }
        
        async function realGetUserPayments(userId) {
            /* –†–ï–ê–õ–¨–ù–ê–Ø –†–ï–ê–õ–ò–ó–ê–¶–ò–Ø:
            const { data, error } = await supabase
                .from('payments')
                .select('*')
                .eq('user_id', userId)
                .order('month', { ascending: false });
            
            return data;
            */
        }
        
        async function realGetCurrentTariffs() {
            /* –†–ï–ê–õ–¨–ù–ê–Ø –†–ï–ê–õ–ò–ó–ê–¶–ò–Ø:
            const { data, error } = await supabase
                .from('tariffs')
                .select('*')
                .order('effective_date', { ascending: false })
                .limit(1)
                .single();
            
            return data;
            */
        }
    </script>
</body>
</html>
