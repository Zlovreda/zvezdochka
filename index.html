<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–°–ù–¢ "–ó–≤–µ–∑–¥–æ—á–∫–∞" - –£—á–µ—Ç —ç–ª–µ–∫—Ç—Ä–æ—ç–Ω–µ—Ä–≥–∏–∏ –∏ –≤–∑–Ω–æ—Å–æ–≤</title>
    <style>
        /* –ë–∞–∑–æ–≤—ã–µ —Å—Ç–∏–ª–∏ */
        :root {
            --primary: #4a6fa5;
            --primary-dark: #385d8a;
            --secondary: #6c757d;
            --success: #28a745;
            --danger: #dc3545;
            --warning: #ffc107;
            --info: #17a2b8;
            --light: #f8f9fa;
            --dark: #343a40;
            --border: #dee2e6;
            --shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }
        
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: var(--dark);
            background-color: #f5f7fa;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }
        
        /* –•–µ–¥–µ—Ä */
        header {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: white;
            padding: 1.5rem;
            border-radius: 10px;
            margin-bottom: 2rem;
            box-shadow: var(--shadow);
        }
        
        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
        }
        
        h1 {
            font-size: 1.8rem;
            margin-bottom: 0.5rem;
        }
        
        .subtitle {
            opacity: 0.9;
            font-size: 1rem;
        }
        
        /* –ù–∞–≤–∏–≥–∞—Ü–∏—è */
        .tabs {
            display: flex;
            background: white;
            border-radius: 10px;
            overflow: hidden;
            margin-bottom: 2rem;
            box-shadow: var(--shadow);
            flex-wrap: wrap;
        }
        
        .tab {
            padding: 1rem 1.5rem;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            transition: all 0.3s;
            font-weight: 600;
            color: var(--dark);
            flex-grow: 1;
            text-align: center;
        }
        
        .tab:hover {
            background-color: var(--light);
        }
        
        .tab.active {
            border-bottom-color: var(--primary);
            color: var(--primary);
            background-color: rgba(74, 111, 165, 0.05);
        }
        
        .tab-content {
            display: none;
            background: white;
            padding: 2rem;
            border-radius: 10px;
            box-shadow: var(--shadow);
            min-height: 500px;
        }
        
        .tab-content.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* –§–æ—Ä–º—ã */
        .form-group {
            margin-bottom: 1.5rem;
        }
        
        .form-label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            color: var(--dark);
        }
        
        .form-control {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid var(--border);
            border-radius: 6px;
            font-size: 1rem;
            transition: border-color 0.2s, box-shadow 0.2s;
        }
        
        .form-control:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(74, 111, 165, 0.2);
        }
        
        .form-row {
            display: flex;
            flex-wrap: wrap;
            margin: 0 -0.5rem;
        }
        
        .form-col {
            flex: 1;
            padding: 0 0.5rem;
            min-width: 250px;
        }
        
        /* –ö–Ω–æ–ø–∫–∏ */
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 6px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            text-decoration: none;
            gap: 0.5rem;
        }
        
        .btn-sm {
            padding: 0.5rem 1rem;
            font-size: 0.875rem;
        }
        
        .btn-primary {
            background-color: var(--primary);
            color: white;
        }
        
        .btn-primary:hover {
            background-color: var(--primary-dark);
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }
        
        .btn-success {
            background-color: var(--success);
            color: white;
        }
        
        .btn-success:hover {
            background-color: #218838;
        }
        
        .btn-danger {
            background-color: var(--danger);
            color: white;
        }
        
        .btn-danger:hover {
            background-color: #c82333;
        }
        
        .btn-warning {
            background-color: var(--warning);
            color: var(--dark);
        }
        
        .btn-warning:hover {
            background-color: #e0a800;
        }
        
        .btn-group {
            display: flex;
            gap: 0.5rem;
            margin-top: 1rem;
            flex-wrap: wrap;
        }
        
        /* –¢–∞–±–ª–∏—Ü—ã */
        .table-responsive {
            overflow-x: auto;
            margin: 1rem 0;
        }
        
        .data-table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }
        
        .data-table th {
            background-color: #f1f5f9;
            padding: 1rem;
            text-align: left;
            font-weight: 600;
            color: var(--dark);
            border-bottom: 2px solid var(--border);
        }
        
        .data-table td {
            padding: 1rem;
            border-bottom: 1px solid var(--border);
        }
        
        .data-table tr:hover {
            background-color: #f8fafc;
        }
        
        .data-table .actions {
            white-space: nowrap;
        }
        
        /* –ö–∞—Ä—Ç–æ—á–∫–∏ */
        .card {
            background: white;
            border-radius: 10px;
            padding: 1.5rem;
            box-shadow: var(--shadow);
            margin-bottom: 1.5rem;
        }
        
        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 2px solid var(--light);
        }
        
        .card-title {
            font-size: 1.4rem;
            color: var(--primary);
            margin: 0;
        }
        
        /* –°—Ç–∞—Ç—É—Å—ã */
        .status-badge {
            display: inline-block;
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.875rem;
            font-weight: 600;
        }
        
        .status-success {
            background-color: #d1fae5;
            color: #065f46;
        }
        
        .status-warning {
            background-color: #fef3c7;
            color: #92400e;
        }
        
        .status-danger {
            background-color: #fee2e2;
            color: #991b1b;
        }
        
        /* –ê–ª–µ—Ä—Ç—ã */
        .alert {
            padding: 1rem;
            border-radius: 8px;
            margin-bottom: 1.5rem;
            border-left: 4px solid;
        }
        
        .alert-success {
            background-color: #d1fae5;
            color: #065f46;
            border-left-color: var(--success);
        }
        
        .alert-danger {
            background-color: #fee2e2;
            color: #991b1b;
            border-left-color: var(--danger);
        }
        
        .alert-info {
            background-color: #e0f2fe;
            color: #0369a1;
            border-left-color: var(--info);
        }
        
        /* –ó–∞–≥—Ä—É–∑–∫–∞ */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(74, 111, 165, 0.3);
            border-radius: 50%;
            border-top-color: var(--primary);
            animation: spin 1s ease-in-out infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        /* –ò–Ω—Ñ–æ –±–ª–æ–∫–∏ */
        .info-box {
            background-color: #f0f9ff;
            border-left: 4px solid var(--primary);
            padding: 1rem;
            border-radius: 6px;
            margin-bottom: 1rem;
        }
        
        /* –ú–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞ */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        
        .modal.active {
            display: flex;
        }
        
        .modal-content {
            background-color: white;
            padding: 2rem;
            border-radius: 10px;
            max-width: 800px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid var(--border);
        }
        
        .modal-title {
            font-size: 1.5rem;
            color: var(--primary);
            margin: 0;
        }
        
        .close-modal {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--secondary);
        }
        
        /* –£—Ç–∏–ª–∏—Ç—ã */
        .text-center { text-align: center; }
        .text-right { text-align: right; }
        .mb-1 { margin-bottom: 0.5rem; }
        .mb-2 { margin-bottom: 1rem; }
        .mb-3 { margin-bottom: 1.5rem; }
        .mt-1 { margin-top: 0.5rem; }
        .mt-2 { margin-top: 1rem; }
        .mt-3 { margin-top: 1.5rem; }
        .d-none { display: none; }
        .d-flex { display: flex; }
        .align-center { align-items: center; }
        .justify-between { justify-content: space-between; }
        .w-100 { width: 100%; }
        
        /* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å */
        @media (max-width: 768px) {
            .tabs {
                flex-direction: column;
            }
            
            .tab {
                text-align: left;
                border-bottom: none;
                border-left: 3px solid transparent;
            }
            
            .tab.active {
                border-left-color: var(--primary);
                border-bottom: none;
            }
            
            .form-col {
                min-width: 100%;
            }
            
            .header-content {
                flex-direction: column;
                align-items: flex-start;
                gap: 1rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="header-content">
                <div>
                    <h1>–°–ù–¢ "–ó–≤–µ–∑–¥–æ—á–∫–∞"</h1>
                    <p class="subtitle">–°–∏—Å—Ç–µ–º–∞ —É—á–µ—Ç–∞ —ç–ª–µ–∫—Ç—Ä–æ—ç–Ω–µ—Ä–≥–∏–∏ –∏ —á–ª–µ–Ω—Å–∫–∏—Ö –≤–∑–Ω–æ—Å–æ–≤</p>
                </div>
                <div id="userInfo" class="d-none">
                    <div class="d-flex align-center" style="gap: 1rem;">
                        <span id="userName"></span>
                        <button id="logoutBtn" class="btn btn-sm btn-danger">–í—ã–π—Ç–∏</button>
                    </div>
                </div>
            </div>
        </header>
        
        <!-- –≠–∫—Ä–∞–Ω –∑–∞–≥—Ä—É–∑–∫–∏ –∏ –ø—Ä–æ–≤–µ—Ä–∫–∏ Supabase -->
        <div id="loadingScreen" class="tab-content active">
            <div class="card">
                <div class="text-center">
                    <h2 class="mb-2">–ó–∞–≥—Ä—É–∑–∫–∞ —Å–∏—Å—Ç–µ–º—ã...</h2>
                    <div class="loading" style="width: 40px; height: 40px; margin: 2rem auto;"></div>
                    <p id="loadingStatus" class="mb-3">–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö</p>
                    <div id="connectionStatus"></div>
                </div>
            </div>
        </div>
        
        <!-- –≠–∫—Ä–∞–Ω –≤—Ö–æ–¥–∞ -->
        <div id="loginScreen" class="tab-content d-none">
            <div class="card" style="max-width: 500px; margin: 0 auto;">
                <h2 class="text-center mb-3">–í—Ö–æ–¥ –≤ —Å–∏—Å—Ç–µ–º—É</h2>
                
                <div class="form-group">
                    <label class="form-label">–õ–æ–≥–∏–Ω</label>
                    <input type="text" id="loginUsername" class="form-control" placeholder="–í–≤–µ–¥–∏—Ç–µ –ª–æ–≥–∏–Ω">
                </div>
                
                <div class="form-group">
                    <label class="form-label">–ü–∞—Ä–æ–ª—å</label>
                    <input type="password" id="loginPassword" class="form-control" placeholder="–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å">
                </div>
                
                <div id="loginError" class="alert alert-danger d-none"></div>
                
                <button id="loginBtn" class="btn btn-primary w-100">
                    <span class="loading d-none" id="loginLoading"></span>
                    –í–æ–π—Ç–∏
                </button>
                
                <div class="text-center mt-3">
                    <p>–î–µ–º–æ –¥–æ—Å—Ç—É–ø—ã:</p>
                    <p><strong>–ê–¥–º–∏–Ω:</strong> admin / admin123</p>
                    <p><strong>–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å:</strong> user1 / user123</p>
                </div>
            </div>
        </div>
        
        <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å -->
        <div id="mainInterface" class="d-none">
            <div class="tabs">
                <div class="tab active" data-tab="dashboard">üìä –î–∞—à–±–æ—Ä–¥</div>
                <div class="tab" data-tab="electricity">‚ö° –≠–ª–µ–∫—Ç—Ä–æ—ç–Ω–µ—Ä–≥–∏—è</div>
                <div class="tab" data-tab="fees">üí∞ –ß–ª–µ–Ω—Å–∫–∏–µ –≤–∑–Ω–æ—Å—ã</div>
                <div class="tab" data-tab="profile">üë§ –ü—Ä–æ—Ñ–∏–ª—å</div>
                <div class="tab admin-only" data-tab="admin">üîß –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å</div>
            </div>
            
            <!-- –î–∞—à–±–æ—Ä–¥ -->
            <div id="dashboard" class="tab-content active">
                <div class="card">
                    <h2 class="card-title">–û–±—â–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h2>
                    
                    <div id="userDashboard" class="d-none">
                        <div class="info-box">
                            <h3>–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, <span id="dashboardUserName"></span>!</h3>
                            <p>–ó–¥–µ—Å—å –≤—ã –º–æ–∂–µ—Ç–µ –ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å –ø–æ–∫–∞–∑–∞–Ω–∏—è —Å—á–µ—Ç—á–∏–∫–æ–≤ –∏ –æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å —Å–≤–æ–∏ –ø–ª–∞—Ç–µ–∂–∏.</p>
                        </div>
                        
                        <div class="form-row mt-3">
                            <div class="form-col">
                                <div class="card">
                                    <h4>–≠–ª–µ–∫—Ç—Ä–æ—ç–Ω–µ—Ä–≥–∏—è</h4>
                                    <p id="electricityStatus">–ó–∞–≥—Ä—É–∑–∫–∞...</p>
                                    <button class="btn btn-primary btn-sm" onclick="showTab('electricity')">–ü–µ—Ä–µ–¥–∞—Ç—å –ø–æ–∫–∞–∑–∞–Ω–∏—è</button>
                                </div>
                            </div>
                            <div class="form-col">
                                <div class="card">
                                    <h4>–ß–ª–µ–Ω—Å–∫–∏–µ –≤–∑–Ω–æ—Å—ã</h4>
                                    <p id="feesStatus">–ó–∞–≥—Ä—É–∑–∫–∞...</p>
                                    <button class="btn btn-primary btn-sm" onclick="showTab('fees')">–ü–æ–¥—Ä–æ–±–Ω–µ–µ</button>
                                </div>
                            </div>
                            <div class="form-col">
                                <div class="card">
                                    <h4>–û–±—â–∞—è —Å—É–º–º–∞ –∫ –æ–ø–ª–∞—Ç–µ</h4>
                                    <h3 id="totalAmount">0 ‚ÇΩ</h3>
                                    <p id="lastUpdate">–ó–∞–≥—Ä—É–∑–∫–∞...</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div id="adminDashboard" class="d-none">
                        <div class="info-box">
                            <h3>–ü–∞–Ω–µ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞</h3>
                            <p>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏, —Ç–∞—Ä–∏—Ñ–∞–º–∏ –∏ –¥–∞–Ω–Ω—ã–º–∏ —Å–∏—Å—Ç–µ–º—ã.</p>
                        </div>
                        
                        <div class="form-row mt-3">
                            <div class="form-col">
                                <div class="card">
                                    <h4>–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h4>
                                    <p>–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π: <span id="userCount">0</span></p>
                                    <p>–ê–∫—Ç–∏–≤–Ω—ã—Ö —Å—á–µ—Ç—á–∏–∫–æ–≤: <span id="meterCount">0</span></p>
                                    <p>–ü–æ—Å–ª–µ–¥–Ω–∏–µ –ø–æ–∫–∞–∑–∞–Ω–∏—è: <span id="lastReadingDate">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö</span></p>
                                </div>
                            </div>
                            <div class="form-col">
                                <div class="card">
                                    <h4>–ë—ã—Å—Ç—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—è</h4>
                                    <div class="btn-group" style="flex-direction: column;">
                                        <button class="btn btn-primary" onclick="showAdminTab('users')">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏</button>
                                        <button class="btn btn-primary" onclick="showAdminTab('tariffs')">–ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ç–∞—Ä–∏—Ñ–æ–≤</button>
                                        <button class="btn btn-primary" onclick="showAdminTab('import')">–ò–º–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- –≠–ª–µ–∫—Ç—Ä–æ—ç–Ω–µ—Ä–≥–∏—è -->
            <div id="electricity" class="tab-content">
                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">–£—á–µ—Ç —ç–ª–µ–∫—Ç—Ä–æ—ç–Ω–µ—Ä–≥–∏–∏</h2>
                        <button id="addMeterBtn" class="btn btn-primary">‚ûï –î–æ–±–∞–≤–∏—Ç—å —Å—á–µ—Ç—á–∏–∫</button>
                    </div>
                    
                    <div id="electricityInfo" class="info-box">
                        <p><strong>–¢–∞—Ä–∏—Ñ–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞:</strong> –°–ª–æ–∂–Ω—ã–π —Ç–∞—Ä–∏—Ñ –∏–∑ —Ç—Ä–µ—Ö –∑–Ω–∞—á–µ–Ω–∏–π:</p>
                        <ol>
                            <li>–ü–æ—Ç–µ—Ä–∏: <span id="lossTariff">0</span> ‚ÇΩ –∑–∞ –∫–í—Ç¬∑—á</li>
                            <li>–î–æ 100 –∫–í—Ç¬∑—á: <span id="under100Tariff">0</span> ‚ÇΩ –∑–∞ –∫–í—Ç¬∑—á</li>
                            <li>–û—Ç 100 –∫–í—Ç¬∑—á: <span id="over100Tariff">0</span> ‚ÇΩ –∑–∞ –∫–í—Ç¬∑—á</li>
                        </ol>
                        <p class="mt-1"><em>–ü—Ä–∏–º–µ—Ä —Ä–∞—Å—á–µ—Ç–∞ –¥–ª—è 763 –∫–í—Ç¬∑—á: (763 √ó —Ç–∞—Ä–∏—Ñ –ø–æ—Ç–µ—Ä—å) + (100 √ó —Ç–∞—Ä–∏—Ñ –¥–æ 100) + (663 √ó —Ç–∞—Ä–∏—Ñ –æ—Ç 100)</em></p>
                    </div>
                    
                    <div id="metersList"></div>
                    
                    <div id="readingsHistory" class="mt-3">
                        <h3>–ò—Å—Ç–æ—Ä–∏—è –ø–æ–∫–∞–∑–∞–Ω–∏–π</h3>
                        <div class="table-responsive">
                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th>–ú–µ—Å—è—Ü</th>
                                        <th>–°—á–µ—Ç—á–∏–∫</th>
                                        <th>–ü–æ–∫–∞–∑–∞–Ω–∏—è</th>
                                        <th>–†–∞—Å—Ö–æ–¥</th>
                                        <th>–°—É–º–º–∞</th>
                                        <th>–°—Ç–∞—Ç—É—Å</th>
                                    </tr>
                                </thead>
                                <tbody id="readingsTableBody">
                                    <!-- –î–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∑—è—Ç—Å—è —á–µ—Ä–µ–∑ JS -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- –ß–ª–µ–Ω—Å–∫–∏–µ –≤–∑–Ω–æ—Å—ã -->
            <div id="fees" class="tab-content">
                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">–ß–ª–µ–Ω—Å–∫–∏–µ –≤–∑–Ω–æ—Å—ã</h2>
                    </div>
                    
                    <div id="feesInfo" class="info-box">
                        <p><strong>–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –≤–∑–Ω–æ—Å–æ–≤:</strong></p>
                        <ol>
                            <li>–ó–∞—Ä–ø–ª–∞—Ç–∞: <span id="salaryFee">0</span> ‚ÇΩ —Å —É—á–∞—Å—Ç–∫–∞</li>
                            <li>–°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ: <span id="maintenanceFee">0</span> ‚ÇΩ –∑–∞ —Å–æ—Ç–∫—É</li>
                            <li id="additionalField1">–î–æ–ø. –ø–æ–ª–µ 1: <span id="additionalFee1">0</span> ‚ÇΩ</li>
                            <li id="additionalField2">–î–æ–ø. –ø–æ–ª–µ 2: <span id="additionalFee2">0</span> ‚ÇΩ</li>
                            <li id="additionalField3">–î–æ–ø. –ø–æ–ª–µ 3: <span id="additionalFee3">0</span> ‚ÇΩ</li>
                        </ol>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-col">
                            <div class="card">
                                <h4>–í–∞—à–∏ —É—á–∞—Å—Ç–∫–∏</h4>
                                <div id="userPlots"></div>
                            </div>
                        </div>
                        <div class="form-col">
                            <div class="card">
                                <h4>–†–∞—Å—á–µ—Ç –≤–∑–Ω–æ—Å–æ–≤</h4>
                                <p>–£—á–∞—Å—Ç–∫–æ–≤: <span id="plotCount">0</span></p>
                                <p>–°–æ—Ç–æ–∫: <span id="sotkiCount">0</span></p>
                                <p>–ó–∞—Ä–ø–ª–∞—Ç–∞: <span id="calculatedSalary">0</span> ‚ÇΩ</p>
                                <p>–°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ: <span id="calculatedMaintenance">0</span> ‚ÇΩ</p>
                                <p>–î–æ–ø. –≤–∑–Ω–æ—Å—ã: <span id="calculatedAdditional">0</span> ‚ÇΩ</p>
                                <h4 class="mt-2">–ò—Ç–æ–≥–æ: <span id="totalFees">0</span> ‚ÇΩ</h4>
                            </div>
                        </div>
                    </div>
                    
                    <div id="feesHistory" class="mt-3">
                        <h3>–ò—Å—Ç–æ—Ä–∏—è –≤–∑–Ω–æ—Å–æ–≤</h3>
                        <div class="table-responsive">
                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th>–ú–µ—Å—è—Ü</th>
                                        <th>–ó–∞—Ä–ø–ª–∞—Ç–∞</th>
                                        <th>–°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ</th>
                                        <th>–î–æ–ø. –≤–∑–Ω–æ—Å—ã</th>
                                        <th>–ò—Ç–æ–≥–æ</th>
                                        <th>–°—Ç–∞—Ç—É—Å</th>
                                    </tr>
                                </thead>
                                <tbody id="feesTableBody">
                                    <!-- –î–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∑—è—Ç—Å—è —á–µ—Ä–µ–∑ JS -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- –ü—Ä–æ—Ñ–∏–ª—å -->
            <div id="profile" class="tab-content">
                <div class="card">
                    <h2 class="card-title">–ü—Ä–æ—Ñ–∏–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</h2>
                    
                    <div class="form-row">
                        <div class="form-col">
                            <div class="form-group">
                                <label class="form-label">–§–ò–û</label>
                                <input type="text" id="profileName" class="form-control" disabled>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">–õ–æ–≥–∏–Ω</label>
                                <input type="text" id="profileLogin" class="form-control" disabled>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">–†–æ–ª—å</label>
                                <input type="text" id="profileRole" class="form-control" disabled>
                            </div>
                        </div>
                        
                        <div class="form-col">
                            <div class="form-group">
                                <label class="form-label">–ö–æ–Ω—Ç–∞–∫—Ç–Ω—ã–π —Ç–µ–ª–µ—Ñ–æ–Ω</label>
                                <input type="text" id="profilePhone" class="form-control">
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Email</label>
                                <input type="email" id="profileEmail" class="form-control">
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">–ù–æ–≤—ã–π –ø–∞—Ä–æ–ª—å (–æ—Å—Ç–∞–≤—å—Ç–µ –ø—É—Å—Ç—ã–º, –µ—Å–ª–∏ –Ω–µ –º–µ–Ω—è–µ—Ç–µ)</label>
                                <input type="password" id="profilePassword" class="form-control">
                            </div>
                        </div>
                    </div>
                    
                    <button id="saveProfileBtn" class="btn btn-primary">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è</button>
                </div>
            </div>
            
            <!-- –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å -->
            <div id="admin" class="tab-content">
                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω–∞—è –ø–∞–Ω–µ–ª—å</h2>
                        <div class="btn-group">
                            <button class="btn btn-primary" onclick="showAdminTab('users')">üë• –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏</button>
                            <button class="btn btn-primary" onclick="showAdminTab('tariffs')">üí∞ –¢–∞—Ä–∏—Ñ—ã</button>
                            <button class="btn btn-primary" onclick="showAdminTab('import')">üìä –ò–º–ø–æ—Ä—Ç/–≠–∫—Å–ø–æ—Ä—Ç</button>
                        </div>
                    </div>
                    
                    <!-- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏ -->
                    <div id="adminUsers" class="admin-section">
                        <h3>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏</h3>
                        
                        <div class="btn-group mb-3">
                            <button class="btn btn-success" onclick="showAddUserModal()">‚ûï –î–æ–±–∞–≤–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</button>
                            <button class="btn btn-warning" onclick="loadAllUsers()">üîÑ –û–±–Ω–æ–≤–∏—Ç—å —Å–ø–∏—Å–æ–∫</button>
                        </div>
                        
                        <div class="table-responsive">
                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th>ID</th>
                                        <th>–§–ò–û</th>
                                        <th>–õ–æ–≥–∏–Ω</th>
                                        <th>–†–æ–ª—å</th>
                                        <th>–£—á–∞—Å—Ç–∫–æ–≤</th>
                                        <th>–°—á–µ—Ç—á–∏–∫–æ–≤</th>
                                        <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                                    </tr>
                                </thead>
                                <tbody id="adminUsersTable">
                                    <!-- –î–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∑—è—Ç—Å—è —á–µ—Ä–µ–∑ JS -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                    
                    <!-- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–∞—Ä–∏—Ñ–∞–º–∏ -->
                    <div id="adminTariffs" class="admin-section d-none">
                        <h3>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–∞—Ä–∏—Ñ–∞–º–∏</h3>
                        
                        <div class="info-box mb-3">
                            <p>–¢–∞—Ä–∏—Ñ—ã —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é—Ç—Å—è –Ω–∞ –∫–∞–∂–¥—ã–π –º–µ—Å—è—Ü –æ—Ç–¥–µ–ª—å–Ω–æ. –ü—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ —Ç–∞—Ä–∏—Ñ–∞ –Ω–∞ —Ç–µ–∫—É—â–∏–π –º–µ—Å—è—Ü –±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω –ø–æ—Å–ª–µ–¥–Ω–∏–π —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–π —Ç–∞—Ä–∏—Ñ.</p>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-col">
                                <div class="form-group">
                                    <label class="form-label">–ú–µ—Å—è—Ü</label>
                                    <input type="month" id="tariffMonth" class="form-control">
                                </div>
                            </div>
                            <div class="form-col">
                                <div class="form-group">
                                    <label class="form-label">–¢–∞—Ä–∏—Ñ –Ω–∞ –ø–æ—Ç–µ—Ä–∏ (‚ÇΩ/–∫–í—Ç¬∑—á)</label>
                                    <input type="number" step="0.01" id="tariffLoss" class="form-control">
                                </div>
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-col">
                                <div class="form-group">
                                    <label class="form-label">–¢–∞—Ä–∏—Ñ –¥–æ 100 –∫–í—Ç¬∑—á (‚ÇΩ/–∫–í—Ç¬∑—á)</label>
                                    <input type="number" step="0.01" id="tariffUnder100" class="form-control">
                                </div>
                            </div>
                            <div class="form-col">
                                <div class="form-group">
                                    <label class="form-label">–¢–∞—Ä–∏—Ñ –æ—Ç 100 –∫–í—Ç¬∑—á (‚ÇΩ/–∫–í—Ç¬∑—á)</label>
                                    <input type="number" step="0.01" id="tariffOver100" class="form-control">
                                </div>
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-col">
                                <div class="form-group">
                                    <label class="form-label">–ó–∞—Ä–ø–ª–∞—Ç–∞ —Å —É—á–∞—Å—Ç–∫–∞ (‚ÇΩ)</label>
                                    <input type="number" step="0.01" id="tariffSalary" class="form-control">
                                </div>
                            </div>
                            <div class="form-col">
                                <div class="form-group">
                                    <label class="form-label">–°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ –∑–∞ —Å–æ—Ç–∫—É (‚ÇΩ)</label>
                                    <input type="number" step="0.01" id="tariffMaintenance" class="form-control">
                                </div>
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-col">
                                <div class="form-group">
                                    <label class="form-label">–ù–∞–∑–≤–∞–Ω–∏–µ –¥–æ–ø. –ø–æ–ª—è 1</label>
                                    <input type="text" id="tariffAdditional1Name" class="form-control">
                                </div>
                            </div>
                            <div class="form-col">
                                <div class="form-group">
                                    <label class="form-label">–°—É–º–º–∞ –¥–æ–ø. –ø–æ–ª—è 1 (‚ÇΩ)</label>
                                    <input type="number" step="0.01" id="tariffAdditional1Value" class="form-control">
                                </div>
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-col">
                                <div class="form-group">
                                    <label class="form-label">–ù–∞–∑–≤–∞–Ω–∏–µ –¥–æ–ø. –ø–æ–ª—è 2</label>
                                    <input type="text" id="tariffAdditional2Name" class="form-control">
                                </div>
                            </div>
                            <div class="form-col">
                                <div class="form-group">
                                    <label class="form-label">–°—É–º–º–∞ –¥–æ–ø. –ø–æ–ª—è 2 (‚ÇΩ)</label>
                                    <input type="number" step="0.01" id="tariffAdditional2Value" class="form-control">
                                </div>
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-col">
                                <div class="form-group">
                                    <label class="form-label">–ù–∞–∑–≤–∞–Ω–∏–µ –¥–æ–ø. –ø–æ–ª—è 3</label>
                                    <input type="text" id="tariffAdditional3Name" class="form-control">
                                </div>
                            </div>
                            <div class="form-col">
                                <div class="form-group">
                                    <label class="form-label">–°—É–º–º–∞ –¥–æ–ø. –ø–æ–ª—è 3 (‚ÇΩ)</label>
                                    <input type="number" step="0.01" id="tariffAdditional3Value" class="form-control">
                                </div>
                            </div>
                        </div>
                        
                        <button class="btn btn-primary" onclick="saveTariff()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ç–∞—Ä–∏—Ñ</button>
                        
                        <div id="tariffsHistory" class="mt-3">
                            <h4>–ò—Å—Ç–æ—Ä–∏—è —Ç–∞—Ä–∏—Ñ–æ–≤</h4>
                            <div class="table-responsive">
                                <table class="data-table">
                                    <thead>
                                        <tr>
                                            <th>–ú–µ—Å—è—Ü</th>
                                            <th>–ü–æ—Ç–µ—Ä–∏</th>
                                            <th>–î–æ 100</th>
                                            <th>–û—Ç 100</th>
                                            <th>–ó–∞—Ä–ø–ª–∞—Ç–∞</th>
                                            <th>–°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ</th>
                                            <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                                        </tr>
                                    </thead>
                                    <tbody id="tariffsTableBody">
                                        <!-- –î–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∑—è—Ç—Å—è —á–µ—Ä–µ–∑ JS -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                    
                    <!-- –ò–º–ø–æ—Ä—Ç/–≠–∫—Å–ø–æ—Ä—Ç -->
                    <div id="adminImport" class="admin-section d-none">
                        <h3>–ò–º–ø–æ—Ä—Ç –∏ —ç–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö</h3>
                        
                        <div class="form-row">
                            <div class="form-col">
                                <div class="card">
                                    <h4>–≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö</h4>
                                    <p>–í—ã–≥—Ä—É–∑–∏—Ç–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è —Ä–µ–∑–µ—Ä–≤–Ω–æ–≥–æ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è –∏–ª–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –≤ Excel.</p>
                                    <div class="btn-group" style="flex-direction: column;">
                                        <button class="btn btn-primary" onclick="exportData('users')">üì• –≠–∫—Å–ø–æ—Ä—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</button>
                                        <button class="btn btn-primary" onclick="exportData('readings')">üì• –≠–∫—Å–ø–æ—Ä—Ç –ø–æ–∫–∞–∑–∞–Ω–∏–π</button>
                                        <button class="btn btn-primary" onclick="exportData('fees')">üì• –≠–∫—Å–ø–æ—Ä—Ç –≤–∑–Ω–æ—Å–æ–≤</button>
                                        <button class="btn btn-primary" onclick="exportData('tariffs')">üì• –≠–∫—Å–ø–æ—Ä—Ç —Ç–∞—Ä–∏—Ñ–æ–≤</button>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="form-col">
                                <div class="card">
                                    <h4>–ò–º–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö</h4>
                                    <p>–ó–∞–≥—Ä—É–∑–∏—Ç–µ –¥–∞–Ω–Ω—ã–µ –∏–∑ CSV –∏–ª–∏ Excel —Ñ–∞–π–ª–æ–≤.</p>
                                    
                                    <div class="form-group">
                                        <label class="form-label">–¢–∏–ø –¥–∞–Ω–Ω—ã—Ö</label>
                                        <select id="importType" class="form-control">
                                            <option value="readings">–ü–æ–∫–∞–∑–∞–Ω–∏—è —Å—á–µ—Ç—á–∏–∫–æ–≤</option>
                                            <option value="fees">–ß–ª–µ–Ω—Å–∫–∏–µ –≤–∑–Ω–æ—Å—ã</option>
                                            <option value="users">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏</option>
                                        </select>
                                    </div>
                                    
                                    <div class="form-group">
                                        <label class="form-label">–§–∞–π–ª (CSV)</label>
                                        <input type="file" id="importFile" class="form-control" accept=".csv,.xlsx,.xls">
                                    </div>
                                    
                                    <button class="btn btn-primary" onclick="importData()">üì§ –ò–º–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö</button>
                                    
                                    <div class="info-box mt-2">
                                        <p><strong>–§–æ—Ä–º–∞—Ç CSV –¥–ª—è –ø–æ–∫–∞–∑–∞–Ω–∏–π:</strong><br>
                                        user_id,month,meter_number,reading</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Å—á–µ—Ç—á–∏–∫–∞ -->
    <div id="addMeterModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">–î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Å—á–µ—Ç—á–∏–∫–∞</h3>
                <button class="close-modal" onclick="closeModal('addMeterModal')">√ó</button>
            </div>
            
            <div class="form-group">
                <label class="form-label">–ù–æ–º–µ—Ä —Å—á–µ—Ç—á–∏–∫–∞</label>
                <input type="text" id="meterNumber" class="form-control" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –°–ß-12345">
            </div>
            
            <div class="form-group">
                <label class="form-label">–¢–∏–ø —Å—á–µ—Ç—á–∏–∫–∞</label>
                <select id="meterType" class="form-control">
                    <option value="electricity">–≠–ª–µ–∫—Ç—Ä–æ—ç–Ω–µ—Ä–≥–∏—è</option>
                </select>
            </div>
            
            <div class="form-group">
                <label class="form-label">–ù–∞—á–∞–ª—å–Ω—ã–µ –ø–æ–∫–∞–∑–∞–Ω–∏—è (–µ—Å–ª–∏ –∏–∑–≤–µ—Å—Ç–Ω—ã)</label>
                <input type="number" step="0.001" id="initialReading" class="form-control" placeholder="0">
            </div>
            
            <button class="btn btn-primary" onclick="saveMeter()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
        </div>
    </div>
    
    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ø–µ—Ä–µ–¥–∞—á–∏ –ø–æ–∫–∞–∑–∞–Ω–∏–π -->
    <div id="addReadingModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">–ü–µ—Ä–µ–¥–∞—á–∞ –ø–æ–∫–∞–∑–∞–Ω–∏–π</h3>
                <button class="close-modal" onclick="closeModal('addReadingModal')">√ó</button>
            </div>
            
            <div class="form-group">
                <label class="form-label">–°—á–µ—Ç—á–∏–∫</label>
                <select id="readingMeterId" class="form-control"></select>
            </div>
            
            <div class="form-group">
                <label class="form-label">–ú–µ—Å—è—Ü</label>
                <input type="month" id="readingMonth" class="form-control" value="">
            </div>
            
            <div class="form-group">
                <label class="form-label">–ü–æ–∫–∞–∑–∞–Ω–∏—è (–∫–í—Ç¬∑—á)</label>
                <input type="number" step="0.001" id="readingValue" class="form-control" placeholder="0">
            </div>
            
            <button class="btn btn-primary" onclick="saveReading()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
        </div>
    </div>
    
    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è -->
    <div id="addUserModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">–î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</h3>
                <button class="close-modal" onclick="closeModal('addUserModal')">√ó</button>
            </div>
            
            <div class="form-row">
                <div class="form-col">
                    <div class="form-group">
                        <label class="form-label">–§–ò–û</label>
                        <input type="text" id="newUserName" class="form-control">
                    </div>
                </div>
                <div class="form-col">
                    <div class="form-group">
                        <label class="form-label">–õ–æ–≥–∏–Ω</label>
                        <input type="text" id="newUserLogin" class="form-control">
                    </div>
                </div>
            </div>
            
            <div class="form-row">
                <div class="form-col">
                    <div class="form-group">
                        <label class="form-label">–ü–∞—Ä–æ–ª—å</label>
                        <input type="password" id="newUserPassword" class="form-control">
                    </div>
                </div>
                <div class="form-col">
                    <div class="form-group">
                        <label class="form-label">–†–æ–ª—å</label>
                        <select id="newUserRole" class="form-control">
                            <option value="user">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å</option>
                            <option value="admin">–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä</option>
                        </select>
                    </div>
                </div>
            </div>
            
            <div class="form-group">
                <label class="form-label">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —É—á–∞—Å—Ç–∫–æ–≤</label>
                <input type="number" id="newUserPlots" class="form-control" value="1" min="1">
            </div>
            
            <div class="form-group">
                <label class="form-label">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–æ—Ç–æ–∫ –Ω–∞ —É—á–∞—Å—Ç–∫–µ</label>
                <input type="number" id="newUserSotki" class="form-control" value="6" step="0.01">
            </div>
            
            <button class="btn btn-primary" onclick="saveNewUser()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
        </div>
    </div>

    <script>
        // –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Supabase
        const SUPABASE_URL = 'https://chgbdbuiqzdmwiniyxrk.supabase.co';
        const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImNoZ2JkYnVpcXpkbXdpbml5eHJrIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njg5NzY5MzUsImV4cCI6MjA4NDU1MjkzNX0.KvpKM7FggBOWNuFR8gmL7cjk64tt6CCgAI-UlkP7ZXU';
        
        // –¢–µ–∫—É—â–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
        let currentUser = null;
        let currentMonth = new Date().toISOString().slice(0, 7); // YYYY-MM
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        document.addEventListener('DOMContentLoaded', async function() {
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ Supabase
            await checkSupabaseConnection();
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
            checkAuth();
            
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –≤–∫–ª–∞–¥–æ–∫
            initTabs();
            
            // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ç–µ–∫—É—â–µ–≥–æ –º–µ—Å—è—Ü–∞ –≤ —Ñ–æ—Ä–º–µ
            document.getElementById('readingMonth').value = currentMonth;
            document.getElementById('tariffMonth').value = currentMonth;
        });
        
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ Supabase
        async function checkSupabaseConnection() {
            const statusEl = document.getElementById('connectionStatus');
            const loadingStatus = document.getElementById('loadingStatus');
            
            try {
                loadingStatus.textContent = '–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ Supabase...';
                
                // –¢–µ—Å—Ç–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å –∫ REST API
                const response = await fetch(`${SUPABASE_URL}/rest/v1/`, {
                    headers: {
                        'apikey': SUPABASE_KEY,
                        'Authorization': `Bearer ${SUPABASE_KEY}`
                    }
                });
                
                if (response.ok) {
                    statusEl.innerHTML = '<div class="alert alert-success">‚úÖ –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Supabase —É—Å–ø–µ—à–Ω–æ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ</div>';
                    
                    // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è —Ç–∞–±–ª–∏—Ü
                    loadingStatus.textContent = '–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö...';
                    await checkDatabaseStructure();
                    
                } else {
                    statusEl.innerHTML = `<div class="alert alert-danger">‚ùå –û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è: ${response.status} ${response.statusText}</div>`;
                }
            } catch (error) {
                statusEl.innerHTML = `<div class="alert alert-danger">‚ùå –û—à–∏–±–∫–∞ —Å–µ—Ç–∏: ${error.message}</div>`;
            }
        }
        
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
        async function checkDatabaseStructure() {
            try {
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ –æ—Å–Ω–æ–≤–Ω—ã—Ö —Ç–∞–±–ª–∏—Ü
                const tables = ['profiles', 'electricity_meters', 'electricity_readings', 'tariffs', 'membership_fees'];
                
                for (const table of tables) {
                    const response = await fetch(`${SUPABASE_URL}/rest/v1/${table}?limit=1`, {
                        headers: {
                            'apikey': SUPABASE_KEY,
                            'Authorization': `Bearer ${SUPABASE_KEY}`
                        }
                    });
                    
                    if (response.status === 404) {
                        console.log(`–¢–∞–±–ª–∏—Ü–∞ ${table} –Ω–µ –Ω–∞–π–¥–µ–Ω–∞. –°–æ–∑–¥–∞–µ–º...`);
                        await createTable(table);
                    }
                }
                
                // –°–æ–∑–¥–∞–µ–º —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –∞–¥–º–∏–Ω–∞, –µ—Å–ª–∏ –µ–≥–æ –Ω–µ—Ç
                await createDefaultAdmin();
                
                // –°–∫—Ä—ã–≤–∞–µ–º —ç–∫—Ä–∞–Ω –∑–∞–≥—Ä—É–∑–∫–∏
                setTimeout(() => {
                    document.getElementById('loadingScreen').classList.remove('active');
                    document.getElementById('loginScreen').classList.remove('d-none');
                }, 1000);
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –ë–î:', error);
            }
        }
        
        // –°–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã
        async function createTable(tableName) {
            // –í —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –∑–¥–µ—Å—å –±—ã–ª –±—ã SQL –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Ç–∞–±–ª–∏—Ü
            // –î–ª—è –¥–µ–º–æ –ø—Ä–æ—Å—Ç–æ –≤—ã–≤–æ–¥–∏–º —Å–æ–æ–±—â–µ–Ω–∏–µ
            console.log(`–¢–∞–±–ª–∏—Ü–∞ ${tableName} –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å —Å–æ–∑–¥–∞–Ω–∞ –≤—Ä—É—á–Ω—É—é –≤ Supabase`);
        }
        
        // –°–æ–∑–¥–∞–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –∞–¥–º–∏–Ω–∞
        async function createDefaultAdmin() {
            try {
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ —É–∂–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏
                const response = await fetch(`${SUPABASE_URL}/rest/v1/profiles?limit=1`, {
                    headers: {
                        'apikey': SUPABASE_KEY,
                        'Authorization': `Bearer ${SUPABASE_KEY}`
                    }
                });
                
                const users = await response.json();
                
                // –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –Ω–µ—Ç, —Å–æ–∑–¥–∞–µ–º –∞–¥–º–∏–Ω–∞
                if (users.length === 0) {
                    const adminData = {
                        login: 'admin',
                        password_hash: 'admin123', // –í —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –ø–∞—Ä–æ–ª—å –¥–æ–ª–∂–µ–Ω —Ö—ç—à–∏—Ä–æ–≤–∞—Ç—å—Å—è
                        full_name: '–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä',
                        role: 'admin',
                        phone: '+79000000000',
                        email: 'admin@zvezdochka.local'
                    };
                    
                    await fetch(`${SUPABASE_URL}/rest/v1/profiles`, {
                        method: 'POST',
                        headers: {
                            'apikey': SUPABASE_KEY,
                            'Authorization': `Bearer ${SUPABASE_KEY}`,
                            'Content-Type': 'application/json',
                            'Prefer': 'return=representation'
                        },
                        body: JSON.stringify(adminData)
                    });
                    
                    console.log('–°–æ–∑–¥–∞–Ω —Ç–µ—Å—Ç–æ–≤—ã–π –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä: admin / admin123');
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∞–¥–º–∏–Ω–∞:', error);
            }
        }
        
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
        function checkAuth() {
            const savedUser = localStorage.getItem('snt_user');
            
            if (savedUser) {
                try {
                    currentUser = JSON.parse(savedUser);
                    
                    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –æ—Å–Ω–æ–≤–Ω–æ–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
                    document.getElementById('loadingScreen').classList.remove('active');
                    document.getElementById('loginScreen').classList.add('d-none');
                    document.getElementById('mainInterface').classList.remove('d-none');
                    document.getElementById('userInfo').classList.remove('d-none');
                    
                    // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ
                    document.getElementById('userName').textContent = currentUser.full_name;
                    document.getElementById('dashboardUserName').textContent = currentUser.full_name;
                    
                    // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                    loadUserData();
                    
                    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º/—Å–∫—Ä—ã–≤–∞–µ–º –≤–∫–ª–∞–¥–∫–∏ –∞–¥–º–∏–Ω–∞
                    if (currentUser.role === 'admin') {
                        document.querySelectorAll('.admin-only').forEach(el => el.style.display = 'block');
                        document.getElementById('adminDashboard').classList.remove('d-none');
                        document.getElementById('userDashboard').classList.add('d-none');
                        loadAdminData();
                    } else {
                        document.querySelectorAll('.admin-only').forEach(el => el.style.display = 'none');
                        document.getElementById('adminDashboard').classList.add('d-none');
                        document.getElementById('userDashboard').classList.remove('d-none');
                    }
                    
                } catch (error) {
                    console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:', error);
                    localStorage.removeItem('snt_user');
                }
            }
        }
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –≤–∫–ª–∞–¥–æ–∫
        function initTabs() {
            document.querySelectorAll('.tab').forEach(tab => {
                tab.addEventListener('click', function() {
                    // –£–±–∏—Ä–∞–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π –∫–ª–∞—Å—Å —É –≤—Å–µ—Ö –≤–∫–ª–∞–¥–æ–∫
                    document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                    document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
                    
                    // –î–æ–±–∞–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π –∫–ª–∞—Å—Å —Ç–µ–∫—É—â–µ–π –≤–∫–ª–∞–¥–∫–µ
                    this.classList.add('active');
                    const tabId = this.getAttribute('data-tab');
                    document.getElementById(tabId).classList.add('active');
                });
            });
        }
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –≤–∫–ª–∞–¥–æ–∫
        function showTab(tabName) {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
            
            document.querySelector(`[data-tab="${tabName}"]`).classList.add('active');
            document.getElementById(tabName).classList.add('active');
        }
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –≤–∫–ª–∞–¥–æ–∫ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏
        function showAdminTab(sectionName) {
            document.querySelectorAll('.admin-section').forEach(s => s.classList.add('d-none'));
            document.getElementById(`admin${sectionName.charAt(0).toUpperCase() + sectionName.slice(1)}`).classList.remove('d-none');
            
            if (sectionName === 'users') loadAllUsers();
            if (sectionName === 'tariffs') loadTariffs();
        }
        
        // –í—Ö–æ–¥ –≤ —Å–∏—Å—Ç–µ–º—É
        document.getElementById('loginBtn').addEventListener('click', async function() {
            const login = document.getElementById('loginUsername').value;
            const password = document.getElementById('loginPassword').value;
            const errorEl = document.getElementById('loginError');
            const loadingEl = document.getElementById('loginLoading');
            
            // –°–±—Ä–æ—Å –æ—à–∏–±–∫–∏
            errorEl.classList.add('d-none');
            errorEl.textContent = '';
            
            // –í–∞–ª–∏–¥–∞—Ü–∏—è
            if (!login || !password) {
                errorEl.textContent = '–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è';
                errorEl.classList.remove('d-none');
                return;
            }
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∑–∞–≥—Ä—É–∑–∫—É
            loadingEl.classList.remove('d-none');
            
            try {
                // –ò—â–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –±–∞–∑–µ
                const response = await fetch(`${SUPABASE_URL}/rest/v1/profiles?login=eq.${encodeURIComponent(login)}&select=*`, {
                    headers: {
                        'apikey': SUPABASE_KEY,
                        'Authorization': `Bearer ${SUPABASE_KEY}`
                    }
                });
                
                if (!response.ok) {
                    throw new Error('–û—à–∏–±–∫–∞ —Å–µ—Ç–∏');
                }
                
                const users = await response.json();
                
                if (users.length === 0) {
                    errorEl.textContent = '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω';
                    errorEl.classList.remove('d-none');
                    return;
                }
                
                const user = users[0];
                
                // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–∞—Ä–æ–ª—è (–≤ —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å —Ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ)
                if (user.password_hash !== password) {
                    errorEl.textContent = '–ù–µ–≤–µ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å';
                    errorEl.classList.remove('d-none');
                    return;
                }
                
                // –°–æ—Ö—Ä–∞–Ω—è–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–±–µ–∑ –ø–∞—Ä–æ–ª—è)
                const { password_hash, ...userWithoutPassword } = user;
                currentUser = userWithoutPassword;
                localStorage.setItem('snt_user', JSON.stringify(currentUser));
                
                // –ü–µ—Ä–µ—Ö–æ–¥–∏–º –∫ –æ—Å–Ω–æ–≤–Ω–æ–º—É –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—É
                document.getElementById('loginScreen').classList.add('d-none');
                document.getElementById('mainInterface').classList.remove('d-none');
                document.getElementById('userInfo').classList.remove('d-none');
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ
                document.getElementById('userName').textContent = currentUser.full_name;
                document.getElementById('dashboardUserName').textContent = currentUser.full_name;
                
                // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                loadUserData();
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º/—Å–∫—Ä—ã–≤–∞–µ–º –≤–∫–ª–∞–¥–∫–∏ –∞–¥–º–∏–Ω–∞
                if (currentUser.role === 'admin') {
                    document.querySelectorAll('.admin-only').forEach(el => el.style.display = 'block');
                    document.getElementById('adminDashboard').classList.remove('d-none');
                    document.getElementById('userDashboard').classList.add('d-none');
                    loadAdminData();
                } else {
                    document.querySelectorAll('.admin-only').forEach(el => el.style.display = 'none');
                    document.getElementById('adminDashboard').classList.add('d-none');
                    document.getElementById('userDashboard').classList.remove('d-none');
                }
                
            } catch (error) {
                errorEl.textContent = `–û—à–∏–±–∫–∞: ${error.message}`;
                errorEl.classList.remove('d-none');
            } finally {
                loadingEl.classList.add('d-none');
            }
        });
        
        // –í—ã—Ö–æ–¥ –∏–∑ —Å–∏—Å—Ç–µ–º—ã
        document.getElementById('logoutBtn').addEventListener('click', function() {
            currentUser = null;
            localStorage.removeItem('snt_user');
            
            document.getElementById('mainInterface').classList.add('d-none');
            document.getElementById('userInfo').classList.add('d-none');
            document.getElementById('loginScreen').classList.remove('d-none');
            
            // –û—á–∏—Å—Ç–∫–∞ –ø–æ–ª–µ–π –≤—Ö–æ–¥–∞
            document.getElementById('loginUsername').value = '';
            document.getElementById('loginPassword').value = '';
        });
        
        // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        async function loadUserData() {
            if (!currentUser) return;
            
            try {
                // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å—á–µ—Ç—á–∏–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                const metersResponse = await fetch(`${SUPABASE_URL}/rest/v1/electricity_meters?user_id=eq.${currentUser.id}&select=*`, {
                    headers: {
                        'apikey': SUPABASE_KEY,
                        'Authorization': `Bearer ${SUPABASE_KEY}`
                    }
                });
                
                const meters = await metersResponse.ok ? await metersResponse.json() : [];
                
                // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º —Å—á–µ—Ç—á–∏–∫–∏
                const metersListEl = document.getElementById('metersList');
                metersListEl.innerHTML = '';
                
                if (meters.length === 0) {
                    metersListEl.innerHTML = '<div class="info-box"><p>–£ –≤–∞—Å –Ω–µ—Ç –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Å—á–µ—Ç—á–∏–∫–æ–≤. –î–æ–±–∞–≤—å—Ç–µ –ø–µ—Ä–≤—ã–π —Å—á–µ—Ç—á–∏–∫.</p></div>';
                } else {
                    meters.forEach(meter => {
                        const meterEl = document.createElement('div');
                        meterEl.className = 'card mb-2';
                        meterEl.innerHTML = `
                            <div class="d-flex justify-between align-center">
                                <div>
                                    <h4>–°—á–µ—Ç—á–∏–∫ ${meter.meter_number}</h4>
                                    <p>–ü–æ—Å–ª–µ–¥–Ω–∏–µ –ø–æ–∫–∞–∑–∞–Ω–∏—è: <span id="lastReading_${meter.id}">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö</span></p>
                                </div>
                                <div>
                                    <button class="btn btn-primary btn-sm" onclick="showAddReadingModal('${meter.id}')">üìù –ü–µ—Ä–µ–¥–∞—Ç—å –ø–æ–∫–∞–∑–∞–Ω–∏—è</button>
                                    <button class="btn btn-danger btn-sm" onclick="deleteMeter('${meter.id}')">üóëÔ∏è –£–¥–∞–ª–∏—Ç—å</button>
                                </div>
                            </div>
                        `;
                        metersListEl.appendChild(meterEl);
                        
                        // –ó–∞–≥—Ä—É–∂–∞–µ–º –ø–æ—Å–ª–µ–¥–Ω–∏–µ –ø–æ–∫–∞–∑–∞–Ω–∏—è –¥–ª—è —ç—Ç–æ–≥–æ —Å—á–µ—Ç—á–∏–∫–∞
                        loadLastReading(meter.id);
                    });
                }
                
                // –ó–∞–≥—Ä—É–∂–∞–µ–º —Ç–µ–∫—É—â–∏–µ —Ç–∞—Ä–∏—Ñ—ã
                await loadCurrentTariffs();
                
                // –ó–∞–≥—Ä—É–∂–∞–µ–º –∏—Å—Ç–æ—Ä–∏—é –ø–æ–∫–∞–∑–∞–Ω–∏–π
                await loadReadingsHistory();
                
                // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –æ–± —É—á–∞—Å—Ç–∫–∞—Ö
                await loadUserPlots();
                
                // –ó–∞–≥—Ä—É–∂–∞–µ–º –∏—Å—Ç–æ—Ä–∏—é –≤–∑–Ω–æ—Å–æ–≤
                await loadFeesHistory();
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –ø—Ä–æ—Ñ–∏–ª—å
                updateProfileForm();
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:', error);
            }
        }
        
        // –ó–∞–≥—Ä—É–∑–∫–∞ –ø–æ—Å–ª–µ–¥–Ω–∏—Ö –ø–æ–∫–∞–∑–∞–Ω–∏–π –¥–ª—è —Å—á–µ—Ç—á–∏–∫–∞
        async function loadLastReading(meterId) {
            try {
                const response = await fetch(`${SUPABASE_URL}/rest/v1/electricity_readings?meter_id=eq.${meterId}&order=month.desc&limit=1`, {
                    headers: {
                        'apikey': SUPABASE_KEY,
                        'Authorization': `Bearer ${SUPABASE_KEY}`
                    }
                });
                
                if (response.ok) {
                    const readings = await response.json();
                    const lastReadingEl = document.getElementById(`lastReading_${meterId}`);
                    
                    if (readings.length > 0) {
                        lastReadingEl.textContent = `${readings[0].reading} –∫–í—Ç¬∑—á (${readings[0].month})`;
                    }
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –ø–æ—Å–ª–µ–¥–Ω–∏—Ö –ø–æ–∫–∞–∑–∞–Ω–∏–π:', error);
            }
        }
        
        // –ó–∞–≥—Ä—É–∑–∫–∞ —Ç–µ–∫—É—â–∏—Ö —Ç–∞—Ä–∏—Ñ–æ–≤
        async function loadCurrentTariffs() {
            try {
                // –ü–æ–ª—É—á–∞–µ–º –ø–æ—Å–ª–µ–¥–Ω–∏–π —Ç–∞—Ä–∏—Ñ (–∑–∞ —Ç–µ–∫—É—â–∏–π –∏–ª–∏ –ø—Ä–µ–¥—ã–¥—É—â–∏–π –º–µ—Å—è—Ü)
                const response = await fetch(`${SUPABASE_URL}/rest/v1/tariffs?order=month.desc&limit=1`, {
                    headers: {
                        'apikey': SUPABASE_KEY,
                        'Authorization': `Bearer ${SUPABASE_KEY}`
                    }
                });
                
                if (response.ok) {
                    const tariffs = await response.json();
                    
                    if (tariffs.length > 0) {
                        const tariff = tariffs[0];
                        
                        // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ç–∞—Ä–∏—Ñ–∞—Ö
                        document.getElementById('lossTariff').textContent = tariff.loss_tariff || '0';
                        document.getElementById('under100Tariff').textContent = tariff.tariff_under_100 || '0';
                        document.getElementById('over100Tariff').textContent = tariff.tariff_over_100 || '0';
                        
                        document.getElementById('salaryFee').textContent = tariff.salary_per_plot || '0';
                        document.getElementById('maintenanceFee').textContent = tariff.maintenance_per_sotka || '0';
                        
                        // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è
                        if (tariff.additional_field1_name) {
                            document.getElementById('additionalField1').innerHTML = `${tariff.additional_field1_name}: <span id="additionalFee1">${tariff.additional_field1_value || '0'}</span> ‚ÇΩ`;
                        }
                        if (tariff.additional_field2_name) {
                            document.getElementById('additionalField2').innerHTML = `${tariff.additional_field2_name}: <span id="additionalFee2">${tariff.additional_field2_value || '0'}</span> ‚ÇΩ`;
                        }
                        if (tariff.additional_field3_name) {
                            document.getElementById('additionalField3').innerHTML = `${tariff.additional_field3_name}: <span id="additionalFee3">${tariff.additional_field3_value || '0'}</span> ‚ÇΩ`;
                        }
                    }
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Ç–∞—Ä–∏—Ñ–æ–≤:', error);
            }
        }
        
        // –ó–∞–≥—Ä—É–∑–∫–∞ –∏—Å—Ç–æ—Ä–∏–∏ –ø–æ–∫–∞–∑–∞–Ω–∏–π
        async function loadReadingsHistory() {
            try {
                // –î–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è - —Ç–æ–ª—å–∫–æ –µ–≥–æ –ø–æ–∫–∞–∑–∞–Ω–∏—è
                // –î–ª—è –∞–¥–º–∏–Ω–∞ - –≤—Å–µ –ø–æ–∫–∞–∑–∞–Ω–∏—è
                let url = `${SUPABASE_URL}/rest/v1/electricity_readings`;
                
                if (currentUser.role !== 'admin') {
                    // –ü–æ–ª—É—á–∞–µ–º —Å–Ω–∞—á–∞–ª–∞ —Å—á–µ—Ç—á–∏–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –∑–∞—Ç–µ–º –ø–æ–∫–∞–∑–∞–Ω–∏—è
                    const metersResponse = await fetch(`${SUPABASE_URL}/rest/v1/electricity_meters?user_id=eq.${currentUser.id}&select=id`, {
                        headers: {
                            'apikey': SUPABASE_KEY,
                            'Authorization': `Bearer ${SUPABASE_KEY}`
                        }
                    });
                    
                    if (!metersResponse.ok) return;
                    
                    const meters = await metersResponse.json();
                    const meterIds = meters.map(m => m.id).join(',');
                    
                    if (meterIds.length === 0) return;
                    
                    url = `${SUPABASE_URL}/rest/v1/electricity_readings?meter_id=in.(${meterIds})&order=month.desc&limit=50`;
                } else {
                    url = `${SUPABASE_URL}/rest/v1/electricity_readings?order=month.desc&limit=50`;
                }
                
                const response = await fetch(url, {
                    headers: {
                        'apikey': SUPABASE_KEY,
                        'Authorization': `Bearer ${SUPABASE_KEY}`
                    }
                });
                
                if (response.ok) {
                    const readings = await response.json();
                    const tableBody = document.getElementById('readingsTableBody');
                    tableBody.innerHTML = '';
                    
                    // –ü–æ–ª—É—á–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Å—á–µ—Ç—á–∏–∫–∞—Ö
                    const meterIds = [...new Set(readings.map(r => r.meter_id))];
                    let meters = {};
                    
                    if (meterIds.length > 0) {
                        const metersResponse = await fetch(`${SUPABASE_URL}/rest/v1/electricity_meters?id=in.(${meterIds.join(',')})&select=id,meter_number,user_id`, {
                            headers: {
                                'apikey': SUPABASE_KEY,
                                'Authorization': `Bearer ${SUPABASE_KEY}`
                            }
                        });
                        
                        if (metersResponse.ok) {
                            const metersData = await metersResponse.json();
                            metersData.forEach(m => {
                                meters[m.id] = m;
                            });
                        }
                    }
                    
                    // –ó–∞–ø–æ–ª–Ω—è–µ–º —Ç–∞–±–ª–∏—Ü—É
                    readings.forEach(reading => {
                        const meter = meters[reading.meter_id] || {};
                        const row = document.createElement('tr');
                        
                        // –†–∞—Å—á–µ—Ç —Å—É–º–º—ã (—É–ø—Ä–æ—â–µ–Ω–Ω—ã–π)
                        const consumption = reading.consumption || 0;
                        let amount = 0;
                        
                        row.innerHTML = `
                            <td>${reading.month}</td>
                            <td>${meter.meter_number || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ'}</td>
                            <td>${reading.reading} –∫–í—Ç¬∑—á</td>
                            <td>${consumption} –∫–í—Ç¬∑—á</td>
                            <td>${amount.toFixed(2)} ‚ÇΩ</td>
                            <td><span class="status-badge ${reading.verified ? 'status-success' : 'status-warning'}">${reading.verified ? '–ü—Ä–æ–≤–µ—Ä–µ–Ω–æ' : '–û–∂–∏–¥–∞–µ—Ç'}</span></td>
                        `;
                        
                        tableBody.appendChild(row);
                    });
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –∏—Å—Ç–æ—Ä–∏–∏ –ø–æ–∫–∞–∑–∞–Ω–∏–π:', error);
            }
        }
        
        // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –æ–± —É—á–∞—Å—Ç–∫–∞—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        async function loadUserPlots() {
            try {
                // –í —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –∑–¥–µ—Å—å –±—ã–ª–∞ –±—ã —Ç–∞–±–ª–∏—Ü–∞ plots
                // –î–ª—è –¥–µ–º–æ –∏—Å–ø–æ–ª—å–∑—É–µ–º –ø–æ–ª—è –∏–∑ –ø—Ä–æ—Ñ–∏–ª—è
                const plots = currentUser.plots_count || 1;
                const sotki = currentUser.sotki_per_plot || 6;
                
                const totalSotki = plots * sotki;
                
                document.getElementById('userPlots').innerHTML = `
                    <p>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —É—á–∞—Å—Ç–∫–æ–≤: <strong>${plots}</strong></p>
                    <p>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–æ—Ç–æ–∫ –Ω–∞ —É—á–∞—Å—Ç–∫–µ: <strong>${sotki}</strong></p>
                    <p>–û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–æ—Ç–æ–∫: <strong>${totalSotki}</strong></p>
                `;
                
                document.getElementById('plotCount').textContent = plots;
                document.getElementById('sotkiCount').textContent = totalSotki;
                
                // –†–∞—Å—á–µ—Ç –≤–∑–Ω–æ—Å–æ–≤
                const salaryFee = parseFloat(document.getElementById('salaryFee').textContent) || 0;
                const maintenanceFee = parseFloat(document.getElementById('maintenanceFee').textContent) || 0;
                const additionalFee1 = parseFloat(document.getElementById('additionalFee1')?.textContent || 0) || 0;
                const additionalFee2 = parseFloat(document.getElementById('additionalFee2')?.textContent || 0) || 0;
                const additionalFee3 = parseFloat(document.getElementById('additionalFee3')?.textContent || 0) || 0;
                
                const calculatedSalary = salaryFee * plots;
                const calculatedMaintenance = maintenanceFee * totalSotki;
                const calculatedAdditional = additionalFee1 + additionalFee2 + additionalFee3;
                const totalFees = calculatedSalary + calculatedMaintenance + calculatedAdditional;
                
                document.getElementById('calculatedSalary').textContent = calculatedSalary.toFixed(2);
                document.getElementById('calculatedMaintenance').textContent = calculatedMaintenance.toFixed(2);
                document.getElementById('calculatedAdditional').textContent = calculatedAdditional.toFixed(2);
                document.getElementById('totalFees').textContent = totalFees.toFixed(2);
                
                // –û–±—â–∞—è —Å—É–º–º–∞ –∫ –æ–ø–ª–∞—Ç–µ
                document.getElementById('totalAmount').textContent = totalFees.toFixed(2) + ' ‚ÇΩ';
                document.getElementById('lastUpdate').textContent = `–û–±–Ω–æ–≤–ª–µ–Ω–æ: ${new Date().toLocaleDateString()}`;
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –¥–∞–Ω–Ω—ã—Ö –æ–± —É—á–∞—Å—Ç–∫–∞—Ö:', error);
            }
        }
        
        // –ó–∞–≥—Ä—É–∑–∫–∞ –∏—Å—Ç–æ—Ä–∏–∏ –≤–∑–Ω–æ—Å–æ–≤
        async function loadFeesHistory() {
            try {
                // –î–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è - —Ç–æ–ª—å–∫–æ –µ–≥–æ –≤–∑–Ω–æ—Å—ã
                let url = `${SUPABASE_URL}/rest/v1/membership_fees`;
                
                if (currentUser.role !== 'admin') {
                    url = `${SUPABASE_URL}/rest/v1/membership_fees?user_id=eq.${currentUser.id}&order=month.desc&limit=12`;
                } else {
                    url = `${SUPABASE_URL}/rest/v1/membership_fees?order=month.desc&limit=50`;
                }
                
                const response = await fetch(url, {
                    headers: {
                        'apikey': SUPABASE_KEY,
                        'Authorization': `Bearer ${SUPABASE_KEY}`
                    }
                });
                
                if (response.ok) {
                    const fees = await response.json();
                    const tableBody = document.getElementById('feesTableBody');
                    tableBody.innerHTML = '';
                    
                    fees.forEach(fee => {
                        const row = document.createElement('tr');
                        
                        row.innerHTML = `
                            <td>${fee.month}</td>
                            <td>${fee.salary_fee || 0} ‚ÇΩ</td>
                            <td>${fee.maintenance_fee || 0} ‚ÇΩ</td>
                            <td>${(fee.other_fee || 0) + (fee.additional_fee1 || 0) + (fee.additional_fee2 || 0) + (fee.additional_fee3 || 0)} ‚ÇΩ</td>
                            <td>${fee.total_amount || 0} ‚ÇΩ</td>
                            <td><span class="status-badge ${fee.paid ? 'status-success' : 'status-warning'}">${fee.paid ? '–û–ø–ª–∞—á–µ–Ω–æ' : '–û–∂–∏–¥–∞–µ—Ç'}</span></td>
                        `;
                        
                        tableBody.appendChild(row);
                    });
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –∏—Å—Ç–æ—Ä–∏–∏ –≤–∑–Ω–æ—Å–æ–≤:', error);
            }
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ñ–æ—Ä–º—ã –ø—Ä–æ—Ñ–∏–ª—è
        function updateProfileForm() {
            if (!currentUser) return;
            
            document.getElementById('profileName').value = currentUser.full_name || '';
            document.getElementById('profileLogin').value = currentUser.login || '';
            document.getElementById('profileRole').value = currentUser.role === 'admin' ? '–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä' : '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å';
            document.getElementById('profilePhone').value = currentUser.phone || '';
            document.getElementById('profileEmail').value = currentUser.email || '';
        }
        
        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è
        document.getElementById('saveProfileBtn').addEventListener('click', async function() {
            if (!currentUser) return;
            
            const phone = document.getElementById('profilePhone').value;
            const email = document.getElementById('profileEmail').value;
            const password = document.getElementById('profilePassword').value;
            
            try {
                const updateData = {
                    phone: phone,
                    email: email,
                    updated_at: new Date().toISOString()
                };
                
                // –ï—Å–ª–∏ —É–∫–∞–∑–∞–Ω –Ω–æ–≤—ã–π –ø–∞—Ä–æ–ª—å
                if (password) {
                    updateData.password_hash = password; // –í —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å —Ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ
                }
                
                const response = await fetch(`${SUPABASE_URL}/rest/v1/profiles?id=eq.${currentUser.id}`, {
                    method: 'PATCH',
                    headers: {
                        'apikey': SUPABASE_KEY,
                        'Authorization': `Bearer ${SUPABASE_KEY}`,
                        'Content-Type': 'application/json',
                        'Prefer': 'return=representation'
                    },
                    body: JSON.stringify(updateData)
                });
                
                if (response.ok) {
                    alert('–ü—Ä–æ—Ñ–∏–ª—å —É—Å–ø–µ—à–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω');
                    
                    // –û–±–Ω–æ–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ localStorage
                    currentUser.phone = phone;
                    currentUser.email = email;
                    localStorage.setItem('snt_user', JSON.stringify(currentUser));
                    
                    // –û—á–∏—â–∞–µ–º –ø–æ–ª–µ –ø–∞—Ä–æ–ª—è
                    document.getElementById('profilePassword').value = '';
                } else {
                    alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –ø—Ä–æ—Ñ–∏–ª—è');
                }
            } catch (error) {
                alert(`–û—à–∏–±–∫–∞: ${error.message}`);
            }
        });
        
        // –ü–æ–∫–∞–∑–∞—Ç—å –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Å—á–µ—Ç—á–∏–∫–∞
        document.getElementById('addMeterBtn').addEventListener('click', function() {
            document.getElementById('addMeterModal').classList.add('active');
        });
        
        // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove('active');
        }
        
        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å—á–µ—Ç—á–∏–∫–∞
        async function saveMeter() {
            if (!currentUser) return;
            
            const meterNumber = document.getElementById('meterNumber').value;
            const initialReading = document.getElementById('initialReading').value;
            
            if (!meterNumber) {
                alert('–í–≤–µ–¥–∏—Ç–µ –Ω–æ–º–µ—Ä —Å—á–µ—Ç—á–∏–∫–∞');
                return;
            }
            
            try {
                const meterData = {
                    user_id: currentUser.id,
                    meter_number: meterNumber,
                    meter_type: document.getElementById('meterType').value,
                    created_at: new Date().toISOString()
                };
                
                const response = await fetch(`${SUPABASE_URL}/rest/v1/electricity_meters`, {
                    method: 'POST',
                    headers: {
                        'apikey': SUPABASE_KEY,
                        'Authorization': `Bearer ${SUPABASE_KEY}`,
                        'Content-Type': 'application/json',
                        'Prefer': 'return=representation'
                    },
                    body: JSON.stringify(meterData)
                });
                
                if (response.ok) {
                    const newMeter = await response.json();
                    
                    // –ï—Å–ª–∏ —É–∫–∞–∑–∞–Ω—ã –Ω–∞—á–∞–ª—å–Ω—ã–µ –ø–æ–∫–∞–∑–∞–Ω–∏—è
                    if (initialReading) {
                        const readingData = {
                            meter_id: newMeter[0].id,
                            month: currentMonth,
                            reading: parseFloat(initialReading),
                            created_at: new Date().toISOString()
                        };
                        
                        await fetch(`${SUPABASE_URL}/rest/v1/electricity_readings`, {
                            method: 'POST',
                            headers: {
                                'apikey': SUPABASE_KEY,
                                'Authorization': `Bearer ${SUPABASE_KEY}`,
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify(readingData)
                        });
                    }
                    
                    alert('–°—á–µ—Ç—á–∏–∫ —É—Å–ø–µ—à–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω');
                    closeModal('addMeterModal');
                    
                    // –û—á–∏—â–∞–µ–º —Ñ–æ—Ä–º—É
                    document.getElementById('meterNumber').value = '';
                    document.getElementById('initialReading').value = '';
                    
                    // –û–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫ —Å—á–µ—Ç—á–∏–∫–æ–≤
                    loadUserData();
                } else {
                    alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ —Å—á–µ—Ç—á–∏–∫–∞');
                }
            } catch (error) {
                alert(`–û—à–∏–±–∫–∞: ${error.message}`);
            }
        }
        
        // –£–¥–∞–ª–µ–Ω–∏–µ —Å—á–µ—Ç—á–∏–∫–∞
        async function deleteMeter(meterId) {
            if (!confirm('–£–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç —Å—á–µ—Ç—á–∏–∫?')) return;
            
            try {
                // –°–Ω–∞—á–∞–ª–∞ —É–¥–∞–ª—è–µ–º –ø–æ–∫–∞–∑–∞–Ω–∏—è
                await fetch(`${SUPABASE_URL}/rest/v1/electricity_readings?meter_id=eq.${meterId}`, {
                    method: 'DELETE',
                    headers: {
                        'apikey': SUPABASE_KEY,
                        'Authorization': `Bearer ${SUPABASE_KEY}`
                    }
                });
                
                // –ó–∞—Ç–µ–º —É–¥–∞–ª—è–µ–º —Å—á–µ—Ç—á–∏–∫
                const response = await fetch(`${SUPABASE_URL}/rest/v1/electricity_meters?id=eq.${meterId}`, {
                    method: 'DELETE',
                    headers: {
                        'apikey': SUPABASE_KEY,
                        'Authorization': `Bearer ${SUPABASE_KEY}`
                    }
                });
                
                if (response.ok) {
                    alert('–°—á–µ—Ç—á–∏–∫ —É–¥–∞–ª–µ–Ω');
                    loadUserData();
                }
            } catch (error) {
                alert(`–û—à–∏–±–∫–∞: ${error.message}`);
            }
        }
        
        // –ü–æ–∫–∞–∑–∞—Ç—å –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ø–µ—Ä–µ–¥–∞—á–∏ –ø–æ–∫–∞–∑–∞–Ω–∏–π
        async function showAddReadingModal(meterId = null) {
            if (!currentUser) return;
            
            // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å–ø–∏—Å–æ–∫ —Å—á–µ—Ç—á–∏–∫–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            try {
                const response = await fetch(`${SUPABASE_URL}/rest/v1/electricity_meters?user_id=eq.${currentUser.id}&select=id,meter_number`, {
                    headers: {
                        'apikey': SUPABASE_KEY,
                        'Authorization': `Bearer ${SUPABASE_KEY}`
                    }
                });
                
                if (response.ok) {
                    const meters = await response.json();
                    const select = document.getElementById('readingMeterId');
                    select.innerHTML = '';
                    
                    meters.forEach(meter => {
                        const option = document.createElement('option');
                        option.value = meter.id;
                        option.textContent = meter.meter_number;
                        if (meterId && meter.id === meterId) {
                            option.selected = true;
                        }
                        select.appendChild(option);
                    });
                    
                    document.getElementById('addReadingModal').classList.add('active');
                }
            } catch (error) {
                alert(`–û—à–∏–±–∫–∞: ${error.message}`);
            }
        }
        
        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø–æ–∫–∞–∑–∞–Ω–∏–π
        async function saveReading() {
            const meterId = document.getElementById('readingMeterId').value;
            const month = document.getElementById('readingMonth').value;
            const reading = document.getElementById('readingValue').value;
            
            if (!meterId || !month || !reading) {
                alert('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è');
                return;
            }
            
            try {
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ —É–∂–µ –ø–æ–∫–∞–∑–∞–Ω–∏—è –∑–∞ —ç—Ç–æ—Ç –º–µ—Å—è—Ü
                const checkResponse = await fetch(`${SUPABASE_URL}/rest/v1/electricity_readings?meter_id=eq.${meterId}&month=eq.${month}`, {
                    headers: {
                        'apikey': SUPABASE_KEY,
                        'Authorization': `Bearer ${SUPABASE_KEY}`
                    }
                });
                
                if (checkResponse.ok) {
                    const existing = await checkResponse.json();
                    
                    if (existing.length > 0) {
                        if (!confirm('–ü–æ–∫–∞–∑–∞–Ω–∏—è –∑–∞ —ç—Ç–æ—Ç –º–µ—Å—è—Ü —É–∂–µ –µ—Å—Ç—å. –û–±–Ω–æ–≤–∏—Ç—å?')) {
                            return;
                        }
                        
                        // –û–±–Ω–æ–≤–ª—è–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –ø–æ–∫–∞–∑–∞–Ω–∏—è
                        const updateResponse = await fetch(`${SUPABASE_URL}/rest/v1/electricity_readings?meter_id=eq.${meterId}&month=eq.${month}`, {
                            method: 'PATCH',
                            headers: {
                                'apikey': SUPABASE_KEY,
                                'Authorization': `Bearer ${SUPABASE_KEY}`,
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify({
                                reading: parseFloat(reading),
                                updated_at: new Date().toISOString()
                            })
                        });
                        
                        if (updateResponse.ok) {
                            alert('–ü–æ–∫–∞–∑–∞–Ω–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω—ã');
                        } else {
                            alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –ø–æ–∫–∞–∑–∞–Ω–∏–π');
                            return;
                        }
                    } else {
                        // –î–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤—ã–µ –ø–æ–∫–∞–∑–∞–Ω–∏—è
                        const readingData = {
                            meter_id: meterId,
                            month: month,
                            reading: parseFloat(reading),
                            created_at: new Date().toISOString()
                        };
                        
                        const response = await fetch(`${SUPABASE_URL}/rest/v1/electricity_readings`, {
                            method: 'POST',
                            headers: {
                                'apikey': SUPABASE_KEY,
                                'Authorization': `Bearer ${SUPABASE_KEY}`,
                                'Content-Type': 'application/json',
                                'Prefer': 'return=representation'
                            },
                            body: JSON.stringify(readingData)
                        });
                        
                        if (!response.ok) {
                            alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –ø–æ–∫–∞–∑–∞–Ω–∏–π');
                            return;
                        }
                        
                        alert('–ü–æ–∫–∞–∑–∞–Ω–∏—è —É—Å–ø–µ—à–Ω–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã');
                    }
                    
                    closeModal('addReadingModal');
                    loadUserData();
                }
            } catch (error) {
                alert(`–û—à–∏–±–∫–∞: ${error.message}`);
            }
        }
        
        // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏
        async function loadAdminData() {
            try {
                // –ó–∞–≥—Ä—É–∂–∞–µ–º –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
                await loadAllUsers();
                
                // –ó–∞–≥—Ä—É–∂–∞–µ–º —Ç–∞—Ä–∏—Ñ—ã
                await loadTariffs();
                
                // –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
                await loadAdminStats();
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –¥–∞–Ω–Ω—ã—Ö –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏:', error);
            }
        }
        
        // –ó–∞–≥—Ä—É–∑–∫–∞ –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
        async function loadAllUsers() {
            try {
                const response = await fetch(`${SUPABASE_URL}/rest/v1/profiles?select=*&order=full_name.asc`, {
                    headers: {
                        'apikey': SUPABASE_KEY,
                        'Authorization': `Bearer ${SUPABASE_KEY}`
                    }
                });
                
                if (response.ok) {
                    const users = await response.json();
                    const tableBody = document.getElementById('adminUsersTable');
                    tableBody.innerHTML = '';
                    
                    // –ü–æ–ª—É—á–∞–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ø–æ —Å—á–µ—Ç—á–∏–∫–∞–º –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                    const meterResponse = await fetch(`${SUPABASE_URL}/rest/v1/electricity_meters?select=user_id`, {
                        headers: {
                            'apikey': SUPABASE_KEY,
                            'Authorization': `Bearer ${SUPABASE_KEY}`
                        }
                    });
                    
                    const meters = meterResponse.ok ? await meterResponse.json() : [];
                    
                    // –ì—Ä—É–ø–ø–∏—Ä—É–µ–º —Å—á–µ—Ç—á–∏–∫–∏ –ø–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º
                    const metersByUser = {};
                    meters.forEach(meter => {
                        metersByUser[meter.user_id] = (metersByUser[meter.user_id] || 0) + 1;
                    });
                    
                    users.forEach(user => {
                        const row = document.createElement('tr');
                        const meterCount = metersByUser[user.id] || 0;
                        const plotCount = user.plots_count || 1;
                        
                        row.innerHTML = `
                            <td>${user.id.substring(0, 8)}...</td>
                            <td>${user.full_name}</td>
                            <td>${user.login}</td>
                            <td><span class="status-badge ${user.role === 'admin' ? 'status-success' : 'status-warning'}">${user.role === 'admin' ? '–ê–¥–º–∏–Ω' : '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å'}</span></td>
                            <td>${plotCount}</td>
                            <td>${meterCount}</td>
                            <td class="actions">
                                <button class="btn btn-sm btn-primary" onclick="editUser('${user.id}')">‚úèÔ∏è</button>
                                <button class="btn btn-sm btn-danger" onclick="deleteUser('${user.id}')" ${user.id === currentUser.id ? 'disabled' : ''}>üóëÔ∏è</button>
                            </td>
                        `;
                        
                        tableBody.appendChild(row);
                    });
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π:', error);
            }
        }
        
        // –ó–∞–≥—Ä—É–∑–∫–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –¥–ª—è –∞–¥–º–∏–Ω–∞
        async function loadAdminStats() {
            try {
                // –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
                const usersResponse = await fetch(`${SUPABASE_URL}/rest/v1/profiles?select=id`, {
                    headers: {
                        'apikey': SUPABASE_KEY,
                        'Authorization': `Bearer ${SUPABASE_KEY}`
                    }
                });
                
                if (usersResponse.ok) {
                    const users = await usersResponse.json();
                    document.getElementById('userCount').textContent = users.length;
                }
                
                // –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å—á–µ—Ç—á–∏–∫–æ–≤
                const metersResponse = await fetch(`${SUPABASE_URL}/rest/v1/electricity_meters?select=id`, {
                    headers: {
                        'apikey': SUPABASE_KEY,
                        'Authorization': `Bearer ${SUPABASE_KEY}`
                    }
                });
                
                if (metersResponse.ok) {
                    const meters = await metersResponse.json();
                    document.getElementById('meterCount').textContent = meters.length;
                }
                
                // –ü–æ—Å–ª–µ–¥–Ω–∏–µ –ø–æ–∫–∞–∑–∞–Ω–∏—è
                const readingsResponse = await fetch(`${SUPABASE_URL}/rest/v1/electricity_readings?order=month.desc&limit=1`, {
                    headers: {
                        'apikey': SUPABASE_KEY,
                        'Authorization': `Bearer ${SUPABASE_KEY}`
                    }
                });
                
                if (readingsResponse.ok) {
                    const readings = await readingsResponse.json();
                    if (readings.length > 0) {
                        document.getElementById('lastReadingDate').textContent = readings[0].month;
                    }
                }
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏:', error);
            }
        }
        
        // –ü–æ–∫–∞–∑–∞—Ç—å –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        function showAddUserModal() {
            document.getElementById('addUserModal').classList.add('active');
        }
        
        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        async function saveNewUser() {
            const fullName = document.getElementById('newUserName').value;
            const login = document.getElementById('newUserLogin').value;
            const password = document.getElementById('newUserPassword').value;
            const role = document.getElementById('newUserRole').value;
            const plots = document.getElementById('newUserPlots').value;
            const sotki = document.getElementById('newUserSotki').value;
            
            if (!fullName || !login || !password) {
                alert('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è');
                return;
            }
            
            try {
                const userData = {
                    full_name: fullName,
                    login: login,
                    password_hash: password, // –í —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å —Ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ
                    role: role,
                    plots_count: parseInt(plots),
                    sotki_per_plot: parseFloat(sotki),
                    created_at: new Date().toISOString()
                };
                
                const response = await fetch(`${SUPABASE_URL}/rest/v1/profiles`, {
                    method: 'POST',
                    headers: {
                        'apikey': SUPABASE_KEY,
                        'Authorization': `Bearer ${SUPABASE_KEY}`,
                        'Content-Type': 'application/json',
                        'Prefer': 'return=representation'
                    },
                    body: JSON.stringify(userData)
                });
                
                if (response.ok) {
                    alert('–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É—Å–ø–µ—à–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω');
                    closeModal('addUserModal');
                    
                    // –û—á–∏—â–∞–µ–º —Ñ–æ—Ä–º—É
                    document.getElementById('newUserName').value = '';
                    document.getElementById('newUserLogin').value = '';
                    document.getElementById('newUserPassword').value = '';
                    
                    // –û–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
                    loadAllUsers();
                    loadAdminStats();
                } else {
                    alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è');
                }
            } catch (error) {
                alert(`–û—à–∏–±–∫–∞: ${error.message}`);
            }
        }
        
        // –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (—É–ø—Ä–æ—â–µ–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è)
        async function editUser(userId) {
            alert('–§—É–Ω–∫—Ü–∏—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ');
        }
        
        // –£–¥–∞–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        async function deleteUser(userId) {
            if (!confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è?')) return;
            
            try {
                // –°–Ω–∞—á–∞–ª–∞ —É–¥–∞–ª—è–µ–º —Å–≤—è–∑–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
                // –£–¥–∞–ª—è–µ–º —Å—á–µ—Ç—á–∏–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                const metersResponse = await fetch(`${SUPABASE_URL}/rest/v1/electricity_meters?user_id=eq.${userId}&select=id`, {
                    headers: {
                        'apikey': SUPABASE_KEY,
                        'Authorization': `Bearer ${SUPABASE_KEY}`
                    }
                });
                
                if (metersResponse.ok) {
                    const meters = await metersResponse.json();
                    
                    // –£–¥–∞–ª—è–µ–º –ø–æ–∫–∞–∑–∞–Ω–∏—è –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Å—á–µ—Ç—á–∏–∫–∞
                    for (const meter of meters) {
                        await fetch(`${SUPABASE_URL}/rest/v1/electricity_readings?meter_id=eq.${meter.id}`, {
                            method: 'DELETE',
                            headers: {
                                'apikey': SUPABASE_KEY,
                                'Authorization': `Bearer ${SUPABASE_KEY}`
                            }
                        });
                    }
                    
                    // –£–¥–∞–ª—è–µ–º —Å—á–µ—Ç—á–∏–∫–∏
                    await fetch(`${SUPABASE_URL}/rest/v1/electricity_meters?user_id=eq.${userId}`, {
                        method: 'DELETE',
                        headers: {
                            'apikey': SUPABASE_KEY,
                            'Authorization': `Bearer ${SUPABASE_KEY}`
                        }
                    });
                }
                
                // –£–¥–∞–ª—è–µ–º –≤–∑–Ω–æ—Å—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                await fetch(`${SUPABASE_URL}/rest/v1/membership_fees?user_id=eq.${userId}`, {
                    method: 'DELETE',
                    headers: {
                        'apikey': SUPABASE_KEY,
                        'Authorization': `Bearer ${SUPABASE_KEY}`
                    }
                });
                
                // –£–¥–∞–ª—è–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                const response = await fetch(`${SUPABASE_URL}/rest/v1/profiles?id=eq.${userId}`, {
                    method: 'DELETE',
                    headers: {
                        'apikey': SUPABASE_KEY,
                        'Authorization': `Bearer ${SUPABASE_KEY}`
                    }
                });
                
                if (response.ok) {
                    alert('–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É–¥–∞–ª–µ–Ω');
                    loadAllUsers();
                    loadAdminStats();
                }
            } catch (error) {
                alert(`–û—à–∏–±–∫–∞: ${error.message}`);
            }
        }
        
        // –ó–∞–≥—Ä—É–∑–∫–∞ —Ç–∞—Ä–∏—Ñ–æ–≤
        async function loadTariffs() {
            try {
                const response = await fetch(`${SUPABASE_URL}/rest/v1/tariffs?order=month.desc&limit=12`, {
                    headers: {
                        'apikey': SUPABASE_KEY,
                        'Authorization': `Bearer ${SUPABASE_KEY}`
                    }
                });
                
                if (response.ok) {
                    const tariffs = await response.json();
                    const tableBody = document.getElementById('tariffsTableBody');
                    tableBody.innerHTML = '';
                    
                    tariffs.forEach(tariff => {
                        const row = document.createElement('tr');
                        row.innerHTML = `
                            <td>${tariff.month}</td>
                            <td>${tariff.loss_tariff || 0} ‚ÇΩ</td>
                            <td>${tariff.tariff_under_100 || 0} ‚ÇΩ</td>
                            <td>${tariff.tariff_over_100 || 0} ‚ÇΩ</td>
                            <td>${tariff.salary_per_plot || 0} ‚ÇΩ</td>
                            <td>${tariff.maintenance_per_sotka || 0} ‚ÇΩ</td>
                            <td class="actions">
                                <button class="btn btn-sm btn-primary" onclick="editTariff('${tariff.id}')">‚úèÔ∏è</button>
                                <button class="btn btn-sm btn-danger" onclick="deleteTariff('${tariff.id}')">üóëÔ∏è</button>
                            </td>
                        `;
                        tableBody.appendChild(row);
                    });
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Ç–∞—Ä–∏—Ñ–æ–≤:', error);
            }
        }
        
        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ç–∞—Ä–∏—Ñ–∞
        async function saveTariff() {
            const month = document.getElementById('tariffMonth').value;
            const lossTariff = document.getElementById('tariffLoss').value;
            const under100Tariff = document.getElementById('tariffUnder100').value;
            const over100Tariff = document.getElementById('tariffOver100').value;
            const salaryTariff = document.getElementById('tariffSalary').value;
            const maintenanceTariff = document.getElementById('tariffMaintenance').value;
            const additional1Name = document.getElementById('tariffAdditional1Name').value;
            const additional1Value = document.getElementById('tariffAdditional1Value').value;
            const additional2Name = document.getElementById('tariffAdditional2Name').value;
            const additional2Value = document.getElementById('tariffAdditional2Value').value;
            const additional3Name = document.getElementById('tariffAdditional3Name').value;
            const additional3Value = document.getElementById('tariffAdditional3Value').value;
            
            if (!month) {
                alert('–£–∫–∞–∂–∏—Ç–µ –º–µ—Å—è—Ü');
                return;
            }
            
            try {
                const tariffData = {
                    month: month,
                    loss_tariff: parseFloat(lossTariff) || 0,
                    tariff_under_100: parseFloat(under100Tariff) || 0,
                    tariff_over_100: parseFloat(over100Tariff) || 0,
                    salary_per_plot: parseFloat(salaryTariff) || 0,
                    maintenance_per_sotka: parseFloat(maintenanceTariff) || 0,
                    additional_field1_name: additional1Name || null,
                    additional_field1_value: parseFloat(additional1Value) || 0,
                    additional_field2_name: additional2Name || null,
                    additional_field2_value: parseFloat(additional2Value) || 0,
                    additional_field3_name: additional3Name || null,
                    additional_field3_value: parseFloat(additional3Value) || 0,
                    created_at: new Date().toISOString()
                };
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ —É–∂–µ —Ç–∞—Ä–∏—Ñ –Ω–∞ —ç—Ç–æ—Ç –º–µ—Å—è—Ü
                const checkResponse = await fetch(`${SUPABASE_URL}/rest/v1/tariffs?month=eq.${month}`, {
                    headers: {
                        'apikey': SUPABASE_KEY,
                        'Authorization': `Bearer ${SUPABASE_KEY}`
                    }
                });
                
                if (checkResponse.ok) {
                    const existing = await checkResponse.json();
                    
                    let response;
                    if (existing.length > 0) {
                        // –û–±–Ω–æ–≤–ª—è–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π —Ç–∞—Ä–∏—Ñ
                        response = await fetch(`${SUPABASE_URL}/rest/v1/tariffs?month=eq.${month}`, {
                            method: 'PATCH',
                            headers: {
                                'apikey': SUPABASE_KEY,
                                'Authorization': `Bearer ${SUPABASE_KEY}`,
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify(tariffData)
                        });
                    } else {
                        // –°–æ–∑–¥–∞–µ–º –Ω–æ–≤—ã–π —Ç–∞—Ä–∏—Ñ
                        response = await fetch(`${SUPABASE_URL}/rest/v1/tariffs`, {
                            method: 'POST',
                            headers: {
                                'apikey': SUPABASE_KEY,
                                'Authorization': `Bearer ${SUPABASE_KEY}`,
                                'Content-Type': 'application/json',
                                'Prefer': 'return=representation'
                            },
                            body: JSON.stringify(tariffData)
                        });
                    }
                    
                    if (response.ok) {
                        alert('–¢–∞—Ä–∏—Ñ —Å–æ—Ö—Ä–∞–Ω–µ–Ω');
                        loadTariffs();
                        loadCurrentTariffs(); // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–∞—Ä–∏—Ñ—ã –Ω–∞ –¥–∞—à–±–æ—Ä–¥–µ
                    } else {
                        alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ —Ç–∞—Ä–∏—Ñ–∞');
                    }
                }
            } catch (error) {
                alert(`–û—à–∏–±–∫–∞: ${error.message}`);
            }
        }
        
        // –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–∞—Ä–∏—Ñ–∞
        async function editTariff(tariffId) {
            try {
                const response = await fetch(`${SUPABASE_URL}/rest/v1/tariffs?id=eq.${tariffId}`, {
                    headers: {
                        'apikey': SUPABASE_KEY,
                        'Authorization': `Bearer ${SUPABASE_KEY}`
                    }
                });
                
                if (response.ok) {
                    const tariffs = await response.json();
                    if (tariffs.length > 0) {
                        const tariff = tariffs[0];
                        
                        document.getElementById('tariffMonth').value = tariff.month;
                        document.getElementById('tariffLoss').value = tariff.loss_tariff || 0;
                        document.getElementById('tariffUnder100').value = tariff.tariff_under_100 || 0;
                        document.getElementById('tariffOver100').value = tariff.tariff_over_100 || 0;
                        document.getElementById('tariffSalary').value = tariff.salary_per_plot || 0;
                        document.getElementById('tariffMaintenance').value = tariff.maintenance_per_sotka || 0;
                        document.getElementById('tariffAdditional1Name').value = tariff.additional_field1_name || '';
                        document.getElementById('tariffAdditional1Value').value = tariff.additional_field1_value || 0;
                        document.getElementById('tariffAdditional2Name').value = tariff.additional_field2_name || '';
                        document.getElementById('tariffAdditional2Value').value = tariff.additional_field2_value || 0;
                        document.getElementById('tariffAdditional3Name').value = tariff.additional_field3_name || '';
                        document.getElementById('tariffAdditional3Value').value = tariff.additional_field3_value || 0;
                        
                        // –ü—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ–º –∫ —Ñ–æ—Ä–º–µ —Ç–∞—Ä–∏—Ñ–æ–≤
                        showAdminTab('tariffs');
                    }
                }
            } catch (error) {
                alert(`–û—à–∏–±–∫–∞: ${error.message}`);
            }
        }
        
        // –£–¥–∞–ª–µ–Ω–∏–µ —Ç–∞—Ä–∏—Ñ–∞
        async function deleteTariff(tariffId) {
            if (!confirm('–£–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç —Ç–∞—Ä–∏—Ñ?')) return;
            
            try {
                const response = await fetch(`${SUPABASE_URL}/rest/v1/tariffs?id=eq.${tariffId}`, {
                    method: 'DELETE',
                    headers: {
                        'apikey': SUPABASE_KEY,
                        'Authorization': `Bearer ${SUPABASE_KEY}`
                    }
                });
                
                if (response.ok) {
                    alert('–¢–∞—Ä–∏—Ñ —É–¥–∞–ª–µ–Ω');
                    loadTariffs();
                }
            } catch (error) {
                alert(`–û—à–∏–±–∫–∞: ${error.message}`);
            }
        }
        
        // –≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö
        async function exportData(type) {
            try {
                let url = `${SUPABASE_URL}/rest/v1/`;
                let filename = 'export';
                
                switch (type) {
                    case 'users':
                        url += 'profiles?select=*';
                        filename = 'users';
                        break;
                    case 'readings':
                        url += 'electricity_readings?select=*';
                        filename = 'readings';
                        break;
                    case 'fees':
                        url += 'membership_fees?select=*';
                        filename = 'fees';
                        break;
                    case 'tariffs':
                        url += 'tariffs?select=*';
                        filename = 'tariffs';
                        break;
                }
                
                const response = await fetch(url, {
                    headers: {
                        'apikey': SUPABASE_KEY,
                        'Authorization': `Bearer ${SUPABASE_KEY}`
                    }
                });
                
                if (response.ok) {
                    const data = await response.json();
                    
                    // –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º –≤ CSV
                    const csv = convertToCSV(data);
                    
                    // –°–æ–∑–¥–∞–µ–º –∏ —Å–∫–∞—á–∏–≤–∞–µ–º —Ñ–∞–π–ª
                    const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
                    const link = document.createElement('a');
                    const url = URL.createObjectURL(blob);
                    link.setAttribute('href', url);
                    link.setAttribute('download', `snt_zvezdochka_${filename}_${new Date().toISOString().slice(0, 10)}.csv`);
                    link.style.visibility = 'hidden';
                    document.body.appendChild(link);
                    link.click();
                    document.body.removeChild(link);
                    
                    alert(`–î–∞–Ω–Ω—ã–µ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã –≤ —Ñ–∞–π–ª ${filename}.csv`);
                }
            } catch (error) {
                alert(`–û—à–∏–±–∫–∞ –ø—Ä–∏ —ç–∫—Å–ø–æ—Ä—Ç–µ: ${error.message}`);
            }
        }
        
        // –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –≤ CSV
        function convertToCSV(data) {
            if (data.length === 0) return '';
            
            const headers = Object.keys(data[0]);
            const rows = data.map(row => 
                headers.map(header => {
                    const value = row[header];
                    // –≠–∫—Ä–∞–Ω–∏—Ä—É–µ–º –∫–∞–≤—ã—á–∫–∏ –∏ –∑–∞–ø—è—Ç—ã–µ
                    if (typeof value === 'string' && (value.includes(',') || value.includes('"'))) {
                        return `"${value.replace(/"/g, '""')}"`;
                    }
                    return value;
                }).join(',')
            );
            
            return [headers.join(','), ...rows].join('\n');
        }
        
        // –ò–º–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö
        async function importData() {
            const fileInput = document.getElementById('importFile');
            const type = document.getElementById('importType').value;
            
            if (!fileInput.files.length) {
                alert('–í—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞–π–ª –¥–ª—è –∏–º–ø–æ—Ä—Ç–∞');
                return;
            }
            
            const file = fileInput.files[0];
            const reader = new FileReader();
            
            reader.onload = async function(e) {
                try {
                    const content = e.target.result;
                    const rows = content.split('\n');
                    const headers = rows[0].split(',').map(h => h.trim());
                    
                    // –ü–∞—Ä—Å–∏–º CSV
                    const data = [];
                    for (let i = 1; i < rows.length; i++) {
                        if (!rows[i].trim()) continue;
                        
                        const values = rows[i].split(',').map(v => v.trim());
                        const row = {};
                        
                        headers.forEach((header, index) => {
                            row[header] = values[index] || '';
                        });
                        
                        data.push(row);
                    }
                    
                    // –ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º –¥–∞–Ω–Ω—ã–µ
                    let imported = 0;
                    for (const item of data) {
                        try {
                            const response = await fetch(`${SUPABASE_URL}/rest/v1/${type === 'readings' ? 'electricity_readings' : type === 'fees' ? 'membership_fees' : 'profiles'}`, {
                                method: 'POST',
                                headers: {
                                    'apikey': SUPABASE_KEY,
                                    'Authorization': `Bearer ${SUPABASE_KEY}`,
                                    'Content-Type': 'application/json',
                                    'Prefer': 'resolution=merge-duplicates'
                                },
                                body: JSON.stringify(item)
                            });
                            
                            if (response.ok) {
                                imported++;
                            }
                        } catch (error) {
                            console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∏–º–ø–æ—Ä—Ç–µ –∑–∞–ø–∏—Å–∏:', error);
                        }
                    }
                    
                    alert(`–ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–æ ${imported} –∑–∞–ø–∏—Å–µ–π –∏–∑ ${data.length}`);
                    
                    // –û–±–Ω–æ–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ
                    if (type === 'users') {
                        loadAllUsers();
                    } else if (type === 'readings') {
                        loadReadingsHistory();
                    } else if (type === 'fees') {
                        loadFeesHistory();
                    }
                    
                } catch (error) {
                    alert(`–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ —Ñ–∞–π–ª–∞: ${error.message}`);
                }
            };
            
            reader.readAsText(file);
        }
    </script>
</body>
</html>
