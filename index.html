<!DOCTYPE html>
<html>
<head>
    <title>Supabase тест</title>
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    <style>
        body { font-family: Arial; padding: 20px; }
        button { margin: 5px; padding: 10px; }
        pre { background: #f0f0f0; padding: 10px; margin: 10px 0; }
    </style>
</head>
<body>
    <h2>Тест подключения Supabase</h2>
    
    <div>
        <button onclick="testConnection()">Тест подключения</button>
        <button onclick="createClient()">Создать клиент</button>
        <button onclick="insertTest()">Тест записи</button>
        <button onclick="readTest()">Тест чтения</button>
        <button onclick="clearLog()">Очистить лог</button>
    </div>
    
    <h3>Лог выполнения:</h3>
    <pre id="log">Нажмите кнопки для тестирования...</pre>
    
    <script>
        const SUPABASE_URL = 'https://chgbdbuiqzdmwiniyxrk.supabase.co';
        const SUPABASE_ANON_KEY = 'sb_publishable_9NXa4FwnnrICXnXmrOVqRg_KB5LHkmk';
        let supabase = null;
        
        function log(message) {
            const logElement = document.getElementById('log');
            const timestamp = new Date().toLocaleTimeString();
            logElement.textContent = `[${timestamp}] ${message}\n${logElement.textContent}`;
            console.log(message);
        }
        
        function clearLog() {
            document.getElementById('log').textContent = '';
        }
        
        async function testConnection() {
            try {
                log('Проверка доступности Supabase...');
                const response = await fetch(SUPABASE_URL);
                log(`✓ Supabase доступен. Статус: ${response.status}`);
                return true;
            } catch (error) {
                log(`✗ Ошибка подключения: ${error.message}`);
                return false;
            }
        }
        
        function createClient() {
            try {
                supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
                log('✓ Клиент Supabase создан успешно');
                return true;
            } catch (error) {
                log(`✗ Ошибка создания клиента: ${error.message}`);
                return false;
            }
        }
        
        async function insertTest() {
            if (!supabase) {
                log('✗ Сначала создайте клиент');
                return;
            }
            
            try {
                const testData = {
                    created_at: new Date().toISOString(),
                    test_field: `Тест ${Date.now()}`
                };
                
                const { data, error } = await supabase
                    .from('test_table')
                    .insert([testData])
                    .select();
                    
                if (error) throw error;
                
                log(`✓ Данные записаны: ${JSON.stringify(data)}`);
                return data;
            } catch (error) {
                log(`✗ Ошибка записи: ${error.message}`);
                if (error.message.includes('relation "test_table" does not exist')) {
                    log('⚠ Создайте таблицу test_table в Supabase с полями: id (uuid, primary key), created_at (timestamp), test_field (text)');
                }
                return null;
            }
        }
        
        async function readTest() {
            if (!supabase) {
                log('✗ Сначала создайте клиент');
                return;
            }
            
            try {
                const { data, error, count } = await supabase
                    .from('test_table')
                    .select('*', { count: 'exact' })
                    .limit(5);
                    
                if (error) throw error;
                
                log(`✓ Прочитано записей: ${count || 0}`);
                log(`Данные: ${JSON.stringify(data, null, 2)}`);
                return data;
            } catch (error) {
                log(`✗ Ошибка чтения: ${error.message}`);
                return null;
            }
        }
        
        // Автоматически создаем клиент при загрузке
        window.onload = function() {
            createClient();
        };
    </script>
</body>
</html>
